<html>
<head>
<title>main.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #6a8759;}
.s1 { color: #cc7832;}
.s2 { color: #a9b7c6;}
.s3 { color: #808080;}
.s4 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
main.js</font>
</center></td></tr></table>
<pre><span class="s0">&quot;use strict&quot;</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">__create = Object.create</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">__defProp = Object.defineProperty</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">__getOwnPropDesc = Object.getOwnPropertyDescriptor</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">__getOwnPropNames = Object.getOwnPropertyNames</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">__getProtoOf = Object.getPrototypeOf</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">__hasOwnProp = Object.prototype.hasOwnProperty</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">__export = (target</span><span class="s1">, </span><span class="s2">all) =&gt; {</span>
  <span class="s1">for </span><span class="s2">(</span><span class="s1">var </span><span class="s2">name </span><span class="s1">in </span><span class="s2">all)</span>
    <span class="s2">__defProp(target</span><span class="s1">, </span><span class="s2">name</span><span class="s1">, </span><span class="s2">{ get: all[name]</span><span class="s1">, </span><span class="s2">enumerable: </span><span class="s1">true </span><span class="s2">})</span><span class="s1">;</span>
<span class="s2">}</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">__copyProps = (to</span><span class="s1">, </span><span class="s2">from</span><span class="s1">, </span><span class="s2">except</span><span class="s1">, </span><span class="s2">desc) =&gt; {</span>
  <span class="s1">if </span><span class="s2">(from &amp;&amp; </span><span class="s1">typeof </span><span class="s2">from === </span><span class="s0">&quot;object&quot; </span><span class="s2">|| </span><span class="s1">typeof </span><span class="s2">from === </span><span class="s0">&quot;function&quot;</span><span class="s2">) {</span>
    <span class="s1">for </span><span class="s2">(</span><span class="s1">let </span><span class="s2">key of __getOwnPropNames(from))</span>
      <span class="s1">if </span><span class="s2">(!__hasOwnProp.call(to</span><span class="s1">, </span><span class="s2">key) &amp;&amp; key !== except)</span>
        <span class="s2">__defProp(to</span><span class="s1">, </span><span class="s2">key</span><span class="s1">, </span><span class="s2">{ get: () =&gt; from[key]</span><span class="s1">, </span><span class="s2">enumerable: !(desc = __getOwnPropDesc(from</span><span class="s1">, </span><span class="s2">key)) || desc.enumerable })</span><span class="s1">;</span>
  <span class="s2">}</span>
  <span class="s1">return </span><span class="s2">to</span><span class="s1">;</span>
<span class="s2">}</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">__toESM = (mod</span><span class="s1">, </span><span class="s2">isNodeMode</span><span class="s1">, </span><span class="s2">target) =&gt; (target = mod != </span><span class="s1">null </span><span class="s2">? __create(__getProtoOf(mod)) : {}</span><span class="s1">, </span><span class="s2">__copyProps(</span>
  <span class="s3">// If the importer is in node compatibility mode or this is not an ESM</span>
  <span class="s3">// file that has been converted to a CommonJS file using a Babel-</span>
  <span class="s3">// compatible transform (i.e. &quot;__esModule&quot; has not been set), then set</span>
  <span class="s3">// &quot;default&quot; to the CommonJS &quot;module.exports&quot; for node compatibility.</span>
  <span class="s2">isNodeMode || !mod || !mod.__esModule ? __defProp(target</span><span class="s1">, </span><span class="s0">&quot;default&quot;</span><span class="s1">, </span><span class="s2">{ value: mod</span><span class="s1">, </span><span class="s2">enumerable: </span><span class="s1">true </span><span class="s2">}) : target</span><span class="s1">,</span>
  <span class="s2">mod</span>
<span class="s2">))</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">__toCommonJS = (mod) =&gt; __copyProps(__defProp({}</span><span class="s1">, </span><span class="s0">&quot;__esModule&quot;</span><span class="s1">, </span><span class="s2">{ value: </span><span class="s1">true </span><span class="s2">})</span><span class="s1">, </span><span class="s2">mod)</span><span class="s1">;</span>

<span class="s3">// lib/npm/node.ts</span>
<span class="s1">var </span><span class="s2">node_exports = {}</span><span class="s1">;</span>
<span class="s2">__export(node_exports</span><span class="s1">, </span><span class="s2">{</span>
  <span class="s2">analyzeMetafile: () =&gt; analyzeMetafile</span><span class="s1">,</span>
  <span class="s2">analyzeMetafileSync: () =&gt; analyzeMetafileSync</span><span class="s1">,</span>
  <span class="s2">build: () =&gt; build</span><span class="s1">,</span>
  <span class="s2">buildSync: () =&gt; buildSync</span><span class="s1">,</span>
  <span class="s2">context: () =&gt; context</span><span class="s1">,</span>
  <span class="s1">default</span><span class="s2">: () =&gt; node_default</span><span class="s1">,</span>
  <span class="s2">formatMessages: () =&gt; formatMessages</span><span class="s1">,</span>
  <span class="s2">formatMessagesSync: () =&gt; formatMessagesSync</span><span class="s1">,</span>
  <span class="s2">initialize: () =&gt; initialize</span><span class="s1">,</span>
  <span class="s2">transform: () =&gt; transform</span><span class="s1">,</span>
  <span class="s2">transformSync: () =&gt; transformSync</span><span class="s1">,</span>
  <span class="s2">version: () =&gt; version</span>
<span class="s2">})</span><span class="s1">;</span>
<span class="s2">module.exports = __toCommonJS(node_exports)</span><span class="s1">;</span>

<span class="s3">// lib/shared/stdio_protocol.ts</span>
<span class="s1">function </span><span class="s2">encodePacket(packet) {</span>
  <span class="s1">let </span><span class="s2">visit = (value) =&gt; {</span>
    <span class="s1">if </span><span class="s2">(value === </span><span class="s1">null</span><span class="s2">) {</span>
      <span class="s2">bb.write8(</span><span class="s4">0</span><span class="s2">)</span><span class="s1">;</span>
    <span class="s2">} </span><span class="s1">else if </span><span class="s2">(</span><span class="s1">typeof </span><span class="s2">value === </span><span class="s0">&quot;boolean&quot;</span><span class="s2">) {</span>
      <span class="s2">bb.write8(</span><span class="s4">1</span><span class="s2">)</span><span class="s1">;</span>
      <span class="s2">bb.write8(+value)</span><span class="s1">;</span>
    <span class="s2">} </span><span class="s1">else if </span><span class="s2">(</span><span class="s1">typeof </span><span class="s2">value === </span><span class="s0">&quot;number&quot;</span><span class="s2">) {</span>
      <span class="s2">bb.write8(</span><span class="s4">2</span><span class="s2">)</span><span class="s1">;</span>
      <span class="s2">bb.write32(value | </span><span class="s4">0</span><span class="s2">)</span><span class="s1">;</span>
    <span class="s2">} </span><span class="s1">else if </span><span class="s2">(</span><span class="s1">typeof </span><span class="s2">value === </span><span class="s0">&quot;string&quot;</span><span class="s2">) {</span>
      <span class="s2">bb.write8(</span><span class="s4">3</span><span class="s2">)</span><span class="s1">;</span>
      <span class="s2">bb.write(encodeUTF8(value))</span><span class="s1">;</span>
    <span class="s2">} </span><span class="s1">else if </span><span class="s2">(value </span><span class="s1">instanceof </span><span class="s2">Uint8Array) {</span>
      <span class="s2">bb.write8(</span><span class="s4">4</span><span class="s2">)</span><span class="s1">;</span>
      <span class="s2">bb.write(value)</span><span class="s1">;</span>
    <span class="s2">} </span><span class="s1">else if </span><span class="s2">(value </span><span class="s1">instanceof </span><span class="s2">Array) {</span>
      <span class="s2">bb.write8(</span><span class="s4">5</span><span class="s2">)</span><span class="s1">;</span>
      <span class="s2">bb.write32(value.length)</span><span class="s1">;</span>
      <span class="s1">for </span><span class="s2">(</span><span class="s1">let </span><span class="s2">item of value) {</span>
        <span class="s2">visit(item)</span><span class="s1">;</span>
      <span class="s2">}</span>
    <span class="s2">} </span><span class="s1">else </span><span class="s2">{</span>
      <span class="s1">let </span><span class="s2">keys = Object.keys(value)</span><span class="s1">;</span>
      <span class="s2">bb.write8(</span><span class="s4">6</span><span class="s2">)</span><span class="s1">;</span>
      <span class="s2">bb.write32(keys.length)</span><span class="s1">;</span>
      <span class="s1">for </span><span class="s2">(</span><span class="s1">let </span><span class="s2">key of keys) {</span>
        <span class="s2">bb.write(encodeUTF8(key))</span><span class="s1">;</span>
        <span class="s2">visit(value[key])</span><span class="s1">;</span>
      <span class="s2">}</span>
    <span class="s2">}</span>
  <span class="s2">}</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">bb = </span><span class="s1">new </span><span class="s2">ByteBuffer()</span><span class="s1">;</span>
  <span class="s2">bb.write32(</span><span class="s4">0</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s2">bb.write32(packet.id &lt;&lt; </span><span class="s4">1 </span><span class="s2">| +!packet.isRequest)</span><span class="s1">;</span>
  <span class="s2">visit(packet.value)</span><span class="s1">;</span>
  <span class="s2">writeUInt32LE(bb.buf</span><span class="s1">, </span><span class="s2">bb.len - </span><span class="s4">4</span><span class="s1">, </span><span class="s4">0</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">return </span><span class="s2">bb.buf.subarray(</span><span class="s4">0</span><span class="s1">, </span><span class="s2">bb.len)</span><span class="s1">;</span>
<span class="s2">}</span>
<span class="s1">function </span><span class="s2">decodePacket(bytes) {</span>
  <span class="s1">let </span><span class="s2">visit = () =&gt; {</span>
    <span class="s1">switch </span><span class="s2">(bb.read8()) {</span>
      <span class="s1">case </span><span class="s4">0</span><span class="s2">:</span>
        <span class="s1">return null;</span>
      <span class="s1">case </span><span class="s4">1</span><span class="s2">:</span>
        <span class="s1">return </span><span class="s2">!!bb.read8()</span><span class="s1">;</span>
      <span class="s1">case </span><span class="s4">2</span><span class="s2">:</span>
        <span class="s1">return </span><span class="s2">bb.read32()</span><span class="s1">;</span>
      <span class="s1">case </span><span class="s4">3</span><span class="s2">:</span>
        <span class="s1">return </span><span class="s2">decodeUTF8(bb.read())</span><span class="s1">;</span>
      <span class="s1">case </span><span class="s4">4</span><span class="s2">:</span>
        <span class="s1">return </span><span class="s2">bb.read()</span><span class="s1">;</span>
      <span class="s1">case </span><span class="s4">5</span><span class="s2">: {</span>
        <span class="s1">let </span><span class="s2">count = bb.read32()</span><span class="s1">;</span>
        <span class="s1">let </span><span class="s2">value2 = []</span><span class="s1">;</span>
        <span class="s1">for </span><span class="s2">(</span><span class="s1">let </span><span class="s2">i = </span><span class="s4">0</span><span class="s1">; </span><span class="s2">i &lt; count</span><span class="s1">; </span><span class="s2">i++) {</span>
          <span class="s2">value2.push(visit())</span><span class="s1">;</span>
        <span class="s2">}</span>
        <span class="s1">return </span><span class="s2">value2</span><span class="s1">;</span>
      <span class="s2">}</span>
      <span class="s1">case </span><span class="s4">6</span><span class="s2">: {</span>
        <span class="s1">let </span><span class="s2">count = bb.read32()</span><span class="s1">;</span>
        <span class="s1">let </span><span class="s2">value2 = {}</span><span class="s1">;</span>
        <span class="s1">for </span><span class="s2">(</span><span class="s1">let </span><span class="s2">i = </span><span class="s4">0</span><span class="s1">; </span><span class="s2">i &lt; count</span><span class="s1">; </span><span class="s2">i++) {</span>
          <span class="s2">value2[decodeUTF8(bb.read())] = visit()</span><span class="s1">;</span>
        <span class="s2">}</span>
        <span class="s1">return </span><span class="s2">value2</span><span class="s1">;</span>
      <span class="s2">}</span>
      <span class="s1">default</span><span class="s2">:</span>
        <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">&quot;Invalid packet&quot;</span><span class="s2">)</span><span class="s1">;</span>
    <span class="s2">}</span>
  <span class="s2">}</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">bb = </span><span class="s1">new </span><span class="s2">ByteBuffer(bytes)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">id = bb.read32()</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">isRequest = (id &amp; </span><span class="s4">1</span><span class="s2">) === </span><span class="s4">0</span><span class="s1">;</span>
  <span class="s2">id &gt;&gt;&gt;= </span><span class="s4">1</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">value = visit()</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(bb.ptr !== bytes.length) {</span>
    <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">&quot;Invalid packet&quot;</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s2">}</span>
  <span class="s1">return </span><span class="s2">{ id</span><span class="s1">, </span><span class="s2">isRequest</span><span class="s1">, </span><span class="s2">value }</span><span class="s1">;</span>
<span class="s2">}</span>
<span class="s1">var </span><span class="s2">ByteBuffer = </span><span class="s1">class </span><span class="s2">{</span>
  <span class="s2">constructor(buf = </span><span class="s1">new </span><span class="s2">Uint8Array(</span><span class="s4">1024</span><span class="s2">)) {</span>
    <span class="s1">this</span><span class="s2">.buf = buf</span><span class="s1">;</span>
    <span class="s1">this</span><span class="s2">.len = </span><span class="s4">0</span><span class="s1">;</span>
    <span class="s1">this</span><span class="s2">.ptr = </span><span class="s4">0</span><span class="s1">;</span>
  <span class="s2">}</span>
  <span class="s2">_write(delta) {</span>
    <span class="s1">if </span><span class="s2">(</span><span class="s1">this</span><span class="s2">.len + delta &gt; </span><span class="s1">this</span><span class="s2">.buf.length) {</span>
      <span class="s1">let </span><span class="s2">clone = </span><span class="s1">new </span><span class="s2">Uint8Array((</span><span class="s1">this</span><span class="s2">.len + delta) * </span><span class="s4">2</span><span class="s2">)</span><span class="s1">;</span>
      <span class="s2">clone.set(</span><span class="s1">this</span><span class="s2">.buf)</span><span class="s1">;</span>
      <span class="s1">this</span><span class="s2">.buf = clone</span><span class="s1">;</span>
    <span class="s2">}</span>
    <span class="s1">this</span><span class="s2">.len += delta</span><span class="s1">;</span>
    <span class="s1">return this</span><span class="s2">.len - delta</span><span class="s1">;</span>
  <span class="s2">}</span>
  <span class="s2">write8(value) {</span>
    <span class="s1">let </span><span class="s2">offset = </span><span class="s1">this</span><span class="s2">._write(</span><span class="s4">1</span><span class="s2">)</span><span class="s1">;</span>
    <span class="s1">this</span><span class="s2">.buf[offset] = value</span><span class="s1">;</span>
  <span class="s2">}</span>
  <span class="s2">write32(value) {</span>
    <span class="s1">let </span><span class="s2">offset = </span><span class="s1">this</span><span class="s2">._write(</span><span class="s4">4</span><span class="s2">)</span><span class="s1">;</span>
    <span class="s2">writeUInt32LE(</span><span class="s1">this</span><span class="s2">.buf</span><span class="s1">, </span><span class="s2">value</span><span class="s1">, </span><span class="s2">offset)</span><span class="s1">;</span>
  <span class="s2">}</span>
  <span class="s2">write(bytes) {</span>
    <span class="s1">let </span><span class="s2">offset = </span><span class="s1">this</span><span class="s2">._write(</span><span class="s4">4 </span><span class="s2">+ bytes.length)</span><span class="s1">;</span>
    <span class="s2">writeUInt32LE(</span><span class="s1">this</span><span class="s2">.buf</span><span class="s1">, </span><span class="s2">bytes.length</span><span class="s1">, </span><span class="s2">offset)</span><span class="s1">;</span>
    <span class="s1">this</span><span class="s2">.buf.set(bytes</span><span class="s1">, </span><span class="s2">offset + </span><span class="s4">4</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s2">}</span>
  <span class="s2">_read(delta) {</span>
    <span class="s1">if </span><span class="s2">(</span><span class="s1">this</span><span class="s2">.ptr + delta &gt; </span><span class="s1">this</span><span class="s2">.buf.length) {</span>
      <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">&quot;Invalid packet&quot;</span><span class="s2">)</span><span class="s1">;</span>
    <span class="s2">}</span>
    <span class="s1">this</span><span class="s2">.ptr += delta</span><span class="s1">;</span>
    <span class="s1">return this</span><span class="s2">.ptr - delta</span><span class="s1">;</span>
  <span class="s2">}</span>
  <span class="s2">read8() {</span>
    <span class="s1">return this</span><span class="s2">.buf[</span><span class="s1">this</span><span class="s2">._read(</span><span class="s4">1</span><span class="s2">)]</span><span class="s1">;</span>
  <span class="s2">}</span>
  <span class="s2">read32() {</span>
    <span class="s1">return </span><span class="s2">readUInt32LE(</span><span class="s1">this</span><span class="s2">.buf</span><span class="s1">, this</span><span class="s2">._read(</span><span class="s4">4</span><span class="s2">))</span><span class="s1">;</span>
  <span class="s2">}</span>
  <span class="s2">read() {</span>
    <span class="s1">let </span><span class="s2">length = </span><span class="s1">this</span><span class="s2">.read32()</span><span class="s1">;</span>
    <span class="s1">let </span><span class="s2">bytes = </span><span class="s1">new </span><span class="s2">Uint8Array(length)</span><span class="s1">;</span>
    <span class="s1">let </span><span class="s2">ptr = </span><span class="s1">this</span><span class="s2">._read(bytes.length)</span><span class="s1">;</span>
    <span class="s2">bytes.set(</span><span class="s1">this</span><span class="s2">.buf.subarray(ptr</span><span class="s1">, </span><span class="s2">ptr + length))</span><span class="s1">;</span>
    <span class="s1">return </span><span class="s2">bytes</span><span class="s1">;</span>
  <span class="s2">}</span>
<span class="s2">}</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">encodeUTF8</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">decodeUTF8</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">encodeInvariant</span><span class="s1">;</span>
<span class="s1">if </span><span class="s2">(</span><span class="s1">typeof </span><span class="s2">TextEncoder !== </span><span class="s0">&quot;undefined&quot; </span><span class="s2">&amp;&amp; </span><span class="s1">typeof </span><span class="s2">TextDecoder !== </span><span class="s0">&quot;undefined&quot;</span><span class="s2">) {</span>
  <span class="s1">let </span><span class="s2">encoder = </span><span class="s1">new </span><span class="s2">TextEncoder()</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">decoder = </span><span class="s1">new </span><span class="s2">TextDecoder()</span><span class="s1">;</span>
  <span class="s2">encodeUTF8 = (text) =&gt; encoder.encode(text)</span><span class="s1">;</span>
  <span class="s2">decodeUTF8 = (bytes) =&gt; decoder.decode(bytes)</span><span class="s1">;</span>
  <span class="s2">encodeInvariant = </span><span class="s0">'new TextEncoder().encode(&quot;&quot;)'</span><span class="s1">;</span>
<span class="s2">} </span><span class="s1">else if </span><span class="s2">(</span><span class="s1">typeof </span><span class="s2">Buffer !== </span><span class="s0">&quot;undefined&quot;</span><span class="s2">) {</span>
  <span class="s2">encodeUTF8 = (text) =&gt; Buffer.from(text)</span><span class="s1">;</span>
  <span class="s2">decodeUTF8 = (bytes) =&gt; {</span>
    <span class="s1">let </span><span class="s2">{ buffer</span><span class="s1">, </span><span class="s2">byteOffset</span><span class="s1">, </span><span class="s2">byteLength } = bytes</span><span class="s1">;</span>
    <span class="s1">return </span><span class="s2">Buffer.from(buffer</span><span class="s1">, </span><span class="s2">byteOffset</span><span class="s1">, </span><span class="s2">byteLength).toString()</span><span class="s1">;</span>
  <span class="s2">}</span><span class="s1">;</span>
  <span class="s2">encodeInvariant = </span><span class="s0">'Buffer.from(&quot;&quot;)'</span><span class="s1">;</span>
<span class="s2">} </span><span class="s1">else </span><span class="s2">{</span>
  <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">&quot;No UTF-8 codec found&quot;</span><span class="s2">)</span><span class="s1">;</span>
<span class="s2">}</span>
<span class="s1">if </span><span class="s2">(!(encodeUTF8(</span><span class="s0">&quot;&quot;</span><span class="s2">) </span><span class="s1">instanceof </span><span class="s2">Uint8Array))</span>
  <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">`Invariant violation: &quot;</span><span class="s2">${encodeInvariant} </span><span class="s0">instanceof Uint8Array&quot; is incorrectly false 
 
This indicates that your JavaScript environment is broken. You cannot use 
esbuild in this environment because esbuild relies on this invariant. This 
is not a problem with esbuild. You need to fix your environment instead. 
`</span><span class="s2">)</span><span class="s1">;</span>
<span class="s1">function </span><span class="s2">readUInt32LE(buffer</span><span class="s1">, </span><span class="s2">offset) {</span>
  <span class="s1">return </span><span class="s2">buffer[offset++] | buffer[offset++] &lt;&lt; </span><span class="s4">8 </span><span class="s2">| buffer[offset++] &lt;&lt; </span><span class="s4">16 </span><span class="s2">| buffer[offset++] &lt;&lt; </span><span class="s4">24</span><span class="s1">;</span>
<span class="s2">}</span>
<span class="s1">function </span><span class="s2">writeUInt32LE(buffer</span><span class="s1">, </span><span class="s2">value</span><span class="s1">, </span><span class="s2">offset) {</span>
  <span class="s2">buffer[offset++] = value</span><span class="s1">;</span>
  <span class="s2">buffer[offset++] = value &gt;&gt; </span><span class="s4">8</span><span class="s1">;</span>
  <span class="s2">buffer[offset++] = value &gt;&gt; </span><span class="s4">16</span><span class="s1">;</span>
  <span class="s2">buffer[offset++] = value &gt;&gt; </span><span class="s4">24</span><span class="s1">;</span>
<span class="s2">}</span>

<span class="s3">// lib/shared/common.ts</span>
<span class="s1">var </span><span class="s2">quote = JSON.stringify</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">buildLogLevelDefault = </span><span class="s0">&quot;warning&quot;</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">transformLogLevelDefault = </span><span class="s0">&quot;silent&quot;</span><span class="s1">;</span>
<span class="s1">function </span><span class="s2">validateTarget(target) {</span>
  <span class="s2">validateStringValue(target</span><span class="s1">, </span><span class="s0">&quot;target&quot;</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(target.indexOf(</span><span class="s0">&quot;,&quot;</span><span class="s2">) &gt;= </span><span class="s4">0</span><span class="s2">)</span>
    <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">`Invalid target: </span><span class="s2">${target}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">return </span><span class="s2">target</span><span class="s1">;</span>
<span class="s2">}</span>
<span class="s1">var </span><span class="s2">canBeAnything = () =&gt; </span><span class="s1">null;</span>
<span class="s1">var </span><span class="s2">mustBeBoolean = (value) =&gt; </span><span class="s1">typeof </span><span class="s2">value === </span><span class="s0">&quot;boolean&quot; </span><span class="s2">? </span><span class="s1">null </span><span class="s2">: </span><span class="s0">&quot;a boolean&quot;</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">mustBeString = (value) =&gt; </span><span class="s1">typeof </span><span class="s2">value === </span><span class="s0">&quot;string&quot; </span><span class="s2">? </span><span class="s1">null </span><span class="s2">: </span><span class="s0">&quot;a string&quot;</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">mustBeRegExp = (value) =&gt; value </span><span class="s1">instanceof </span><span class="s2">RegExp ? </span><span class="s1">null </span><span class="s2">: </span><span class="s0">&quot;a RegExp object&quot;</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">mustBeInteger = (value) =&gt; </span><span class="s1">typeof </span><span class="s2">value === </span><span class="s0">&quot;number&quot; </span><span class="s2">&amp;&amp; value === (value | </span><span class="s4">0</span><span class="s2">) ? </span><span class="s1">null </span><span class="s2">: </span><span class="s0">&quot;an integer&quot;</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">mustBeFunction = (value) =&gt; </span><span class="s1">typeof </span><span class="s2">value === </span><span class="s0">&quot;function&quot; </span><span class="s2">? </span><span class="s1">null </span><span class="s2">: </span><span class="s0">&quot;a function&quot;</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">mustBeArray = (value) =&gt; Array.isArray(value) ? </span><span class="s1">null </span><span class="s2">: </span><span class="s0">&quot;an array&quot;</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">mustBeObject = (value) =&gt; </span><span class="s1">typeof </span><span class="s2">value === </span><span class="s0">&quot;object&quot; </span><span class="s2">&amp;&amp; value !== </span><span class="s1">null </span><span class="s2">&amp;&amp; !Array.isArray(value) ? </span><span class="s1">null </span><span class="s2">: </span><span class="s0">&quot;an object&quot;</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">mustBeEntryPoints = (value) =&gt; </span><span class="s1">typeof </span><span class="s2">value === </span><span class="s0">&quot;object&quot; </span><span class="s2">&amp;&amp; value !== </span><span class="s1">null </span><span class="s2">? </span><span class="s1">null </span><span class="s2">: </span><span class="s0">&quot;an array or an object&quot;</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">mustBeWebAssemblyModule = (value) =&gt; value </span><span class="s1">instanceof </span><span class="s2">WebAssembly.Module ? </span><span class="s1">null </span><span class="s2">: </span><span class="s0">&quot;a WebAssembly.Module&quot;</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">mustBeObjectOrNull = (value) =&gt; </span><span class="s1">typeof </span><span class="s2">value === </span><span class="s0">&quot;object&quot; </span><span class="s2">&amp;&amp; !Array.isArray(value) ? </span><span class="s1">null </span><span class="s2">: </span><span class="s0">&quot;an object or null&quot;</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">mustBeStringOrBoolean = (value) =&gt; </span><span class="s1">typeof </span><span class="s2">value === </span><span class="s0">&quot;string&quot; </span><span class="s2">|| </span><span class="s1">typeof </span><span class="s2">value === </span><span class="s0">&quot;boolean&quot; </span><span class="s2">? </span><span class="s1">null </span><span class="s2">: </span><span class="s0">&quot;a string or a boolean&quot;</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">mustBeStringOrObject = (value) =&gt; </span><span class="s1">typeof </span><span class="s2">value === </span><span class="s0">&quot;string&quot; </span><span class="s2">|| </span><span class="s1">typeof </span><span class="s2">value === </span><span class="s0">&quot;object&quot; </span><span class="s2">&amp;&amp; value !== </span><span class="s1">null </span><span class="s2">&amp;&amp; !Array.isArray(value) ? </span><span class="s1">null </span><span class="s2">: </span><span class="s0">&quot;a string or an object&quot;</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">mustBeStringOrArray = (value) =&gt; </span><span class="s1">typeof </span><span class="s2">value === </span><span class="s0">&quot;string&quot; </span><span class="s2">|| Array.isArray(value) ? </span><span class="s1">null </span><span class="s2">: </span><span class="s0">&quot;a string or an array&quot;</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">mustBeStringOrUint8Array = (value) =&gt; </span><span class="s1">typeof </span><span class="s2">value === </span><span class="s0">&quot;string&quot; </span><span class="s2">|| value </span><span class="s1">instanceof </span><span class="s2">Uint8Array ? </span><span class="s1">null </span><span class="s2">: </span><span class="s0">&quot;a string or a Uint8Array&quot;</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">mustBeStringOrURL = (value) =&gt; </span><span class="s1">typeof </span><span class="s2">value === </span><span class="s0">&quot;string&quot; </span><span class="s2">|| value </span><span class="s1">instanceof </span><span class="s2">URL ? </span><span class="s1">null </span><span class="s2">: </span><span class="s0">&quot;a string or a URL&quot;</span><span class="s1">;</span>
<span class="s1">function </span><span class="s2">getFlag(object</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s2">key</span><span class="s1">, </span><span class="s2">mustBeFn) {</span>
  <span class="s1">let </span><span class="s2">value = object[key]</span><span class="s1">;</span>
  <span class="s2">keys[key + </span><span class="s0">&quot;&quot;</span><span class="s2">] = </span><span class="s1">true;</span>
  <span class="s1">if </span><span class="s2">(value === </span><span class="s1">void </span><span class="s4">0</span><span class="s2">)</span>
    <span class="s1">return void </span><span class="s4">0</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">mustBe = mustBeFn(value)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(mustBe !== </span><span class="s1">null</span><span class="s2">)</span>
    <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">`</span><span class="s2">${quote(key)} </span><span class="s0">must be </span><span class="s2">${mustBe}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">return </span><span class="s2">value</span><span class="s1">;</span>
<span class="s2">}</span>
<span class="s1">function </span><span class="s2">checkForInvalidFlags(object</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s2">where) {</span>
  <span class="s1">for </span><span class="s2">(</span><span class="s1">let </span><span class="s2">key </span><span class="s1">in </span><span class="s2">object) {</span>
    <span class="s1">if </span><span class="s2">(!(key </span><span class="s1">in </span><span class="s2">keys)) {</span>
      <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">`Invalid option </span><span class="s2">${where}</span><span class="s0">: </span><span class="s2">${quote(key)}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
    <span class="s2">}</span>
  <span class="s2">}</span>
<span class="s2">}</span>
<span class="s1">function </span><span class="s2">validateInitializeOptions(options) {</span>
  <span class="s1">let </span><span class="s2">keys = </span><span class="s3">/* @__PURE__ */ </span><span class="s2">Object.create(</span><span class="s1">null</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">wasmURL = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;wasmURL&quot;</span><span class="s1">, </span><span class="s2">mustBeStringOrURL)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">wasmModule = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;wasmModule&quot;</span><span class="s1">, </span><span class="s2">mustBeWebAssemblyModule)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">worker = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;worker&quot;</span><span class="s1">, </span><span class="s2">mustBeBoolean)</span><span class="s1">;</span>
  <span class="s2">checkForInvalidFlags(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;in initialize() call&quot;</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">return </span><span class="s2">{</span>
    <span class="s2">wasmURL</span><span class="s1">,</span>
    <span class="s2">wasmModule</span><span class="s1">,</span>
    <span class="s2">worker</span>
  <span class="s2">}</span><span class="s1">;</span>
<span class="s2">}</span>
<span class="s1">function </span><span class="s2">validateMangleCache(mangleCache) {</span>
  <span class="s1">let </span><span class="s2">validated</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(mangleCache !== </span><span class="s1">void </span><span class="s4">0</span><span class="s2">) {</span>
    <span class="s2">validated = </span><span class="s3">/* @__PURE__ */ </span><span class="s2">Object.create(</span><span class="s1">null</span><span class="s2">)</span><span class="s1">;</span>
    <span class="s1">for </span><span class="s2">(</span><span class="s1">let </span><span class="s2">key </span><span class="s1">in </span><span class="s2">mangleCache) {</span>
      <span class="s1">let </span><span class="s2">value = mangleCache[key]</span><span class="s1">;</span>
      <span class="s1">if </span><span class="s2">(</span><span class="s1">typeof </span><span class="s2">value === </span><span class="s0">&quot;string&quot; </span><span class="s2">|| value === </span><span class="s1">false</span><span class="s2">) {</span>
        <span class="s2">validated[key] = value</span><span class="s1">;</span>
      <span class="s2">} </span><span class="s1">else </span><span class="s2">{</span>
        <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">`Expected </span><span class="s2">${quote(key)} </span><span class="s0">in mangle cache to map to either a string or false`</span><span class="s2">)</span><span class="s1">;</span>
      <span class="s2">}</span>
    <span class="s2">}</span>
  <span class="s2">}</span>
  <span class="s1">return </span><span class="s2">validated</span><span class="s1">;</span>
<span class="s2">}</span>
<span class="s1">function </span><span class="s2">pushLogFlags(flags</span><span class="s1">, </span><span class="s2">options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s2">isTTY2</span><span class="s1">, </span><span class="s2">logLevelDefault) {</span>
  <span class="s1">let </span><span class="s2">color = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;color&quot;</span><span class="s1">, </span><span class="s2">mustBeBoolean)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">logLevel = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;logLevel&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">logLimit = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;logLimit&quot;</span><span class="s1">, </span><span class="s2">mustBeInteger)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(color !== </span><span class="s1">void </span><span class="s4">0</span><span class="s2">)</span>
    <span class="s2">flags.push(</span><span class="s0">`--color=</span><span class="s2">${color}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">else if </span><span class="s2">(isTTY2)</span>
    <span class="s2">flags.push(</span><span class="s0">`--color=true`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s2">flags.push(</span><span class="s0">`--log-level=</span><span class="s2">${logLevel || logLevelDefault}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s2">flags.push(</span><span class="s0">`--log-limit=</span><span class="s2">${logLimit || </span><span class="s4">0</span><span class="s2">}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
<span class="s2">}</span>
<span class="s1">function </span><span class="s2">validateStringValue(value</span><span class="s1">, </span><span class="s2">what</span><span class="s1">, </span><span class="s2">key) {</span>
  <span class="s1">if </span><span class="s2">(</span><span class="s1">typeof </span><span class="s2">value !== </span><span class="s0">&quot;string&quot;</span><span class="s2">) {</span>
    <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">`Expected value for </span><span class="s2">${what}${key !== </span><span class="s1">void </span><span class="s4">0 </span><span class="s2">? </span><span class="s0">&quot; &quot; </span><span class="s2">+ quote(key) : </span><span class="s0">&quot;&quot;</span><span class="s2">} </span><span class="s0">to be a string, got </span><span class="s2">${</span><span class="s1">typeof </span><span class="s2">value} </span><span class="s0">instead`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s2">}</span>
  <span class="s1">return </span><span class="s2">value</span><span class="s1">;</span>
<span class="s2">}</span>
<span class="s1">function </span><span class="s2">pushCommonFlags(flags</span><span class="s1">, </span><span class="s2">options</span><span class="s1">, </span><span class="s2">keys) {</span>
  <span class="s1">let </span><span class="s2">legalComments = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;legalComments&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">sourceRoot = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;sourceRoot&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">sourcesContent = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;sourcesContent&quot;</span><span class="s1">, </span><span class="s2">mustBeBoolean)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">target = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;target&quot;</span><span class="s1">, </span><span class="s2">mustBeStringOrArray)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">format = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;format&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">globalName = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;globalName&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">mangleProps = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;mangleProps&quot;</span><span class="s1">, </span><span class="s2">mustBeRegExp)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">reserveProps = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;reserveProps&quot;</span><span class="s1">, </span><span class="s2">mustBeRegExp)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">mangleQuoted = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;mangleQuoted&quot;</span><span class="s1">, </span><span class="s2">mustBeBoolean)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">minify = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;minify&quot;</span><span class="s1">, </span><span class="s2">mustBeBoolean)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">minifySyntax = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;minifySyntax&quot;</span><span class="s1">, </span><span class="s2">mustBeBoolean)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">minifyWhitespace = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;minifyWhitespace&quot;</span><span class="s1">, </span><span class="s2">mustBeBoolean)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">minifyIdentifiers = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;minifyIdentifiers&quot;</span><span class="s1">, </span><span class="s2">mustBeBoolean)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">drop = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;drop&quot;</span><span class="s1">, </span><span class="s2">mustBeArray)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">charset = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;charset&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">treeShaking = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;treeShaking&quot;</span><span class="s1">, </span><span class="s2">mustBeBoolean)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">ignoreAnnotations = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;ignoreAnnotations&quot;</span><span class="s1">, </span><span class="s2">mustBeBoolean)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">jsx = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;jsx&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">jsxFactory = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;jsxFactory&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">jsxFragment = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;jsxFragment&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">jsxImportSource = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;jsxImportSource&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">jsxDev = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;jsxDev&quot;</span><span class="s1">, </span><span class="s2">mustBeBoolean)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">jsxSideEffects = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;jsxSideEffects&quot;</span><span class="s1">, </span><span class="s2">mustBeBoolean)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">define = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;define&quot;</span><span class="s1">, </span><span class="s2">mustBeObject)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">logOverride = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;logOverride&quot;</span><span class="s1">, </span><span class="s2">mustBeObject)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">supported = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;supported&quot;</span><span class="s1">, </span><span class="s2">mustBeObject)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">pure = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;pure&quot;</span><span class="s1">, </span><span class="s2">mustBeArray)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">keepNames = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;keepNames&quot;</span><span class="s1">, </span><span class="s2">mustBeBoolean)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">platform = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;platform&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(legalComments)</span>
    <span class="s2">flags.push(</span><span class="s0">`--legal-comments=</span><span class="s2">${legalComments}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(sourceRoot !== </span><span class="s1">void </span><span class="s4">0</span><span class="s2">)</span>
    <span class="s2">flags.push(</span><span class="s0">`--source-root=</span><span class="s2">${sourceRoot}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(sourcesContent !== </span><span class="s1">void </span><span class="s4">0</span><span class="s2">)</span>
    <span class="s2">flags.push(</span><span class="s0">`--sources-content=</span><span class="s2">${sourcesContent}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(target) {</span>
    <span class="s1">if </span><span class="s2">(Array.isArray(target))</span>
      <span class="s2">flags.push(</span><span class="s0">`--target=</span><span class="s2">${Array.from(target).map(validateTarget).join(</span><span class="s0">&quot;,&quot;</span><span class="s2">)}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
    <span class="s1">else</span>
      <span class="s2">flags.push(</span><span class="s0">`--target=</span><span class="s2">${validateTarget(target)}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s2">}</span>
  <span class="s1">if </span><span class="s2">(format)</span>
    <span class="s2">flags.push(</span><span class="s0">`--format=</span><span class="s2">${format}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(globalName)</span>
    <span class="s2">flags.push(</span><span class="s0">`--global-name=</span><span class="s2">${globalName}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(platform)</span>
    <span class="s2">flags.push(</span><span class="s0">`--platform=</span><span class="s2">${platform}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(minify)</span>
    <span class="s2">flags.push(</span><span class="s0">&quot;--minify&quot;</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(minifySyntax)</span>
    <span class="s2">flags.push(</span><span class="s0">&quot;--minify-syntax&quot;</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(minifyWhitespace)</span>
    <span class="s2">flags.push(</span><span class="s0">&quot;--minify-whitespace&quot;</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(minifyIdentifiers)</span>
    <span class="s2">flags.push(</span><span class="s0">&quot;--minify-identifiers&quot;</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(charset)</span>
    <span class="s2">flags.push(</span><span class="s0">`--charset=</span><span class="s2">${charset}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(treeShaking !== </span><span class="s1">void </span><span class="s4">0</span><span class="s2">)</span>
    <span class="s2">flags.push(</span><span class="s0">`--tree-shaking=</span><span class="s2">${treeShaking}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(ignoreAnnotations)</span>
    <span class="s2">flags.push(</span><span class="s0">`--ignore-annotations`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(drop)</span>
    <span class="s1">for </span><span class="s2">(</span><span class="s1">let </span><span class="s2">what of drop)</span>
      <span class="s2">flags.push(</span><span class="s0">`--drop:</span><span class="s2">${validateStringValue(what</span><span class="s1">, </span><span class="s0">&quot;drop&quot;</span><span class="s2">)}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(mangleProps)</span>
    <span class="s2">flags.push(</span><span class="s0">`--mangle-props=</span><span class="s2">${mangleProps.source}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(reserveProps)</span>
    <span class="s2">flags.push(</span><span class="s0">`--reserve-props=</span><span class="s2">${reserveProps.source}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(mangleQuoted !== </span><span class="s1">void </span><span class="s4">0</span><span class="s2">)</span>
    <span class="s2">flags.push(</span><span class="s0">`--mangle-quoted=</span><span class="s2">${mangleQuoted}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(jsx)</span>
    <span class="s2">flags.push(</span><span class="s0">`--jsx=</span><span class="s2">${jsx}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(jsxFactory)</span>
    <span class="s2">flags.push(</span><span class="s0">`--jsx-factory=</span><span class="s2">${jsxFactory}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(jsxFragment)</span>
    <span class="s2">flags.push(</span><span class="s0">`--jsx-fragment=</span><span class="s2">${jsxFragment}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(jsxImportSource)</span>
    <span class="s2">flags.push(</span><span class="s0">`--jsx-import-source=</span><span class="s2">${jsxImportSource}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(jsxDev)</span>
    <span class="s2">flags.push(</span><span class="s0">`--jsx-dev`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(jsxSideEffects)</span>
    <span class="s2">flags.push(</span><span class="s0">`--jsx-side-effects`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(define) {</span>
    <span class="s1">for </span><span class="s2">(</span><span class="s1">let </span><span class="s2">key </span><span class="s1">in </span><span class="s2">define) {</span>
      <span class="s1">if </span><span class="s2">(key.indexOf(</span><span class="s0">&quot;=&quot;</span><span class="s2">) &gt;= </span><span class="s4">0</span><span class="s2">)</span>
        <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">`Invalid define: </span><span class="s2">${key}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
      <span class="s2">flags.push(</span><span class="s0">`--define:</span><span class="s2">${key}</span><span class="s0">=</span><span class="s2">${validateStringValue(define[key]</span><span class="s1">, </span><span class="s0">&quot;define&quot;</span><span class="s1">, </span><span class="s2">key)}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
    <span class="s2">}</span>
  <span class="s2">}</span>
  <span class="s1">if </span><span class="s2">(logOverride) {</span>
    <span class="s1">for </span><span class="s2">(</span><span class="s1">let </span><span class="s2">key </span><span class="s1">in </span><span class="s2">logOverride) {</span>
      <span class="s1">if </span><span class="s2">(key.indexOf(</span><span class="s0">&quot;=&quot;</span><span class="s2">) &gt;= </span><span class="s4">0</span><span class="s2">)</span>
        <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">`Invalid log override: </span><span class="s2">${key}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
      <span class="s2">flags.push(</span><span class="s0">`--log-override:</span><span class="s2">${key}</span><span class="s0">=</span><span class="s2">${validateStringValue(logOverride[key]</span><span class="s1">, </span><span class="s0">&quot;log override&quot;</span><span class="s1">, </span><span class="s2">key)}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
    <span class="s2">}</span>
  <span class="s2">}</span>
  <span class="s1">if </span><span class="s2">(supported) {</span>
    <span class="s1">for </span><span class="s2">(</span><span class="s1">let </span><span class="s2">key </span><span class="s1">in </span><span class="s2">supported) {</span>
      <span class="s1">if </span><span class="s2">(key.indexOf(</span><span class="s0">&quot;=&quot;</span><span class="s2">) &gt;= </span><span class="s4">0</span><span class="s2">)</span>
        <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">`Invalid supported: </span><span class="s2">${key}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
      <span class="s1">const </span><span class="s2">value = supported[key]</span><span class="s1">;</span>
      <span class="s1">if </span><span class="s2">(</span><span class="s1">typeof </span><span class="s2">value !== </span><span class="s0">&quot;boolean&quot;</span><span class="s2">)</span>
        <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">`Expected value for supported </span><span class="s2">${quote(key)} </span><span class="s0">to be a boolean, got </span><span class="s2">${</span><span class="s1">typeof </span><span class="s2">value} </span><span class="s0">instead`</span><span class="s2">)</span><span class="s1">;</span>
      <span class="s2">flags.push(</span><span class="s0">`--supported:</span><span class="s2">${key}</span><span class="s0">=</span><span class="s2">${value}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
    <span class="s2">}</span>
  <span class="s2">}</span>
  <span class="s1">if </span><span class="s2">(pure)</span>
    <span class="s1">for </span><span class="s2">(</span><span class="s1">let </span><span class="s2">fn of pure)</span>
      <span class="s2">flags.push(</span><span class="s0">`--pure:</span><span class="s2">${validateStringValue(fn</span><span class="s1">, </span><span class="s0">&quot;pure&quot;</span><span class="s2">)}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(keepNames)</span>
    <span class="s2">flags.push(</span><span class="s0">`--keep-names`</span><span class="s2">)</span><span class="s1">;</span>
<span class="s2">}</span>
<span class="s1">function </span><span class="s2">flagsForBuildOptions(callName</span><span class="s1">, </span><span class="s2">options</span><span class="s1">, </span><span class="s2">isTTY2</span><span class="s1">, </span><span class="s2">logLevelDefault</span><span class="s1">, </span><span class="s2">writeDefault) {</span>
  <span class="s1">var </span><span class="s2">_a2</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">flags = []</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">entries = []</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">keys = </span><span class="s3">/* @__PURE__ */ </span><span class="s2">Object.create(</span><span class="s1">null</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">stdinContents = </span><span class="s1">null;</span>
  <span class="s1">let </span><span class="s2">stdinResolveDir = </span><span class="s1">null;</span>
  <span class="s2">pushLogFlags(flags</span><span class="s1">, </span><span class="s2">options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s2">isTTY2</span><span class="s1">, </span><span class="s2">logLevelDefault)</span><span class="s1">;</span>
  <span class="s2">pushCommonFlags(flags</span><span class="s1">, </span><span class="s2">options</span><span class="s1">, </span><span class="s2">keys)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">sourcemap = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;sourcemap&quot;</span><span class="s1">, </span><span class="s2">mustBeStringOrBoolean)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">bundle = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;bundle&quot;</span><span class="s1">, </span><span class="s2">mustBeBoolean)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">splitting = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;splitting&quot;</span><span class="s1">, </span><span class="s2">mustBeBoolean)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">preserveSymlinks = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;preserveSymlinks&quot;</span><span class="s1">, </span><span class="s2">mustBeBoolean)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">metafile = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;metafile&quot;</span><span class="s1">, </span><span class="s2">mustBeBoolean)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">outfile = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;outfile&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">outdir = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;outdir&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">outbase = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;outbase&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">tsconfig = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;tsconfig&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">resolveExtensions = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;resolveExtensions&quot;</span><span class="s1">, </span><span class="s2">mustBeArray)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">nodePathsInput = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;nodePaths&quot;</span><span class="s1">, </span><span class="s2">mustBeArray)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">mainFields = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;mainFields&quot;</span><span class="s1">, </span><span class="s2">mustBeArray)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">conditions = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;conditions&quot;</span><span class="s1">, </span><span class="s2">mustBeArray)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">external = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;external&quot;</span><span class="s1">, </span><span class="s2">mustBeArray)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">packages = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;packages&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">alias = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;alias&quot;</span><span class="s1">, </span><span class="s2">mustBeObject)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">loader = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;loader&quot;</span><span class="s1">, </span><span class="s2">mustBeObject)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">outExtension = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;outExtension&quot;</span><span class="s1">, </span><span class="s2">mustBeObject)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">publicPath = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;publicPath&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">entryNames = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;entryNames&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">chunkNames = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;chunkNames&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">assetNames = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;assetNames&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">inject = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;inject&quot;</span><span class="s1">, </span><span class="s2">mustBeArray)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">banner = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;banner&quot;</span><span class="s1">, </span><span class="s2">mustBeObject)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">footer = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;footer&quot;</span><span class="s1">, </span><span class="s2">mustBeObject)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">entryPoints = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;entryPoints&quot;</span><span class="s1">, </span><span class="s2">mustBeEntryPoints)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">absWorkingDir = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;absWorkingDir&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">stdin = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;stdin&quot;</span><span class="s1">, </span><span class="s2">mustBeObject)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">write = (_a2 = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;write&quot;</span><span class="s1">, </span><span class="s2">mustBeBoolean)) != </span><span class="s1">null </span><span class="s2">? _a2 : writeDefault</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">allowOverwrite = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;allowOverwrite&quot;</span><span class="s1">, </span><span class="s2">mustBeBoolean)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">mangleCache = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;mangleCache&quot;</span><span class="s1">, </span><span class="s2">mustBeObject)</span><span class="s1">;</span>
  <span class="s2">keys.plugins = </span><span class="s1">true;</span>
  <span class="s2">checkForInvalidFlags(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">`in </span><span class="s2">${callName}</span><span class="s0">() call`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(sourcemap)</span>
    <span class="s2">flags.push(</span><span class="s0">`--sourcemap</span><span class="s2">${sourcemap === </span><span class="s1">true </span><span class="s2">? </span><span class="s0">&quot;&quot; </span><span class="s2">: </span><span class="s0">`=</span><span class="s2">${sourcemap}</span><span class="s0">`</span><span class="s2">}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(bundle)</span>
    <span class="s2">flags.push(</span><span class="s0">&quot;--bundle&quot;</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(allowOverwrite)</span>
    <span class="s2">flags.push(</span><span class="s0">&quot;--allow-overwrite&quot;</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(splitting)</span>
    <span class="s2">flags.push(</span><span class="s0">&quot;--splitting&quot;</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(preserveSymlinks)</span>
    <span class="s2">flags.push(</span><span class="s0">&quot;--preserve-symlinks&quot;</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(metafile)</span>
    <span class="s2">flags.push(</span><span class="s0">`--metafile`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(outfile)</span>
    <span class="s2">flags.push(</span><span class="s0">`--outfile=</span><span class="s2">${outfile}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(outdir)</span>
    <span class="s2">flags.push(</span><span class="s0">`--outdir=</span><span class="s2">${outdir}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(outbase)</span>
    <span class="s2">flags.push(</span><span class="s0">`--outbase=</span><span class="s2">${outbase}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(tsconfig)</span>
    <span class="s2">flags.push(</span><span class="s0">`--tsconfig=</span><span class="s2">${tsconfig}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(packages)</span>
    <span class="s2">flags.push(</span><span class="s0">`--packages=</span><span class="s2">${packages}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(resolveExtensions) {</span>
    <span class="s1">let </span><span class="s2">values = []</span><span class="s1">;</span>
    <span class="s1">for </span><span class="s2">(</span><span class="s1">let </span><span class="s2">value of resolveExtensions) {</span>
      <span class="s2">validateStringValue(value</span><span class="s1">, </span><span class="s0">&quot;resolve extension&quot;</span><span class="s2">)</span><span class="s1">;</span>
      <span class="s1">if </span><span class="s2">(value.indexOf(</span><span class="s0">&quot;,&quot;</span><span class="s2">) &gt;= </span><span class="s4">0</span><span class="s2">)</span>
        <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">`Invalid resolve extension: </span><span class="s2">${value}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
      <span class="s2">values.push(value)</span><span class="s1">;</span>
    <span class="s2">}</span>
    <span class="s2">flags.push(</span><span class="s0">`--resolve-extensions=</span><span class="s2">${values.join(</span><span class="s0">&quot;,&quot;</span><span class="s2">)}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s2">}</span>
  <span class="s1">if </span><span class="s2">(publicPath)</span>
    <span class="s2">flags.push(</span><span class="s0">`--public-path=</span><span class="s2">${publicPath}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(entryNames)</span>
    <span class="s2">flags.push(</span><span class="s0">`--entry-names=</span><span class="s2">${entryNames}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(chunkNames)</span>
    <span class="s2">flags.push(</span><span class="s0">`--chunk-names=</span><span class="s2">${chunkNames}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(assetNames)</span>
    <span class="s2">flags.push(</span><span class="s0">`--asset-names=</span><span class="s2">${assetNames}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(mainFields) {</span>
    <span class="s1">let </span><span class="s2">values = []</span><span class="s1">;</span>
    <span class="s1">for </span><span class="s2">(</span><span class="s1">let </span><span class="s2">value of mainFields) {</span>
      <span class="s2">validateStringValue(value</span><span class="s1">, </span><span class="s0">&quot;main field&quot;</span><span class="s2">)</span><span class="s1">;</span>
      <span class="s1">if </span><span class="s2">(value.indexOf(</span><span class="s0">&quot;,&quot;</span><span class="s2">) &gt;= </span><span class="s4">0</span><span class="s2">)</span>
        <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">`Invalid main field: </span><span class="s2">${value}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
      <span class="s2">values.push(value)</span><span class="s1">;</span>
    <span class="s2">}</span>
    <span class="s2">flags.push(</span><span class="s0">`--main-fields=</span><span class="s2">${values.join(</span><span class="s0">&quot;,&quot;</span><span class="s2">)}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s2">}</span>
  <span class="s1">if </span><span class="s2">(conditions) {</span>
    <span class="s1">let </span><span class="s2">values = []</span><span class="s1">;</span>
    <span class="s1">for </span><span class="s2">(</span><span class="s1">let </span><span class="s2">value of conditions) {</span>
      <span class="s2">validateStringValue(value</span><span class="s1">, </span><span class="s0">&quot;condition&quot;</span><span class="s2">)</span><span class="s1">;</span>
      <span class="s1">if </span><span class="s2">(value.indexOf(</span><span class="s0">&quot;,&quot;</span><span class="s2">) &gt;= </span><span class="s4">0</span><span class="s2">)</span>
        <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">`Invalid condition: </span><span class="s2">${value}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
      <span class="s2">values.push(value)</span><span class="s1">;</span>
    <span class="s2">}</span>
    <span class="s2">flags.push(</span><span class="s0">`--conditions=</span><span class="s2">${values.join(</span><span class="s0">&quot;,&quot;</span><span class="s2">)}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s2">}</span>
  <span class="s1">if </span><span class="s2">(external)</span>
    <span class="s1">for </span><span class="s2">(</span><span class="s1">let </span><span class="s2">name of external)</span>
      <span class="s2">flags.push(</span><span class="s0">`--external:</span><span class="s2">${validateStringValue(name</span><span class="s1">, </span><span class="s0">&quot;external&quot;</span><span class="s2">)}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(alias) {</span>
    <span class="s1">for </span><span class="s2">(</span><span class="s1">let </span><span class="s2">old </span><span class="s1">in </span><span class="s2">alias) {</span>
      <span class="s1">if </span><span class="s2">(old.indexOf(</span><span class="s0">&quot;=&quot;</span><span class="s2">) &gt;= </span><span class="s4">0</span><span class="s2">)</span>
        <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">`Invalid package name in alias: </span><span class="s2">${old}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
      <span class="s2">flags.push(</span><span class="s0">`--alias:</span><span class="s2">${old}</span><span class="s0">=</span><span class="s2">${validateStringValue(alias[old]</span><span class="s1">, </span><span class="s0">&quot;alias&quot;</span><span class="s1">, </span><span class="s2">old)}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
    <span class="s2">}</span>
  <span class="s2">}</span>
  <span class="s1">if </span><span class="s2">(banner) {</span>
    <span class="s1">for </span><span class="s2">(</span><span class="s1">let </span><span class="s2">type </span><span class="s1">in </span><span class="s2">banner) {</span>
      <span class="s1">if </span><span class="s2">(type.indexOf(</span><span class="s0">&quot;=&quot;</span><span class="s2">) &gt;= </span><span class="s4">0</span><span class="s2">)</span>
        <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">`Invalid banner file type: </span><span class="s2">${type}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
      <span class="s2">flags.push(</span><span class="s0">`--banner:</span><span class="s2">${type}</span><span class="s0">=</span><span class="s2">${validateStringValue(banner[type]</span><span class="s1">, </span><span class="s0">&quot;banner&quot;</span><span class="s1">, </span><span class="s2">type)}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
    <span class="s2">}</span>
  <span class="s2">}</span>
  <span class="s1">if </span><span class="s2">(footer) {</span>
    <span class="s1">for </span><span class="s2">(</span><span class="s1">let </span><span class="s2">type </span><span class="s1">in </span><span class="s2">footer) {</span>
      <span class="s1">if </span><span class="s2">(type.indexOf(</span><span class="s0">&quot;=&quot;</span><span class="s2">) &gt;= </span><span class="s4">0</span><span class="s2">)</span>
        <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">`Invalid footer file type: </span><span class="s2">${type}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
      <span class="s2">flags.push(</span><span class="s0">`--footer:</span><span class="s2">${type}</span><span class="s0">=</span><span class="s2">${validateStringValue(footer[type]</span><span class="s1">, </span><span class="s0">&quot;footer&quot;</span><span class="s1">, </span><span class="s2">type)}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
    <span class="s2">}</span>
  <span class="s2">}</span>
  <span class="s1">if </span><span class="s2">(inject)</span>
    <span class="s1">for </span><span class="s2">(</span><span class="s1">let </span><span class="s2">path3 of inject)</span>
      <span class="s2">flags.push(</span><span class="s0">`--inject:</span><span class="s2">${validateStringValue(path3</span><span class="s1">, </span><span class="s0">&quot;inject&quot;</span><span class="s2">)}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(loader) {</span>
    <span class="s1">for </span><span class="s2">(</span><span class="s1">let </span><span class="s2">ext </span><span class="s1">in </span><span class="s2">loader) {</span>
      <span class="s1">if </span><span class="s2">(ext.indexOf(</span><span class="s0">&quot;=&quot;</span><span class="s2">) &gt;= </span><span class="s4">0</span><span class="s2">)</span>
        <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">`Invalid loader extension: </span><span class="s2">${ext}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
      <span class="s2">flags.push(</span><span class="s0">`--loader:</span><span class="s2">${ext}</span><span class="s0">=</span><span class="s2">${validateStringValue(loader[ext]</span><span class="s1">, </span><span class="s0">&quot;loader&quot;</span><span class="s1">, </span><span class="s2">ext)}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
    <span class="s2">}</span>
  <span class="s2">}</span>
  <span class="s1">if </span><span class="s2">(outExtension) {</span>
    <span class="s1">for </span><span class="s2">(</span><span class="s1">let </span><span class="s2">ext </span><span class="s1">in </span><span class="s2">outExtension) {</span>
      <span class="s1">if </span><span class="s2">(ext.indexOf(</span><span class="s0">&quot;=&quot;</span><span class="s2">) &gt;= </span><span class="s4">0</span><span class="s2">)</span>
        <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">`Invalid out extension: </span><span class="s2">${ext}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
      <span class="s2">flags.push(</span><span class="s0">`--out-extension:</span><span class="s2">${ext}</span><span class="s0">=</span><span class="s2">${validateStringValue(outExtension[ext]</span><span class="s1">, </span><span class="s0">&quot;out extension&quot;</span><span class="s1">, </span><span class="s2">ext)}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
    <span class="s2">}</span>
  <span class="s2">}</span>
  <span class="s1">if </span><span class="s2">(entryPoints) {</span>
    <span class="s1">if </span><span class="s2">(Array.isArray(entryPoints)) {</span>
      <span class="s1">for </span><span class="s2">(</span><span class="s1">let </span><span class="s2">i = </span><span class="s4">0</span><span class="s1">, </span><span class="s2">n = entryPoints.length</span><span class="s1">; </span><span class="s2">i &lt; n</span><span class="s1">; </span><span class="s2">i++) {</span>
        <span class="s1">let </span><span class="s2">entryPoint = entryPoints[i]</span><span class="s1">;</span>
        <span class="s1">if </span><span class="s2">(</span><span class="s1">typeof </span><span class="s2">entryPoint === </span><span class="s0">&quot;object&quot; </span><span class="s2">&amp;&amp; entryPoint !== </span><span class="s1">null</span><span class="s2">) {</span>
          <span class="s1">let </span><span class="s2">entryPointKeys = </span><span class="s3">/* @__PURE__ */ </span><span class="s2">Object.create(</span><span class="s1">null</span><span class="s2">)</span><span class="s1">;</span>
          <span class="s1">let </span><span class="s2">input = getFlag(entryPoint</span><span class="s1">, </span><span class="s2">entryPointKeys</span><span class="s1">, </span><span class="s0">&quot;in&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
          <span class="s1">let </span><span class="s2">output = getFlag(entryPoint</span><span class="s1">, </span><span class="s2">entryPointKeys</span><span class="s1">, </span><span class="s0">&quot;out&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
          <span class="s2">checkForInvalidFlags(entryPoint</span><span class="s1">, </span><span class="s2">entryPointKeys</span><span class="s1">, </span><span class="s0">&quot;in entry point at index &quot; </span><span class="s2">+ i)</span><span class="s1">;</span>
          <span class="s1">if </span><span class="s2">(input === </span><span class="s1">void </span><span class="s4">0</span><span class="s2">)</span>
            <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">'Missing property &quot;in&quot; for entry point at index ' </span><span class="s2">+ i)</span><span class="s1">;</span>
          <span class="s1">if </span><span class="s2">(output === </span><span class="s1">void </span><span class="s4">0</span><span class="s2">)</span>
            <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">'Missing property &quot;out&quot; for entry point at index ' </span><span class="s2">+ i)</span><span class="s1">;</span>
          <span class="s2">entries.push([output</span><span class="s1">, </span><span class="s2">input])</span><span class="s1">;</span>
        <span class="s2">} </span><span class="s1">else </span><span class="s2">{</span>
          <span class="s2">entries.push([</span><span class="s0">&quot;&quot;</span><span class="s1">, </span><span class="s2">validateStringValue(entryPoint</span><span class="s1">, </span><span class="s0">&quot;entry point at index &quot; </span><span class="s2">+ i)])</span><span class="s1">;</span>
        <span class="s2">}</span>
      <span class="s2">}</span>
    <span class="s2">} </span><span class="s1">else </span><span class="s2">{</span>
      <span class="s1">for </span><span class="s2">(</span><span class="s1">let </span><span class="s2">key </span><span class="s1">in </span><span class="s2">entryPoints) {</span>
        <span class="s2">entries.push([key</span><span class="s1">, </span><span class="s2">validateStringValue(entryPoints[key]</span><span class="s1">, </span><span class="s0">&quot;entry point&quot;</span><span class="s1">, </span><span class="s2">key)])</span><span class="s1">;</span>
      <span class="s2">}</span>
    <span class="s2">}</span>
  <span class="s2">}</span>
  <span class="s1">if </span><span class="s2">(stdin) {</span>
    <span class="s1">let </span><span class="s2">stdinKeys = </span><span class="s3">/* @__PURE__ */ </span><span class="s2">Object.create(</span><span class="s1">null</span><span class="s2">)</span><span class="s1">;</span>
    <span class="s1">let </span><span class="s2">contents = getFlag(stdin</span><span class="s1">, </span><span class="s2">stdinKeys</span><span class="s1">, </span><span class="s0">&quot;contents&quot;</span><span class="s1">, </span><span class="s2">mustBeStringOrUint8Array)</span><span class="s1">;</span>
    <span class="s1">let </span><span class="s2">resolveDir = getFlag(stdin</span><span class="s1">, </span><span class="s2">stdinKeys</span><span class="s1">, </span><span class="s0">&quot;resolveDir&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
    <span class="s1">let </span><span class="s2">sourcefile = getFlag(stdin</span><span class="s1">, </span><span class="s2">stdinKeys</span><span class="s1">, </span><span class="s0">&quot;sourcefile&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
    <span class="s1">let </span><span class="s2">loader2 = getFlag(stdin</span><span class="s1">, </span><span class="s2">stdinKeys</span><span class="s1">, </span><span class="s0">&quot;loader&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
    <span class="s2">checkForInvalidFlags(stdin</span><span class="s1">, </span><span class="s2">stdinKeys</span><span class="s1">, </span><span class="s0">'in &quot;stdin&quot; object'</span><span class="s2">)</span><span class="s1">;</span>
    <span class="s1">if </span><span class="s2">(sourcefile)</span>
      <span class="s2">flags.push(</span><span class="s0">`--sourcefile=</span><span class="s2">${sourcefile}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
    <span class="s1">if </span><span class="s2">(loader2)</span>
      <span class="s2">flags.push(</span><span class="s0">`--loader=</span><span class="s2">${loader2}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
    <span class="s1">if </span><span class="s2">(resolveDir)</span>
      <span class="s2">stdinResolveDir = resolveDir</span><span class="s1">;</span>
    <span class="s1">if </span><span class="s2">(</span><span class="s1">typeof </span><span class="s2">contents === </span><span class="s0">&quot;string&quot;</span><span class="s2">)</span>
      <span class="s2">stdinContents = encodeUTF8(contents)</span><span class="s1">;</span>
    <span class="s1">else if </span><span class="s2">(contents </span><span class="s1">instanceof </span><span class="s2">Uint8Array)</span>
      <span class="s2">stdinContents = contents</span><span class="s1">;</span>
  <span class="s2">}</span>
  <span class="s1">let </span><span class="s2">nodePaths = []</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(nodePathsInput) {</span>
    <span class="s1">for </span><span class="s2">(</span><span class="s1">let </span><span class="s2">value of nodePathsInput) {</span>
      <span class="s2">value += </span><span class="s0">&quot;&quot;</span><span class="s1">;</span>
      <span class="s2">nodePaths.push(value)</span><span class="s1">;</span>
    <span class="s2">}</span>
  <span class="s2">}</span>
  <span class="s1">return </span><span class="s2">{</span>
    <span class="s2">entries</span><span class="s1">,</span>
    <span class="s2">flags</span><span class="s1">,</span>
    <span class="s2">write</span><span class="s1">,</span>
    <span class="s2">stdinContents</span><span class="s1">,</span>
    <span class="s2">stdinResolveDir</span><span class="s1">,</span>
    <span class="s2">absWorkingDir</span><span class="s1">,</span>
    <span class="s2">nodePaths</span><span class="s1">,</span>
    <span class="s2">mangleCache: validateMangleCache(mangleCache)</span>
  <span class="s2">}</span><span class="s1">;</span>
<span class="s2">}</span>
<span class="s1">function </span><span class="s2">flagsForTransformOptions(callName</span><span class="s1">, </span><span class="s2">options</span><span class="s1">, </span><span class="s2">isTTY2</span><span class="s1">, </span><span class="s2">logLevelDefault) {</span>
  <span class="s1">let </span><span class="s2">flags = []</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">keys = </span><span class="s3">/* @__PURE__ */ </span><span class="s2">Object.create(</span><span class="s1">null</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s2">pushLogFlags(flags</span><span class="s1">, </span><span class="s2">options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s2">isTTY2</span><span class="s1">, </span><span class="s2">logLevelDefault)</span><span class="s1">;</span>
  <span class="s2">pushCommonFlags(flags</span><span class="s1">, </span><span class="s2">options</span><span class="s1">, </span><span class="s2">keys)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">sourcemap = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;sourcemap&quot;</span><span class="s1">, </span><span class="s2">mustBeStringOrBoolean)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">tsconfigRaw = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;tsconfigRaw&quot;</span><span class="s1">, </span><span class="s2">mustBeStringOrObject)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">sourcefile = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;sourcefile&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">loader = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;loader&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">banner = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;banner&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">footer = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;footer&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">mangleCache = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;mangleCache&quot;</span><span class="s1">, </span><span class="s2">mustBeObject)</span><span class="s1">;</span>
  <span class="s2">checkForInvalidFlags(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">`in </span><span class="s2">${callName}</span><span class="s0">() call`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(sourcemap)</span>
    <span class="s2">flags.push(</span><span class="s0">`--sourcemap=</span><span class="s2">${sourcemap === </span><span class="s1">true </span><span class="s2">? </span><span class="s0">&quot;external&quot; </span><span class="s2">: sourcemap}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(tsconfigRaw)</span>
    <span class="s2">flags.push(</span><span class="s0">`--tsconfig-raw=</span><span class="s2">${</span><span class="s1">typeof </span><span class="s2">tsconfigRaw === </span><span class="s0">&quot;string&quot; </span><span class="s2">? tsconfigRaw : JSON.stringify(tsconfigRaw)}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(sourcefile)</span>
    <span class="s2">flags.push(</span><span class="s0">`--sourcefile=</span><span class="s2">${sourcefile}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(loader)</span>
    <span class="s2">flags.push(</span><span class="s0">`--loader=</span><span class="s2">${loader}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(banner)</span>
    <span class="s2">flags.push(</span><span class="s0">`--banner=</span><span class="s2">${banner}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(footer)</span>
    <span class="s2">flags.push(</span><span class="s0">`--footer=</span><span class="s2">${footer}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">return </span><span class="s2">{</span>
    <span class="s2">flags</span><span class="s1">,</span>
    <span class="s2">mangleCache: validateMangleCache(mangleCache)</span>
  <span class="s2">}</span><span class="s1">;</span>
<span class="s2">}</span>
<span class="s1">function </span><span class="s2">createChannel(streamIn) {</span>
  <span class="s1">const </span><span class="s2">requestCallbacksByKey = {}</span><span class="s1">;</span>
  <span class="s1">const </span><span class="s2">closeData = { didClose: </span><span class="s1">false, </span><span class="s2">reason: </span><span class="s0">&quot;&quot; </span><span class="s2">}</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">responseCallbacks = {}</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">nextRequestID = </span><span class="s4">0</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">nextBuildKey = </span><span class="s4">0</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">stdout = </span><span class="s1">new </span><span class="s2">Uint8Array(</span><span class="s4">16 </span><span class="s2">* </span><span class="s4">1024</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">stdoutUsed = </span><span class="s4">0</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">readFromStdout = (chunk) =&gt; {</span>
    <span class="s1">let </span><span class="s2">limit = stdoutUsed + chunk.length</span><span class="s1">;</span>
    <span class="s1">if </span><span class="s2">(limit &gt; stdout.length) {</span>
      <span class="s1">let </span><span class="s2">swap = </span><span class="s1">new </span><span class="s2">Uint8Array(limit * </span><span class="s4">2</span><span class="s2">)</span><span class="s1">;</span>
      <span class="s2">swap.set(stdout)</span><span class="s1">;</span>
      <span class="s2">stdout = swap</span><span class="s1">;</span>
    <span class="s2">}</span>
    <span class="s2">stdout.set(chunk</span><span class="s1">, </span><span class="s2">stdoutUsed)</span><span class="s1">;</span>
    <span class="s2">stdoutUsed += chunk.length</span><span class="s1">;</span>
    <span class="s1">let </span><span class="s2">offset = </span><span class="s4">0</span><span class="s1">;</span>
    <span class="s1">while </span><span class="s2">(offset + </span><span class="s4">4 </span><span class="s2">&lt;= stdoutUsed) {</span>
      <span class="s1">let </span><span class="s2">length = readUInt32LE(stdout</span><span class="s1">, </span><span class="s2">offset)</span><span class="s1">;</span>
      <span class="s1">if </span><span class="s2">(offset + </span><span class="s4">4 </span><span class="s2">+ length &gt; stdoutUsed) {</span>
        <span class="s1">break;</span>
      <span class="s2">}</span>
      <span class="s2">offset += </span><span class="s4">4</span><span class="s1">;</span>
      <span class="s2">handleIncomingPacket(stdout.subarray(offset</span><span class="s1">, </span><span class="s2">offset + length))</span><span class="s1">;</span>
      <span class="s2">offset += length</span><span class="s1">;</span>
    <span class="s2">}</span>
    <span class="s1">if </span><span class="s2">(offset &gt; </span><span class="s4">0</span><span class="s2">) {</span>
      <span class="s2">stdout.copyWithin(</span><span class="s4">0</span><span class="s1">, </span><span class="s2">offset</span><span class="s1">, </span><span class="s2">stdoutUsed)</span><span class="s1">;</span>
      <span class="s2">stdoutUsed -= offset</span><span class="s1">;</span>
    <span class="s2">}</span>
  <span class="s2">}</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">afterClose = (error) =&gt; {</span>
    <span class="s2">closeData.didClose = </span><span class="s1">true;</span>
    <span class="s1">if </span><span class="s2">(error)</span>
      <span class="s2">closeData.reason = </span><span class="s0">&quot;: &quot; </span><span class="s2">+ (error.message || error)</span><span class="s1">;</span>
    <span class="s1">const </span><span class="s2">text = </span><span class="s0">&quot;The service was stopped&quot; </span><span class="s2">+ closeData.reason</span><span class="s1">;</span>
    <span class="s1">for </span><span class="s2">(</span><span class="s1">let </span><span class="s2">id </span><span class="s1">in </span><span class="s2">responseCallbacks) {</span>
      <span class="s2">responseCallbacks[id](text</span><span class="s1">, null</span><span class="s2">)</span><span class="s1">;</span>
    <span class="s2">}</span>
    <span class="s2">responseCallbacks = {}</span><span class="s1">;</span>
  <span class="s2">}</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">sendRequest = (refs</span><span class="s1">, </span><span class="s2">value</span><span class="s1">, </span><span class="s2">callback) =&gt; {</span>
    <span class="s1">if </span><span class="s2">(closeData.didClose)</span>
      <span class="s1">return </span><span class="s2">callback(</span><span class="s0">&quot;The service is no longer running&quot; </span><span class="s2">+ closeData.reason</span><span class="s1">, null</span><span class="s2">)</span><span class="s1">;</span>
    <span class="s1">let </span><span class="s2">id = nextRequestID++</span><span class="s1">;</span>
    <span class="s2">responseCallbacks[id] = (error</span><span class="s1">, </span><span class="s2">response) =&gt; {</span>
      <span class="s1">try </span><span class="s2">{</span>
        <span class="s2">callback(error</span><span class="s1">, </span><span class="s2">response)</span><span class="s1">;</span>
      <span class="s2">} </span><span class="s1">finally </span><span class="s2">{</span>
        <span class="s1">if </span><span class="s2">(refs)</span>
          <span class="s2">refs.unref()</span><span class="s1">;</span>
      <span class="s2">}</span>
    <span class="s2">}</span><span class="s1">;</span>
    <span class="s1">if </span><span class="s2">(refs)</span>
      <span class="s2">refs.ref()</span><span class="s1">;</span>
    <span class="s2">streamIn.writeToStdin(encodePacket({ id</span><span class="s1">, </span><span class="s2">isRequest: </span><span class="s1">true, </span><span class="s2">value }))</span><span class="s1">;</span>
  <span class="s2">}</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">sendResponse = (id</span><span class="s1">, </span><span class="s2">value) =&gt; {</span>
    <span class="s1">if </span><span class="s2">(closeData.didClose)</span>
      <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">&quot;The service is no longer running&quot; </span><span class="s2">+ closeData.reason)</span><span class="s1">;</span>
    <span class="s2">streamIn.writeToStdin(encodePacket({ id</span><span class="s1">, </span><span class="s2">isRequest: </span><span class="s1">false, </span><span class="s2">value }))</span><span class="s1">;</span>
  <span class="s2">}</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">handleRequest = async (id</span><span class="s1">, </span><span class="s2">request) =&gt; {</span>
    <span class="s1">try </span><span class="s2">{</span>
      <span class="s1">if </span><span class="s2">(request.command === </span><span class="s0">&quot;ping&quot;</span><span class="s2">) {</span>
        <span class="s2">sendResponse(id</span><span class="s1">, </span><span class="s2">{})</span><span class="s1">;</span>
        <span class="s1">return;</span>
      <span class="s2">}</span>
      <span class="s1">if </span><span class="s2">(</span><span class="s1">typeof </span><span class="s2">request.key === </span><span class="s0">&quot;number&quot;</span><span class="s2">) {</span>
        <span class="s1">const </span><span class="s2">requestCallbacks = requestCallbacksByKey[request.key]</span><span class="s1">;</span>
        <span class="s1">if </span><span class="s2">(requestCallbacks) {</span>
          <span class="s1">const </span><span class="s2">callback = requestCallbacks[request.command]</span><span class="s1">;</span>
          <span class="s1">if </span><span class="s2">(callback) {</span>
            <span class="s1">await </span><span class="s2">callback(id</span><span class="s1">, </span><span class="s2">request)</span><span class="s1">;</span>
            <span class="s1">return;</span>
          <span class="s2">}</span>
        <span class="s2">}</span>
      <span class="s2">}</span>
      <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">`Invalid command: ` </span><span class="s2">+ request.command)</span><span class="s1">;</span>
    <span class="s2">} </span><span class="s1">catch </span><span class="s2">(e) {</span>
      <span class="s2">sendResponse(id</span><span class="s1">, </span><span class="s2">{ errors: [extractErrorMessageV8(e</span><span class="s1">, </span><span class="s2">streamIn</span><span class="s1">, null, void </span><span class="s4">0</span><span class="s1">, </span><span class="s0">&quot;&quot;</span><span class="s2">)] })</span><span class="s1">;</span>
    <span class="s2">}</span>
  <span class="s2">}</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">isFirstPacket = </span><span class="s1">true;</span>
  <span class="s1">let </span><span class="s2">handleIncomingPacket = (bytes) =&gt; {</span>
    <span class="s1">if </span><span class="s2">(isFirstPacket) {</span>
      <span class="s2">isFirstPacket = </span><span class="s1">false;</span>
      <span class="s1">let </span><span class="s2">binaryVersion = String.fromCharCode(...bytes)</span><span class="s1">;</span>
      <span class="s1">if </span><span class="s2">(binaryVersion !== </span><span class="s0">&quot;0.17.18&quot;</span><span class="s2">) {</span>
        <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">`Cannot start service: Host version &quot;</span><span class="s2">${</span><span class="s0">&quot;0.17.18&quot;</span><span class="s2">}</span><span class="s0">&quot; does not match binary version </span><span class="s2">${quote(binaryVersion)}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
      <span class="s2">}</span>
      <span class="s1">return;</span>
    <span class="s2">}</span>
    <span class="s1">let </span><span class="s2">packet = decodePacket(bytes)</span><span class="s1">;</span>
    <span class="s1">if </span><span class="s2">(packet.isRequest) {</span>
      <span class="s2">handleRequest(packet.id</span><span class="s1">, </span><span class="s2">packet.value)</span><span class="s1">;</span>
    <span class="s2">} </span><span class="s1">else </span><span class="s2">{</span>
      <span class="s1">let </span><span class="s2">callback = responseCallbacks[packet.id]</span><span class="s1">;</span>
      <span class="s1">delete </span><span class="s2">responseCallbacks[packet.id]</span><span class="s1">;</span>
      <span class="s1">if </span><span class="s2">(packet.value.error)</span>
        <span class="s2">callback(packet.value.error</span><span class="s1">, </span><span class="s2">{})</span><span class="s1">;</span>
      <span class="s1">else</span>
        <span class="s2">callback(</span><span class="s1">null, </span><span class="s2">packet.value)</span><span class="s1">;</span>
    <span class="s2">}</span>
  <span class="s2">}</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">buildOrContext = ({ callName</span><span class="s1">, </span><span class="s2">refs</span><span class="s1">, </span><span class="s2">options</span><span class="s1">, </span><span class="s2">isTTY: isTTY2</span><span class="s1">, </span><span class="s2">defaultWD: defaultWD2</span><span class="s1">, </span><span class="s2">callback }) =&gt; {</span>
    <span class="s1">let </span><span class="s2">refCount = </span><span class="s4">0</span><span class="s1">;</span>
    <span class="s1">const </span><span class="s2">buildKey = nextBuildKey++</span><span class="s1">;</span>
    <span class="s1">const </span><span class="s2">requestCallbacks = {}</span><span class="s1">;</span>
    <span class="s1">const </span><span class="s2">buildRefs = {</span>
      <span class="s2">ref() {</span>
        <span class="s1">if </span><span class="s2">(++refCount === </span><span class="s4">1</span><span class="s2">) {</span>
          <span class="s1">if </span><span class="s2">(refs)</span>
            <span class="s2">refs.ref()</span><span class="s1">;</span>
        <span class="s2">}</span>
      <span class="s2">}</span><span class="s1">,</span>
      <span class="s2">unref() {</span>
        <span class="s1">if </span><span class="s2">(--refCount === </span><span class="s4">0</span><span class="s2">) {</span>
          <span class="s1">delete </span><span class="s2">requestCallbacksByKey[buildKey]</span><span class="s1">;</span>
          <span class="s1">if </span><span class="s2">(refs)</span>
            <span class="s2">refs.unref()</span><span class="s1">;</span>
        <span class="s2">}</span>
      <span class="s2">}</span>
    <span class="s2">}</span><span class="s1">;</span>
    <span class="s2">requestCallbacksByKey[buildKey] = requestCallbacks</span><span class="s1">;</span>
    <span class="s2">buildRefs.ref()</span><span class="s1">;</span>
    <span class="s2">buildOrContextImpl(</span>
      <span class="s2">callName</span><span class="s1">,</span>
      <span class="s2">buildKey</span><span class="s1">,</span>
      <span class="s2">sendRequest</span><span class="s1">,</span>
      <span class="s2">sendResponse</span><span class="s1">,</span>
      <span class="s2">buildRefs</span><span class="s1">,</span>
      <span class="s2">streamIn</span><span class="s1">,</span>
      <span class="s2">requestCallbacks</span><span class="s1">,</span>
      <span class="s2">options</span><span class="s1">,</span>
      <span class="s2">isTTY2</span><span class="s1">,</span>
      <span class="s2">defaultWD2</span><span class="s1">,</span>
      <span class="s2">(err</span><span class="s1">, </span><span class="s2">res) =&gt; {</span>
        <span class="s1">try </span><span class="s2">{</span>
          <span class="s2">callback(err</span><span class="s1">, </span><span class="s2">res)</span><span class="s1">;</span>
        <span class="s2">} </span><span class="s1">finally </span><span class="s2">{</span>
          <span class="s2">buildRefs.unref()</span><span class="s1">;</span>
        <span class="s2">}</span>
      <span class="s2">}</span>
    <span class="s2">)</span><span class="s1">;</span>
  <span class="s2">}</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">transform2 = ({ callName</span><span class="s1">, </span><span class="s2">refs</span><span class="s1">, </span><span class="s2">input</span><span class="s1">, </span><span class="s2">options</span><span class="s1">, </span><span class="s2">isTTY: isTTY2</span><span class="s1">, </span><span class="s2">fs: fs3</span><span class="s1">, </span><span class="s2">callback }) =&gt; {</span>
    <span class="s1">const </span><span class="s2">details = createObjectStash()</span><span class="s1">;</span>
    <span class="s1">let </span><span class="s2">start = (inputPath) =&gt; {</span>
      <span class="s1">try </span><span class="s2">{</span>
        <span class="s1">if </span><span class="s2">(</span><span class="s1">typeof </span><span class="s2">input !== </span><span class="s0">&quot;string&quot; </span><span class="s2">&amp;&amp; !(input </span><span class="s1">instanceof </span><span class="s2">Uint8Array))</span>
          <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">'The input to &quot;transform&quot; must be a string or a Uint8Array'</span><span class="s2">)</span><span class="s1">;</span>
        <span class="s1">let </span><span class="s2">{</span>
          <span class="s2">flags</span><span class="s1">,</span>
          <span class="s2">mangleCache</span>
        <span class="s2">} = flagsForTransformOptions(callName</span><span class="s1">, </span><span class="s2">options</span><span class="s1">, </span><span class="s2">isTTY2</span><span class="s1">, </span><span class="s2">transformLogLevelDefault)</span><span class="s1">;</span>
        <span class="s1">let </span><span class="s2">request = {</span>
          <span class="s2">command: </span><span class="s0">&quot;transform&quot;</span><span class="s1">,</span>
          <span class="s2">flags</span><span class="s1">,</span>
          <span class="s2">inputFS: inputPath !== </span><span class="s1">null,</span>
          <span class="s2">input: inputPath !== </span><span class="s1">null </span><span class="s2">? encodeUTF8(inputPath) : </span><span class="s1">typeof </span><span class="s2">input === </span><span class="s0">&quot;string&quot; </span><span class="s2">? encodeUTF8(input) : input</span>
        <span class="s2">}</span><span class="s1">;</span>
        <span class="s1">if </span><span class="s2">(mangleCache)</span>
          <span class="s2">request.mangleCache = mangleCache</span><span class="s1">;</span>
        <span class="s2">sendRequest(refs</span><span class="s1">, </span><span class="s2">request</span><span class="s1">, </span><span class="s2">(error</span><span class="s1">, </span><span class="s2">response) =&gt; {</span>
          <span class="s1">if </span><span class="s2">(error)</span>
            <span class="s1">return </span><span class="s2">callback(</span><span class="s1">new </span><span class="s2">Error(error)</span><span class="s1">, null</span><span class="s2">)</span><span class="s1">;</span>
          <span class="s1">let </span><span class="s2">errors = replaceDetailsInMessages(response.errors</span><span class="s1">, </span><span class="s2">details)</span><span class="s1">;</span>
          <span class="s1">let </span><span class="s2">warnings = replaceDetailsInMessages(response.warnings</span><span class="s1">, </span><span class="s2">details)</span><span class="s1">;</span>
          <span class="s1">let </span><span class="s2">outstanding = </span><span class="s4">1</span><span class="s1">;</span>
          <span class="s1">let </span><span class="s2">next = () =&gt; {</span>
            <span class="s1">if </span><span class="s2">(--outstanding === </span><span class="s4">0</span><span class="s2">) {</span>
              <span class="s1">let </span><span class="s2">result = {</span>
                <span class="s2">warnings</span><span class="s1">,</span>
                <span class="s2">code: response.code</span><span class="s1">,</span>
                <span class="s2">map: response.map</span><span class="s1">,</span>
                <span class="s2">mangleCache: </span><span class="s1">void </span><span class="s4">0</span><span class="s1">,</span>
                <span class="s2">legalComments: </span><span class="s1">void </span><span class="s4">0</span>
              <span class="s2">}</span><span class="s1">;</span>
              <span class="s1">if </span><span class="s2">(</span><span class="s0">&quot;legalComments&quot; </span><span class="s1">in </span><span class="s2">response)</span>
                <span class="s2">result.legalComments = response == </span><span class="s1">null </span><span class="s2">? </span><span class="s1">void </span><span class="s4">0 </span><span class="s2">: response.legalComments</span><span class="s1">;</span>
              <span class="s1">if </span><span class="s2">(response.mangleCache)</span>
                <span class="s2">result.mangleCache = response == </span><span class="s1">null </span><span class="s2">? </span><span class="s1">void </span><span class="s4">0 </span><span class="s2">: response.mangleCache</span><span class="s1">;</span>
              <span class="s2">callback(</span><span class="s1">null, </span><span class="s2">result)</span><span class="s1">;</span>
            <span class="s2">}</span>
          <span class="s2">}</span><span class="s1">;</span>
          <span class="s1">if </span><span class="s2">(errors.length &gt; </span><span class="s4">0</span><span class="s2">)</span>
            <span class="s1">return </span><span class="s2">callback(failureErrorWithLog(</span><span class="s0">&quot;Transform failed&quot;</span><span class="s1">, </span><span class="s2">errors</span><span class="s1">, </span><span class="s2">warnings)</span><span class="s1">, null</span><span class="s2">)</span><span class="s1">;</span>
          <span class="s1">if </span><span class="s2">(response.codeFS) {</span>
            <span class="s2">outstanding++</span><span class="s1">;</span>
            <span class="s2">fs3.readFile(response.code</span><span class="s1">, </span><span class="s2">(err</span><span class="s1">, </span><span class="s2">contents) =&gt; {</span>
              <span class="s1">if </span><span class="s2">(err !== </span><span class="s1">null</span><span class="s2">) {</span>
                <span class="s2">callback(err</span><span class="s1">, null</span><span class="s2">)</span><span class="s1">;</span>
              <span class="s2">} </span><span class="s1">else </span><span class="s2">{</span>
                <span class="s2">response.code = contents</span><span class="s1">;</span>
                <span class="s2">next()</span><span class="s1">;</span>
              <span class="s2">}</span>
            <span class="s2">})</span><span class="s1">;</span>
          <span class="s2">}</span>
          <span class="s1">if </span><span class="s2">(response.mapFS) {</span>
            <span class="s2">outstanding++</span><span class="s1">;</span>
            <span class="s2">fs3.readFile(response.map</span><span class="s1">, </span><span class="s2">(err</span><span class="s1">, </span><span class="s2">contents) =&gt; {</span>
              <span class="s1">if </span><span class="s2">(err !== </span><span class="s1">null</span><span class="s2">) {</span>
                <span class="s2">callback(err</span><span class="s1">, null</span><span class="s2">)</span><span class="s1">;</span>
              <span class="s2">} </span><span class="s1">else </span><span class="s2">{</span>
                <span class="s2">response.map = contents</span><span class="s1">;</span>
                <span class="s2">next()</span><span class="s1">;</span>
              <span class="s2">}</span>
            <span class="s2">})</span><span class="s1">;</span>
          <span class="s2">}</span>
          <span class="s2">next()</span><span class="s1">;</span>
        <span class="s2">})</span><span class="s1">;</span>
      <span class="s2">} </span><span class="s1">catch </span><span class="s2">(e) {</span>
        <span class="s1">let </span><span class="s2">flags = []</span><span class="s1">;</span>
        <span class="s1">try </span><span class="s2">{</span>
          <span class="s2">pushLogFlags(flags</span><span class="s1">, </span><span class="s2">options</span><span class="s1">, </span><span class="s2">{}</span><span class="s1">, </span><span class="s2">isTTY2</span><span class="s1">, </span><span class="s2">transformLogLevelDefault)</span><span class="s1">;</span>
        <span class="s2">} </span><span class="s1">catch </span><span class="s2">{</span>
        <span class="s2">}</span>
        <span class="s1">const </span><span class="s2">error = extractErrorMessageV8(e</span><span class="s1">, </span><span class="s2">streamIn</span><span class="s1">, </span><span class="s2">details</span><span class="s1">, void </span><span class="s4">0</span><span class="s1">, </span><span class="s0">&quot;&quot;</span><span class="s2">)</span><span class="s1">;</span>
        <span class="s2">sendRequest(refs</span><span class="s1">, </span><span class="s2">{ command: </span><span class="s0">&quot;error&quot;</span><span class="s1">, </span><span class="s2">flags</span><span class="s1">, </span><span class="s2">error }</span><span class="s1">, </span><span class="s2">() =&gt; {</span>
          <span class="s2">error.detail = details.load(error.detail)</span><span class="s1">;</span>
          <span class="s2">callback(failureErrorWithLog(</span><span class="s0">&quot;Transform failed&quot;</span><span class="s1">, </span><span class="s2">[error]</span><span class="s1">, </span><span class="s2">[])</span><span class="s1">, null</span><span class="s2">)</span><span class="s1">;</span>
        <span class="s2">})</span><span class="s1">;</span>
      <span class="s2">}</span>
    <span class="s2">}</span><span class="s1">;</span>
    <span class="s1">if </span><span class="s2">((</span><span class="s1">typeof </span><span class="s2">input === </span><span class="s0">&quot;string&quot; </span><span class="s2">|| input </span><span class="s1">instanceof </span><span class="s2">Uint8Array) &amp;&amp; input.length &gt; </span><span class="s4">1024 </span><span class="s2">* </span><span class="s4">1024</span><span class="s2">) {</span>
      <span class="s1">let </span><span class="s2">next = start</span><span class="s1">;</span>
      <span class="s2">start = () =&gt; fs3.writeFile(input</span><span class="s1">, </span><span class="s2">next)</span><span class="s1">;</span>
    <span class="s2">}</span>
    <span class="s2">start(</span><span class="s1">null</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s2">}</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">formatMessages2 = ({ callName</span><span class="s1">, </span><span class="s2">refs</span><span class="s1">, </span><span class="s2">messages</span><span class="s1">, </span><span class="s2">options</span><span class="s1">, </span><span class="s2">callback }) =&gt; {</span>
    <span class="s1">let </span><span class="s2">result = sanitizeMessages(messages</span><span class="s1">, </span><span class="s0">&quot;messages&quot;</span><span class="s1">, null, </span><span class="s0">&quot;&quot;</span><span class="s2">)</span><span class="s1">;</span>
    <span class="s1">if </span><span class="s2">(!options)</span>
      <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">`Missing second argument in </span><span class="s2">${callName}</span><span class="s0">() call`</span><span class="s2">)</span><span class="s1">;</span>
    <span class="s1">let </span><span class="s2">keys = {}</span><span class="s1">;</span>
    <span class="s1">let </span><span class="s2">kind = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;kind&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
    <span class="s1">let </span><span class="s2">color = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;color&quot;</span><span class="s1">, </span><span class="s2">mustBeBoolean)</span><span class="s1">;</span>
    <span class="s1">let </span><span class="s2">terminalWidth = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;terminalWidth&quot;</span><span class="s1">, </span><span class="s2">mustBeInteger)</span><span class="s1">;</span>
    <span class="s2">checkForInvalidFlags(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">`in </span><span class="s2">${callName}</span><span class="s0">() call`</span><span class="s2">)</span><span class="s1">;</span>
    <span class="s1">if </span><span class="s2">(kind === </span><span class="s1">void </span><span class="s4">0</span><span class="s2">)</span>
      <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">`Missing &quot;kind&quot; in </span><span class="s2">${callName}</span><span class="s0">() call`</span><span class="s2">)</span><span class="s1">;</span>
    <span class="s1">if </span><span class="s2">(kind !== </span><span class="s0">&quot;error&quot; </span><span class="s2">&amp;&amp; kind !== </span><span class="s0">&quot;warning&quot;</span><span class="s2">)</span>
      <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">`Expected &quot;kind&quot; to be &quot;error&quot; or &quot;warning&quot; in </span><span class="s2">${callName}</span><span class="s0">() call`</span><span class="s2">)</span><span class="s1">;</span>
    <span class="s1">let </span><span class="s2">request = {</span>
      <span class="s2">command: </span><span class="s0">&quot;format-msgs&quot;</span><span class="s1">,</span>
      <span class="s2">messages: result</span><span class="s1">,</span>
      <span class="s2">isWarning: kind === </span><span class="s0">&quot;warning&quot;</span>
    <span class="s2">}</span><span class="s1">;</span>
    <span class="s1">if </span><span class="s2">(color !== </span><span class="s1">void </span><span class="s4">0</span><span class="s2">)</span>
      <span class="s2">request.color = color</span><span class="s1">;</span>
    <span class="s1">if </span><span class="s2">(terminalWidth !== </span><span class="s1">void </span><span class="s4">0</span><span class="s2">)</span>
      <span class="s2">request.terminalWidth = terminalWidth</span><span class="s1">;</span>
    <span class="s2">sendRequest(refs</span><span class="s1">, </span><span class="s2">request</span><span class="s1">, </span><span class="s2">(error</span><span class="s1">, </span><span class="s2">response) =&gt; {</span>
      <span class="s1">if </span><span class="s2">(error)</span>
        <span class="s1">return </span><span class="s2">callback(</span><span class="s1">new </span><span class="s2">Error(error)</span><span class="s1">, null</span><span class="s2">)</span><span class="s1">;</span>
      <span class="s2">callback(</span><span class="s1">null, </span><span class="s2">response.messages)</span><span class="s1">;</span>
    <span class="s2">})</span><span class="s1">;</span>
  <span class="s2">}</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">analyzeMetafile2 = ({ callName</span><span class="s1">, </span><span class="s2">refs</span><span class="s1">, </span><span class="s2">metafile</span><span class="s1">, </span><span class="s2">options</span><span class="s1">, </span><span class="s2">callback }) =&gt; {</span>
    <span class="s1">if </span><span class="s2">(options === </span><span class="s1">void </span><span class="s4">0</span><span class="s2">)</span>
      <span class="s2">options = {}</span><span class="s1">;</span>
    <span class="s1">let </span><span class="s2">keys = {}</span><span class="s1">;</span>
    <span class="s1">let </span><span class="s2">color = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;color&quot;</span><span class="s1">, </span><span class="s2">mustBeBoolean)</span><span class="s1">;</span>
    <span class="s1">let </span><span class="s2">verbose = getFlag(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;verbose&quot;</span><span class="s1">, </span><span class="s2">mustBeBoolean)</span><span class="s1">;</span>
    <span class="s2">checkForInvalidFlags(options</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">`in </span><span class="s2">${callName}</span><span class="s0">() call`</span><span class="s2">)</span><span class="s1">;</span>
    <span class="s1">let </span><span class="s2">request = {</span>
      <span class="s2">command: </span><span class="s0">&quot;analyze-metafile&quot;</span><span class="s1">,</span>
      <span class="s2">metafile</span>
    <span class="s2">}</span><span class="s1">;</span>
    <span class="s1">if </span><span class="s2">(color !== </span><span class="s1">void </span><span class="s4">0</span><span class="s2">)</span>
      <span class="s2">request.color = color</span><span class="s1">;</span>
    <span class="s1">if </span><span class="s2">(verbose !== </span><span class="s1">void </span><span class="s4">0</span><span class="s2">)</span>
      <span class="s2">request.verbose = verbose</span><span class="s1">;</span>
    <span class="s2">sendRequest(refs</span><span class="s1">, </span><span class="s2">request</span><span class="s1">, </span><span class="s2">(error</span><span class="s1">, </span><span class="s2">response) =&gt; {</span>
      <span class="s1">if </span><span class="s2">(error)</span>
        <span class="s1">return </span><span class="s2">callback(</span><span class="s1">new </span><span class="s2">Error(error)</span><span class="s1">, null</span><span class="s2">)</span><span class="s1">;</span>
      <span class="s2">callback(</span><span class="s1">null, </span><span class="s2">response.result)</span><span class="s1">;</span>
    <span class="s2">})</span><span class="s1">;</span>
  <span class="s2">}</span><span class="s1">;</span>
  <span class="s1">return </span><span class="s2">{</span>
    <span class="s2">readFromStdout</span><span class="s1">,</span>
    <span class="s2">afterClose</span><span class="s1">,</span>
    <span class="s2">service: {</span>
      <span class="s2">buildOrContext</span><span class="s1">,</span>
      <span class="s2">transform: transform2</span><span class="s1">,</span>
      <span class="s2">formatMessages: formatMessages2</span><span class="s1">,</span>
      <span class="s2">analyzeMetafile: analyzeMetafile2</span>
    <span class="s2">}</span>
  <span class="s2">}</span><span class="s1">;</span>
<span class="s2">}</span>
<span class="s1">function </span><span class="s2">buildOrContextImpl(callName</span><span class="s1">, </span><span class="s2">buildKey</span><span class="s1">, </span><span class="s2">sendRequest</span><span class="s1">, </span><span class="s2">sendResponse</span><span class="s1">, </span><span class="s2">refs</span><span class="s1">, </span><span class="s2">streamIn</span><span class="s1">, </span><span class="s2">requestCallbacks</span><span class="s1">, </span><span class="s2">options</span><span class="s1">, </span><span class="s2">isTTY2</span><span class="s1">, </span><span class="s2">defaultWD2</span><span class="s1">, </span><span class="s2">callback) {</span>
  <span class="s1">const </span><span class="s2">details = createObjectStash()</span><span class="s1">;</span>
  <span class="s1">const </span><span class="s2">isContext = callName === </span><span class="s0">&quot;context&quot;</span><span class="s1">;</span>
  <span class="s1">const </span><span class="s2">handleError = (e</span><span class="s1">, </span><span class="s2">pluginName) =&gt; {</span>
    <span class="s1">const </span><span class="s2">flags = []</span><span class="s1">;</span>
    <span class="s1">try </span><span class="s2">{</span>
      <span class="s2">pushLogFlags(flags</span><span class="s1">, </span><span class="s2">options</span><span class="s1">, </span><span class="s2">{}</span><span class="s1">, </span><span class="s2">isTTY2</span><span class="s1">, </span><span class="s2">buildLogLevelDefault)</span><span class="s1">;</span>
    <span class="s2">} </span><span class="s1">catch </span><span class="s2">{</span>
    <span class="s2">}</span>
    <span class="s1">const </span><span class="s2">message = extractErrorMessageV8(e</span><span class="s1">, </span><span class="s2">streamIn</span><span class="s1">, </span><span class="s2">details</span><span class="s1">, void </span><span class="s4">0</span><span class="s1">, </span><span class="s2">pluginName)</span><span class="s1">;</span>
    <span class="s2">sendRequest(refs</span><span class="s1">, </span><span class="s2">{ command: </span><span class="s0">&quot;error&quot;</span><span class="s1">, </span><span class="s2">flags</span><span class="s1">, </span><span class="s2">error: message }</span><span class="s1">, </span><span class="s2">() =&gt; {</span>
      <span class="s2">message.detail = details.load(message.detail)</span><span class="s1">;</span>
      <span class="s2">callback(failureErrorWithLog(isContext ? </span><span class="s0">&quot;Context failed&quot; </span><span class="s2">: </span><span class="s0">&quot;Build failed&quot;</span><span class="s1">, </span><span class="s2">[message]</span><span class="s1">, </span><span class="s2">[])</span><span class="s1">, null</span><span class="s2">)</span><span class="s1">;</span>
    <span class="s2">})</span><span class="s1">;</span>
  <span class="s2">}</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">plugins</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(</span><span class="s1">typeof </span><span class="s2">options === </span><span class="s0">&quot;object&quot;</span><span class="s2">) {</span>
    <span class="s1">const </span><span class="s2">value = options.plugins</span><span class="s1">;</span>
    <span class="s1">if </span><span class="s2">(value !== </span><span class="s1">void </span><span class="s4">0</span><span class="s2">) {</span>
      <span class="s1">if </span><span class="s2">(!Array.isArray(value))</span>
        <span class="s1">return </span><span class="s2">handleError(</span><span class="s1">new </span><span class="s2">Error(</span><span class="s0">`&quot;plugins&quot; must be an array`</span><span class="s2">)</span><span class="s1">, </span><span class="s0">&quot;&quot;</span><span class="s2">)</span><span class="s1">;</span>
      <span class="s2">plugins = value</span><span class="s1">;</span>
    <span class="s2">}</span>
  <span class="s2">}</span>
  <span class="s1">if </span><span class="s2">(plugins &amp;&amp; plugins.length &gt; </span><span class="s4">0</span><span class="s2">) {</span>
    <span class="s1">if </span><span class="s2">(streamIn.isSync)</span>
      <span class="s1">return </span><span class="s2">handleError(</span><span class="s1">new </span><span class="s2">Error(</span><span class="s0">&quot;Cannot use plugins in synchronous API calls&quot;</span><span class="s2">)</span><span class="s1">, </span><span class="s0">&quot;&quot;</span><span class="s2">)</span><span class="s1">;</span>
    <span class="s2">handlePlugins(</span>
      <span class="s2">buildKey</span><span class="s1">,</span>
      <span class="s2">sendRequest</span><span class="s1">,</span>
      <span class="s2">sendResponse</span><span class="s1">,</span>
      <span class="s2">refs</span><span class="s1">,</span>
      <span class="s2">streamIn</span><span class="s1">,</span>
      <span class="s2">requestCallbacks</span><span class="s1">,</span>
      <span class="s2">options</span><span class="s1">,</span>
      <span class="s2">plugins</span><span class="s1">,</span>
      <span class="s2">details</span>
    <span class="s2">).then(</span>
      <span class="s2">(result) =&gt; {</span>
        <span class="s1">if </span><span class="s2">(!result.ok)</span>
          <span class="s1">return </span><span class="s2">handleError(result.error</span><span class="s1">, </span><span class="s2">result.pluginName)</span><span class="s1">;</span>
        <span class="s1">try </span><span class="s2">{</span>
          <span class="s2">buildOrContextContinue(result.requestPlugins</span><span class="s1">, </span><span class="s2">result.runOnEndCallbacks</span><span class="s1">, </span><span class="s2">result.scheduleOnDisposeCallbacks)</span><span class="s1">;</span>
        <span class="s2">} </span><span class="s1">catch </span><span class="s2">(e) {</span>
          <span class="s2">handleError(e</span><span class="s1">, </span><span class="s0">&quot;&quot;</span><span class="s2">)</span><span class="s1">;</span>
        <span class="s2">}</span>
      <span class="s2">}</span><span class="s1">,</span>
      <span class="s2">(e) =&gt; handleError(e</span><span class="s1">, </span><span class="s0">&quot;&quot;</span><span class="s2">)</span>
    <span class="s2">)</span><span class="s1">;</span>
    <span class="s1">return;</span>
  <span class="s2">}</span>
  <span class="s1">try </span><span class="s2">{</span>
    <span class="s2">buildOrContextContinue(</span><span class="s1">null, </span><span class="s2">(result</span><span class="s1">, </span><span class="s2">done) =&gt; done([]</span><span class="s1">, </span><span class="s2">[])</span><span class="s1">, </span><span class="s2">() =&gt; {</span>
    <span class="s2">})</span><span class="s1">;</span>
  <span class="s2">} </span><span class="s1">catch </span><span class="s2">(e) {</span>
    <span class="s2">handleError(e</span><span class="s1">, </span><span class="s0">&quot;&quot;</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s2">}</span>
  <span class="s1">function </span><span class="s2">buildOrContextContinue(requestPlugins</span><span class="s1">, </span><span class="s2">runOnEndCallbacks</span><span class="s1">, </span><span class="s2">scheduleOnDisposeCallbacks) {</span>
    <span class="s1">const </span><span class="s2">writeDefault = streamIn.hasFS</span><span class="s1">;</span>
    <span class="s1">const </span><span class="s2">{</span>
      <span class="s2">entries</span><span class="s1">,</span>
      <span class="s2">flags</span><span class="s1">,</span>
      <span class="s2">write</span><span class="s1">,</span>
      <span class="s2">stdinContents</span><span class="s1">,</span>
      <span class="s2">stdinResolveDir</span><span class="s1">,</span>
      <span class="s2">absWorkingDir</span><span class="s1">,</span>
      <span class="s2">nodePaths</span><span class="s1">,</span>
      <span class="s2">mangleCache</span>
    <span class="s2">} = flagsForBuildOptions(callName</span><span class="s1">, </span><span class="s2">options</span><span class="s1">, </span><span class="s2">isTTY2</span><span class="s1">, </span><span class="s2">buildLogLevelDefault</span><span class="s1">, </span><span class="s2">writeDefault)</span><span class="s1">;</span>
    <span class="s1">if </span><span class="s2">(write &amp;&amp; !streamIn.hasFS)</span>
      <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">`The &quot;write&quot; option is unavailable in this environment`</span><span class="s2">)</span><span class="s1">;</span>
    <span class="s1">const </span><span class="s2">request = {</span>
      <span class="s2">command: </span><span class="s0">&quot;build&quot;</span><span class="s1">,</span>
      <span class="s2">key: buildKey</span><span class="s1">,</span>
      <span class="s2">entries</span><span class="s1">,</span>
      <span class="s2">flags</span><span class="s1">,</span>
      <span class="s2">write</span><span class="s1">,</span>
      <span class="s2">stdinContents</span><span class="s1">,</span>
      <span class="s2">stdinResolveDir</span><span class="s1">,</span>
      <span class="s2">absWorkingDir: absWorkingDir || defaultWD2</span><span class="s1">,</span>
      <span class="s2">nodePaths</span><span class="s1">,</span>
      <span class="s2">context: isContext</span>
    <span class="s2">}</span><span class="s1">;</span>
    <span class="s1">if </span><span class="s2">(requestPlugins)</span>
      <span class="s2">request.plugins = requestPlugins</span><span class="s1">;</span>
    <span class="s1">if </span><span class="s2">(mangleCache)</span>
      <span class="s2">request.mangleCache = mangleCache</span><span class="s1">;</span>
    <span class="s1">const </span><span class="s2">buildResponseToResult = (response</span><span class="s1">, </span><span class="s2">callback2) =&gt; {</span>
      <span class="s1">const </span><span class="s2">result = {</span>
        <span class="s2">errors: replaceDetailsInMessages(response.errors</span><span class="s1">, </span><span class="s2">details)</span><span class="s1">,</span>
        <span class="s2">warnings: replaceDetailsInMessages(response.warnings</span><span class="s1">, </span><span class="s2">details)</span><span class="s1">,</span>
        <span class="s2">outputFiles: </span><span class="s1">void </span><span class="s4">0</span><span class="s1">,</span>
        <span class="s2">metafile: </span><span class="s1">void </span><span class="s4">0</span><span class="s1">,</span>
        <span class="s2">mangleCache: </span><span class="s1">void </span><span class="s4">0</span>
      <span class="s2">}</span><span class="s1">;</span>
      <span class="s1">const </span><span class="s2">originalErrors = result.errors.slice()</span><span class="s1">;</span>
      <span class="s1">const </span><span class="s2">originalWarnings = result.warnings.slice()</span><span class="s1">;</span>
      <span class="s1">if </span><span class="s2">(response.outputFiles)</span>
        <span class="s2">result.outputFiles = response.outputFiles.map(convertOutputFiles)</span><span class="s1">;</span>
      <span class="s1">if </span><span class="s2">(response.metafile)</span>
        <span class="s2">result.metafile = JSON.parse(response.metafile)</span><span class="s1">;</span>
      <span class="s1">if </span><span class="s2">(response.mangleCache)</span>
        <span class="s2">result.mangleCache = response.mangleCache</span><span class="s1">;</span>
      <span class="s1">if </span><span class="s2">(response.writeToStdout !== </span><span class="s1">void </span><span class="s4">0</span><span class="s2">)</span>
        <span class="s2">console.log(decodeUTF8(response.writeToStdout).replace(</span><span class="s4">/\n$/</span><span class="s1">, </span><span class="s0">&quot;&quot;</span><span class="s2">))</span><span class="s1">;</span>
      <span class="s2">runOnEndCallbacks(result</span><span class="s1">, </span><span class="s2">(onEndErrors</span><span class="s1">, </span><span class="s2">onEndWarnings) =&gt; {</span>
        <span class="s1">if </span><span class="s2">(originalErrors.length &gt; </span><span class="s4">0 </span><span class="s2">|| onEndErrors.length &gt; </span><span class="s4">0</span><span class="s2">) {</span>
          <span class="s1">const </span><span class="s2">error = failureErrorWithLog(</span><span class="s0">&quot;Build failed&quot;</span><span class="s1">, </span><span class="s2">originalErrors.concat(onEndErrors)</span><span class="s1">, </span><span class="s2">originalWarnings.concat(onEndWarnings))</span><span class="s1">;</span>
          <span class="s1">return </span><span class="s2">callback2(error</span><span class="s1">, null, </span><span class="s2">onEndErrors</span><span class="s1">, </span><span class="s2">onEndWarnings)</span><span class="s1">;</span>
        <span class="s2">}</span>
        <span class="s2">callback2(</span><span class="s1">null, </span><span class="s2">result</span><span class="s1">, </span><span class="s2">onEndErrors</span><span class="s1">, </span><span class="s2">onEndWarnings)</span><span class="s1">;</span>
      <span class="s2">})</span><span class="s1">;</span>
    <span class="s2">}</span><span class="s1">;</span>
    <span class="s1">let </span><span class="s2">latestResultPromise</span><span class="s1">;</span>
    <span class="s1">let </span><span class="s2">provideLatestResult</span><span class="s1">;</span>
    <span class="s1">if </span><span class="s2">(isContext)</span>
      <span class="s2">requestCallbacks[</span><span class="s0">&quot;on-end&quot;</span><span class="s2">] = (id</span><span class="s1">, </span><span class="s2">request2) =&gt; </span><span class="s1">new </span><span class="s2">Promise((resolve) =&gt; {</span>
        <span class="s2">buildResponseToResult(request2</span><span class="s1">, </span><span class="s2">(err</span><span class="s1">, </span><span class="s2">result</span><span class="s1">, </span><span class="s2">onEndErrors</span><span class="s1">, </span><span class="s2">onEndWarnings) =&gt; {</span>
          <span class="s1">const </span><span class="s2">response = {</span>
            <span class="s2">errors: onEndErrors</span><span class="s1">,</span>
            <span class="s2">warnings: onEndWarnings</span>
          <span class="s2">}</span><span class="s1">;</span>
          <span class="s1">if </span><span class="s2">(provideLatestResult)</span>
            <span class="s2">provideLatestResult(err</span><span class="s1">, </span><span class="s2">result)</span><span class="s1">;</span>
          <span class="s2">latestResultPromise = </span><span class="s1">void </span><span class="s4">0</span><span class="s1">;</span>
          <span class="s2">provideLatestResult = </span><span class="s1">void </span><span class="s4">0</span><span class="s1">;</span>
          <span class="s2">sendResponse(id</span><span class="s1">, </span><span class="s2">response)</span><span class="s1">;</span>
          <span class="s2">resolve()</span><span class="s1">;</span>
        <span class="s2">})</span><span class="s1">;</span>
      <span class="s2">})</span><span class="s1">;</span>
    <span class="s2">sendRequest(refs</span><span class="s1">, </span><span class="s2">request</span><span class="s1">, </span><span class="s2">(error</span><span class="s1">, </span><span class="s2">response) =&gt; {</span>
      <span class="s1">if </span><span class="s2">(error)</span>
        <span class="s1">return </span><span class="s2">callback(</span><span class="s1">new </span><span class="s2">Error(error)</span><span class="s1">, null</span><span class="s2">)</span><span class="s1">;</span>
      <span class="s1">if </span><span class="s2">(!isContext) {</span>
        <span class="s1">return </span><span class="s2">buildResponseToResult(response</span><span class="s1">, </span><span class="s2">(err</span><span class="s1">, </span><span class="s2">res) =&gt; {</span>
          <span class="s2">scheduleOnDisposeCallbacks()</span><span class="s1">;</span>
          <span class="s1">return </span><span class="s2">callback(err</span><span class="s1">, </span><span class="s2">res)</span><span class="s1">;</span>
        <span class="s2">})</span><span class="s1">;</span>
      <span class="s2">}</span>
      <span class="s1">if </span><span class="s2">(response.errors.length &gt; </span><span class="s4">0</span><span class="s2">) {</span>
        <span class="s1">return </span><span class="s2">callback(failureErrorWithLog(</span><span class="s0">&quot;Context failed&quot;</span><span class="s1">, </span><span class="s2">response.errors</span><span class="s1">, </span><span class="s2">response.warnings)</span><span class="s1">, null</span><span class="s2">)</span><span class="s1">;</span>
      <span class="s2">}</span>
      <span class="s1">let </span><span class="s2">didDispose = </span><span class="s1">false;</span>
      <span class="s1">const </span><span class="s2">result = {</span>
        <span class="s2">rebuild: () =&gt; {</span>
          <span class="s1">if </span><span class="s2">(!latestResultPromise)</span>
            <span class="s2">latestResultPromise = </span><span class="s1">new </span><span class="s2">Promise((resolve</span><span class="s1">, </span><span class="s2">reject) =&gt; {</span>
              <span class="s1">let </span><span class="s2">settlePromise</span><span class="s1">;</span>
              <span class="s2">provideLatestResult = (err</span><span class="s1">, </span><span class="s2">result2) =&gt; {</span>
                <span class="s1">if </span><span class="s2">(!settlePromise)</span>
                  <span class="s2">settlePromise = () =&gt; err ? reject(err) : resolve(result2)</span><span class="s1">;</span>
              <span class="s2">}</span><span class="s1">;</span>
              <span class="s1">const </span><span class="s2">triggerAnotherBuild = () =&gt; {</span>
                <span class="s1">const </span><span class="s2">request2 = {</span>
                  <span class="s2">command: </span><span class="s0">&quot;rebuild&quot;</span><span class="s1">,</span>
                  <span class="s2">key: buildKey</span>
                <span class="s2">}</span><span class="s1">;</span>
                <span class="s2">sendRequest(refs</span><span class="s1">, </span><span class="s2">request2</span><span class="s1">, </span><span class="s2">(error2</span><span class="s1">, </span><span class="s2">response2) =&gt; {</span>
                  <span class="s1">if </span><span class="s2">(error2) {</span>
                    <span class="s2">reject(</span><span class="s1">new </span><span class="s2">Error(error2))</span><span class="s1">;</span>
                  <span class="s2">} </span><span class="s1">else if </span><span class="s2">(settlePromise) {</span>
                    <span class="s2">settlePromise()</span><span class="s1">;</span>
                  <span class="s2">} </span><span class="s1">else </span><span class="s2">{</span>
                    <span class="s2">triggerAnotherBuild()</span><span class="s1">;</span>
                  <span class="s2">}</span>
                <span class="s2">})</span><span class="s1">;</span>
              <span class="s2">}</span><span class="s1">;</span>
              <span class="s2">triggerAnotherBuild()</span><span class="s1">;</span>
            <span class="s2">})</span><span class="s1">;</span>
          <span class="s1">return </span><span class="s2">latestResultPromise</span><span class="s1">;</span>
        <span class="s2">}</span><span class="s1">,</span>
        <span class="s2">watch: (options2 = {}) =&gt; </span><span class="s1">new </span><span class="s2">Promise((resolve</span><span class="s1">, </span><span class="s2">reject) =&gt; {</span>
          <span class="s1">if </span><span class="s2">(!streamIn.hasFS)</span>
            <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">`Cannot use the &quot;watch&quot; API in this environment`</span><span class="s2">)</span><span class="s1">;</span>
          <span class="s1">const </span><span class="s2">keys = {}</span><span class="s1">;</span>
          <span class="s2">checkForInvalidFlags(options2</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">`in watch() call`</span><span class="s2">)</span><span class="s1">;</span>
          <span class="s1">const </span><span class="s2">request2 = {</span>
            <span class="s2">command: </span><span class="s0">&quot;watch&quot;</span><span class="s1">,</span>
            <span class="s2">key: buildKey</span>
          <span class="s2">}</span><span class="s1">;</span>
          <span class="s2">sendRequest(refs</span><span class="s1">, </span><span class="s2">request2</span><span class="s1">, </span><span class="s2">(error2) =&gt; {</span>
            <span class="s1">if </span><span class="s2">(error2)</span>
              <span class="s2">reject(</span><span class="s1">new </span><span class="s2">Error(error2))</span><span class="s1">;</span>
            <span class="s1">else</span>
              <span class="s2">resolve(</span><span class="s1">void </span><span class="s4">0</span><span class="s2">)</span><span class="s1">;</span>
          <span class="s2">})</span><span class="s1">;</span>
        <span class="s2">})</span><span class="s1">,</span>
        <span class="s2">serve: (options2 = {}) =&gt; </span><span class="s1">new </span><span class="s2">Promise((resolve</span><span class="s1">, </span><span class="s2">reject) =&gt; {</span>
          <span class="s1">if </span><span class="s2">(!streamIn.hasFS)</span>
            <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">`Cannot use the &quot;serve&quot; API in this environment`</span><span class="s2">)</span><span class="s1">;</span>
          <span class="s1">const </span><span class="s2">keys = {}</span><span class="s1">;</span>
          <span class="s1">const </span><span class="s2">port = getFlag(options2</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;port&quot;</span><span class="s1">, </span><span class="s2">mustBeInteger)</span><span class="s1">;</span>
          <span class="s1">const </span><span class="s2">host = getFlag(options2</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;host&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
          <span class="s1">const </span><span class="s2">servedir = getFlag(options2</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;servedir&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
          <span class="s1">const </span><span class="s2">keyfile = getFlag(options2</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;keyfile&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
          <span class="s1">const </span><span class="s2">certfile = getFlag(options2</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;certfile&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
          <span class="s1">const </span><span class="s2">onRequest = getFlag(options2</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;onRequest&quot;</span><span class="s1">, </span><span class="s2">mustBeFunction)</span><span class="s1">;</span>
          <span class="s2">checkForInvalidFlags(options2</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">`in serve() call`</span><span class="s2">)</span><span class="s1">;</span>
          <span class="s1">const </span><span class="s2">request2 = {</span>
            <span class="s2">command: </span><span class="s0">&quot;serve&quot;</span><span class="s1">,</span>
            <span class="s2">key: buildKey</span><span class="s1">,</span>
            <span class="s2">onRequest: !!onRequest</span>
          <span class="s2">}</span><span class="s1">;</span>
          <span class="s1">if </span><span class="s2">(port !== </span><span class="s1">void </span><span class="s4">0</span><span class="s2">)</span>
            <span class="s2">request2.port = port</span><span class="s1">;</span>
          <span class="s1">if </span><span class="s2">(host !== </span><span class="s1">void </span><span class="s4">0</span><span class="s2">)</span>
            <span class="s2">request2.host = host</span><span class="s1">;</span>
          <span class="s1">if </span><span class="s2">(servedir !== </span><span class="s1">void </span><span class="s4">0</span><span class="s2">)</span>
            <span class="s2">request2.servedir = servedir</span><span class="s1">;</span>
          <span class="s1">if </span><span class="s2">(keyfile !== </span><span class="s1">void </span><span class="s4">0</span><span class="s2">)</span>
            <span class="s2">request2.keyfile = keyfile</span><span class="s1">;</span>
          <span class="s1">if </span><span class="s2">(certfile !== </span><span class="s1">void </span><span class="s4">0</span><span class="s2">)</span>
            <span class="s2">request2.certfile = certfile</span><span class="s1">;</span>
          <span class="s2">sendRequest(refs</span><span class="s1">, </span><span class="s2">request2</span><span class="s1">, </span><span class="s2">(error2</span><span class="s1">, </span><span class="s2">response2) =&gt; {</span>
            <span class="s1">if </span><span class="s2">(error2)</span>
              <span class="s1">return </span><span class="s2">reject(</span><span class="s1">new </span><span class="s2">Error(error2))</span><span class="s1">;</span>
            <span class="s1">if </span><span class="s2">(onRequest) {</span>
              <span class="s2">requestCallbacks[</span><span class="s0">&quot;serve-request&quot;</span><span class="s2">] = (id</span><span class="s1">, </span><span class="s2">request3) =&gt; {</span>
                <span class="s2">onRequest(request3.args)</span><span class="s1">;</span>
                <span class="s2">sendResponse(id</span><span class="s1">, </span><span class="s2">{})</span><span class="s1">;</span>
              <span class="s2">}</span><span class="s1">;</span>
            <span class="s2">}</span>
            <span class="s2">resolve(response2)</span><span class="s1">;</span>
          <span class="s2">})</span><span class="s1">;</span>
        <span class="s2">})</span><span class="s1">,</span>
        <span class="s2">cancel: () =&gt; </span><span class="s1">new </span><span class="s2">Promise((resolve) =&gt; {</span>
          <span class="s1">if </span><span class="s2">(didDispose)</span>
            <span class="s1">return </span><span class="s2">resolve()</span><span class="s1">;</span>
          <span class="s1">const </span><span class="s2">request2 = {</span>
            <span class="s2">command: </span><span class="s0">&quot;cancel&quot;</span><span class="s1">,</span>
            <span class="s2">key: buildKey</span>
          <span class="s2">}</span><span class="s1">;</span>
          <span class="s2">sendRequest(refs</span><span class="s1">, </span><span class="s2">request2</span><span class="s1">, </span><span class="s2">() =&gt; {</span>
            <span class="s2">resolve()</span><span class="s1">;</span>
          <span class="s2">})</span><span class="s1">;</span>
        <span class="s2">})</span><span class="s1">,</span>
        <span class="s2">dispose: () =&gt; </span><span class="s1">new </span><span class="s2">Promise((resolve) =&gt; {</span>
          <span class="s1">if </span><span class="s2">(didDispose)</span>
            <span class="s1">return </span><span class="s2">resolve()</span><span class="s1">;</span>
          <span class="s2">didDispose = </span><span class="s1">true;</span>
          <span class="s1">const </span><span class="s2">request2 = {</span>
            <span class="s2">command: </span><span class="s0">&quot;dispose&quot;</span><span class="s1">,</span>
            <span class="s2">key: buildKey</span>
          <span class="s2">}</span><span class="s1">;</span>
          <span class="s2">sendRequest(refs</span><span class="s1">, </span><span class="s2">request2</span><span class="s1">, </span><span class="s2">() =&gt; {</span>
            <span class="s2">resolve()</span><span class="s1">;</span>
            <span class="s2">scheduleOnDisposeCallbacks()</span><span class="s1">;</span>
            <span class="s2">refs.unref()</span><span class="s1">;</span>
          <span class="s2">})</span><span class="s1">;</span>
        <span class="s2">})</span>
      <span class="s2">}</span><span class="s1">;</span>
      <span class="s2">refs.ref()</span><span class="s1">;</span>
      <span class="s2">callback(</span><span class="s1">null, </span><span class="s2">result)</span><span class="s1">;</span>
    <span class="s2">})</span><span class="s1">;</span>
  <span class="s2">}</span>
<span class="s2">}</span>
<span class="s1">var </span><span class="s2">handlePlugins = async (buildKey</span><span class="s1">, </span><span class="s2">sendRequest</span><span class="s1">, </span><span class="s2">sendResponse</span><span class="s1">, </span><span class="s2">refs</span><span class="s1">, </span><span class="s2">streamIn</span><span class="s1">, </span><span class="s2">requestCallbacks</span><span class="s1">, </span><span class="s2">initialOptions</span><span class="s1">, </span><span class="s2">plugins</span><span class="s1">, </span><span class="s2">details) =&gt; {</span>
  <span class="s1">let </span><span class="s2">onStartCallbacks = []</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">onEndCallbacks = []</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">onResolveCallbacks = {}</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">onLoadCallbacks = {}</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">onDisposeCallbacks = []</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">nextCallbackID = </span><span class="s4">0</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">i = </span><span class="s4">0</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">requestPlugins = []</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">isSetupDone = </span><span class="s1">false;</span>
  <span class="s2">plugins = [...plugins]</span><span class="s1">;</span>
  <span class="s1">for </span><span class="s2">(</span><span class="s1">let </span><span class="s2">item of plugins) {</span>
    <span class="s1">let </span><span class="s2">keys = {}</span><span class="s1">;</span>
    <span class="s1">if </span><span class="s2">(</span><span class="s1">typeof </span><span class="s2">item !== </span><span class="s0">&quot;object&quot;</span><span class="s2">)</span>
      <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">`Plugin at index </span><span class="s2">${i} </span><span class="s0">must be an object`</span><span class="s2">)</span><span class="s1">;</span>
    <span class="s1">const </span><span class="s2">name = getFlag(item</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;name&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
    <span class="s1">if </span><span class="s2">(</span><span class="s1">typeof </span><span class="s2">name !== </span><span class="s0">&quot;string&quot; </span><span class="s2">|| name === </span><span class="s0">&quot;&quot;</span><span class="s2">)</span>
      <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">`Plugin at index </span><span class="s2">${i} </span><span class="s0">is missing a name`</span><span class="s2">)</span><span class="s1">;</span>
    <span class="s1">try </span><span class="s2">{</span>
      <span class="s1">let </span><span class="s2">setup = getFlag(item</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;setup&quot;</span><span class="s1">, </span><span class="s2">mustBeFunction)</span><span class="s1">;</span>
      <span class="s1">if </span><span class="s2">(</span><span class="s1">typeof </span><span class="s2">setup !== </span><span class="s0">&quot;function&quot;</span><span class="s2">)</span>
        <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">`Plugin is missing a setup function`</span><span class="s2">)</span><span class="s1">;</span>
      <span class="s2">checkForInvalidFlags(item</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">`on plugin </span><span class="s2">${quote(name)}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
      <span class="s1">let </span><span class="s2">plugin = {</span>
        <span class="s2">name</span><span class="s1">,</span>
        <span class="s2">onStart: </span><span class="s1">false,</span>
        <span class="s2">onEnd: </span><span class="s1">false,</span>
        <span class="s2">onResolve: []</span><span class="s1">,</span>
        <span class="s2">onLoad: []</span>
      <span class="s2">}</span><span class="s1">;</span>
      <span class="s2">i++</span><span class="s1">;</span>
      <span class="s1">let </span><span class="s2">resolve = (path3</span><span class="s1">, </span><span class="s2">options = {}) =&gt; {</span>
        <span class="s1">if </span><span class="s2">(!isSetupDone)</span>
          <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">'Cannot call &quot;resolve&quot; before plugin setup has completed'</span><span class="s2">)</span><span class="s1">;</span>
        <span class="s1">if </span><span class="s2">(</span><span class="s1">typeof </span><span class="s2">path3 !== </span><span class="s0">&quot;string&quot;</span><span class="s2">)</span>
          <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">`The path to resolve must be a string`</span><span class="s2">)</span><span class="s1">;</span>
        <span class="s1">let </span><span class="s2">keys2 = </span><span class="s3">/* @__PURE__ */ </span><span class="s2">Object.create(</span><span class="s1">null</span><span class="s2">)</span><span class="s1">;</span>
        <span class="s1">let </span><span class="s2">pluginName = getFlag(options</span><span class="s1">, </span><span class="s2">keys2</span><span class="s1">, </span><span class="s0">&quot;pluginName&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
        <span class="s1">let </span><span class="s2">importer = getFlag(options</span><span class="s1">, </span><span class="s2">keys2</span><span class="s1">, </span><span class="s0">&quot;importer&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
        <span class="s1">let </span><span class="s2">namespace = getFlag(options</span><span class="s1">, </span><span class="s2">keys2</span><span class="s1">, </span><span class="s0">&quot;namespace&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
        <span class="s1">let </span><span class="s2">resolveDir = getFlag(options</span><span class="s1">, </span><span class="s2">keys2</span><span class="s1">, </span><span class="s0">&quot;resolveDir&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
        <span class="s1">let </span><span class="s2">kind = getFlag(options</span><span class="s1">, </span><span class="s2">keys2</span><span class="s1">, </span><span class="s0">&quot;kind&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
        <span class="s1">let </span><span class="s2">pluginData = getFlag(options</span><span class="s1">, </span><span class="s2">keys2</span><span class="s1">, </span><span class="s0">&quot;pluginData&quot;</span><span class="s1">, </span><span class="s2">canBeAnything)</span><span class="s1">;</span>
        <span class="s2">checkForInvalidFlags(options</span><span class="s1">, </span><span class="s2">keys2</span><span class="s1">, </span><span class="s0">&quot;in resolve() call&quot;</span><span class="s2">)</span><span class="s1">;</span>
        <span class="s1">return new </span><span class="s2">Promise((resolve2</span><span class="s1">, </span><span class="s2">reject) =&gt; {</span>
          <span class="s1">const </span><span class="s2">request = {</span>
            <span class="s2">command: </span><span class="s0">&quot;resolve&quot;</span><span class="s1">,</span>
            <span class="s2">path: path3</span><span class="s1">,</span>
            <span class="s2">key: buildKey</span><span class="s1">,</span>
            <span class="s2">pluginName: name</span>
          <span class="s2">}</span><span class="s1">;</span>
          <span class="s1">if </span><span class="s2">(pluginName != </span><span class="s1">null</span><span class="s2">)</span>
            <span class="s2">request.pluginName = pluginName</span><span class="s1">;</span>
          <span class="s1">if </span><span class="s2">(importer != </span><span class="s1">null</span><span class="s2">)</span>
            <span class="s2">request.importer = importer</span><span class="s1">;</span>
          <span class="s1">if </span><span class="s2">(namespace != </span><span class="s1">null</span><span class="s2">)</span>
            <span class="s2">request.namespace = namespace</span><span class="s1">;</span>
          <span class="s1">if </span><span class="s2">(resolveDir != </span><span class="s1">null</span><span class="s2">)</span>
            <span class="s2">request.resolveDir = resolveDir</span><span class="s1">;</span>
          <span class="s1">if </span><span class="s2">(kind != </span><span class="s1">null</span><span class="s2">)</span>
            <span class="s2">request.kind = kind</span><span class="s1">;</span>
          <span class="s1">else</span>
            <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">`Must specify &quot;kind&quot; when calling &quot;resolve&quot;`</span><span class="s2">)</span><span class="s1">;</span>
          <span class="s1">if </span><span class="s2">(pluginData != </span><span class="s1">null</span><span class="s2">)</span>
            <span class="s2">request.pluginData = details.store(pluginData)</span><span class="s1">;</span>
          <span class="s2">sendRequest(refs</span><span class="s1">, </span><span class="s2">request</span><span class="s1">, </span><span class="s2">(error</span><span class="s1">, </span><span class="s2">response) =&gt; {</span>
            <span class="s1">if </span><span class="s2">(error !== </span><span class="s1">null</span><span class="s2">)</span>
              <span class="s2">reject(</span><span class="s1">new </span><span class="s2">Error(error))</span><span class="s1">;</span>
            <span class="s1">else</span>
              <span class="s2">resolve2({</span>
                <span class="s2">errors: replaceDetailsInMessages(response.errors</span><span class="s1">, </span><span class="s2">details)</span><span class="s1">,</span>
                <span class="s2">warnings: replaceDetailsInMessages(response.warnings</span><span class="s1">, </span><span class="s2">details)</span><span class="s1">,</span>
                <span class="s2">path: response.path</span><span class="s1">,</span>
                <span class="s2">external: response.external</span><span class="s1">,</span>
                <span class="s2">sideEffects: response.sideEffects</span><span class="s1">,</span>
                <span class="s2">namespace: response.namespace</span><span class="s1">,</span>
                <span class="s2">suffix: response.suffix</span><span class="s1">,</span>
                <span class="s2">pluginData: details.load(response.pluginData)</span>
              <span class="s2">})</span><span class="s1">;</span>
          <span class="s2">})</span><span class="s1">;</span>
        <span class="s2">})</span><span class="s1">;</span>
      <span class="s2">}</span><span class="s1">;</span>
      <span class="s1">let </span><span class="s2">promise = setup({</span>
        <span class="s2">initialOptions</span><span class="s1">,</span>
        <span class="s2">resolve</span><span class="s1">,</span>
        <span class="s2">onStart(callback) {</span>
          <span class="s1">let </span><span class="s2">registeredText = </span><span class="s0">`This error came from the &quot;onStart&quot; callback registered here:`</span><span class="s1">;</span>
          <span class="s1">let </span><span class="s2">registeredNote = extractCallerV8(</span><span class="s1">new </span><span class="s2">Error(registeredText)</span><span class="s1">, </span><span class="s2">streamIn</span><span class="s1">, </span><span class="s0">&quot;onStart&quot;</span><span class="s2">)</span><span class="s1">;</span>
          <span class="s2">onStartCallbacks.push({ name</span><span class="s1">, </span><span class="s2">callback</span><span class="s1">, </span><span class="s2">note: registeredNote })</span><span class="s1">;</span>
          <span class="s2">plugin.onStart = </span><span class="s1">true;</span>
        <span class="s2">}</span><span class="s1">,</span>
        <span class="s2">onEnd(callback) {</span>
          <span class="s1">let </span><span class="s2">registeredText = </span><span class="s0">`This error came from the &quot;onEnd&quot; callback registered here:`</span><span class="s1">;</span>
          <span class="s1">let </span><span class="s2">registeredNote = extractCallerV8(</span><span class="s1">new </span><span class="s2">Error(registeredText)</span><span class="s1">, </span><span class="s2">streamIn</span><span class="s1">, </span><span class="s0">&quot;onEnd&quot;</span><span class="s2">)</span><span class="s1">;</span>
          <span class="s2">onEndCallbacks.push({ name</span><span class="s1">, </span><span class="s2">callback</span><span class="s1">, </span><span class="s2">note: registeredNote })</span><span class="s1">;</span>
          <span class="s2">plugin.onEnd = </span><span class="s1">true;</span>
        <span class="s2">}</span><span class="s1">,</span>
        <span class="s2">onResolve(options</span><span class="s1">, </span><span class="s2">callback) {</span>
          <span class="s1">let </span><span class="s2">registeredText = </span><span class="s0">`This error came from the &quot;onResolve&quot; callback registered here:`</span><span class="s1">;</span>
          <span class="s1">let </span><span class="s2">registeredNote = extractCallerV8(</span><span class="s1">new </span><span class="s2">Error(registeredText)</span><span class="s1">, </span><span class="s2">streamIn</span><span class="s1">, </span><span class="s0">&quot;onResolve&quot;</span><span class="s2">)</span><span class="s1">;</span>
          <span class="s1">let </span><span class="s2">keys2 = {}</span><span class="s1">;</span>
          <span class="s1">let </span><span class="s2">filter = getFlag(options</span><span class="s1">, </span><span class="s2">keys2</span><span class="s1">, </span><span class="s0">&quot;filter&quot;</span><span class="s1">, </span><span class="s2">mustBeRegExp)</span><span class="s1">;</span>
          <span class="s1">let </span><span class="s2">namespace = getFlag(options</span><span class="s1">, </span><span class="s2">keys2</span><span class="s1">, </span><span class="s0">&quot;namespace&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
          <span class="s2">checkForInvalidFlags(options</span><span class="s1">, </span><span class="s2">keys2</span><span class="s1">, </span><span class="s0">`in onResolve() call for plugin </span><span class="s2">${quote(name)}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
          <span class="s1">if </span><span class="s2">(filter == </span><span class="s1">null</span><span class="s2">)</span>
            <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">`onResolve() call is missing a filter`</span><span class="s2">)</span><span class="s1">;</span>
          <span class="s1">let </span><span class="s2">id = nextCallbackID++</span><span class="s1">;</span>
          <span class="s2">onResolveCallbacks[id] = { name</span><span class="s1">, </span><span class="s2">callback</span><span class="s1">, </span><span class="s2">note: registeredNote }</span><span class="s1">;</span>
          <span class="s2">plugin.onResolve.push({ id</span><span class="s1">, </span><span class="s2">filter: filter.source</span><span class="s1">, </span><span class="s2">namespace: namespace || </span><span class="s0">&quot;&quot; </span><span class="s2">})</span><span class="s1">;</span>
        <span class="s2">}</span><span class="s1">,</span>
        <span class="s2">onLoad(options</span><span class="s1">, </span><span class="s2">callback) {</span>
          <span class="s1">let </span><span class="s2">registeredText = </span><span class="s0">`This error came from the &quot;onLoad&quot; callback registered here:`</span><span class="s1">;</span>
          <span class="s1">let </span><span class="s2">registeredNote = extractCallerV8(</span><span class="s1">new </span><span class="s2">Error(registeredText)</span><span class="s1">, </span><span class="s2">streamIn</span><span class="s1">, </span><span class="s0">&quot;onLoad&quot;</span><span class="s2">)</span><span class="s1">;</span>
          <span class="s1">let </span><span class="s2">keys2 = {}</span><span class="s1">;</span>
          <span class="s1">let </span><span class="s2">filter = getFlag(options</span><span class="s1">, </span><span class="s2">keys2</span><span class="s1">, </span><span class="s0">&quot;filter&quot;</span><span class="s1">, </span><span class="s2">mustBeRegExp)</span><span class="s1">;</span>
          <span class="s1">let </span><span class="s2">namespace = getFlag(options</span><span class="s1">, </span><span class="s2">keys2</span><span class="s1">, </span><span class="s0">&quot;namespace&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
          <span class="s2">checkForInvalidFlags(options</span><span class="s1">, </span><span class="s2">keys2</span><span class="s1">, </span><span class="s0">`in onLoad() call for plugin </span><span class="s2">${quote(name)}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
          <span class="s1">if </span><span class="s2">(filter == </span><span class="s1">null</span><span class="s2">)</span>
            <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">`onLoad() call is missing a filter`</span><span class="s2">)</span><span class="s1">;</span>
          <span class="s1">let </span><span class="s2">id = nextCallbackID++</span><span class="s1">;</span>
          <span class="s2">onLoadCallbacks[id] = { name</span><span class="s1">, </span><span class="s2">callback</span><span class="s1">, </span><span class="s2">note: registeredNote }</span><span class="s1">;</span>
          <span class="s2">plugin.onLoad.push({ id</span><span class="s1">, </span><span class="s2">filter: filter.source</span><span class="s1">, </span><span class="s2">namespace: namespace || </span><span class="s0">&quot;&quot; </span><span class="s2">})</span><span class="s1">;</span>
        <span class="s2">}</span><span class="s1">,</span>
        <span class="s2">onDispose(callback) {</span>
          <span class="s2">onDisposeCallbacks.push(callback)</span><span class="s1">;</span>
        <span class="s2">}</span><span class="s1">,</span>
        <span class="s2">esbuild: streamIn.esbuild</span>
      <span class="s2">})</span><span class="s1">;</span>
      <span class="s1">if </span><span class="s2">(promise)</span>
        <span class="s1">await </span><span class="s2">promise</span><span class="s1">;</span>
      <span class="s2">requestPlugins.push(plugin)</span><span class="s1">;</span>
    <span class="s2">} </span><span class="s1">catch </span><span class="s2">(e) {</span>
      <span class="s1">return </span><span class="s2">{ ok: </span><span class="s1">false, </span><span class="s2">error: e</span><span class="s1">, </span><span class="s2">pluginName: name }</span><span class="s1">;</span>
    <span class="s2">}</span>
  <span class="s2">}</span>
  <span class="s2">requestCallbacks[</span><span class="s0">&quot;on-start&quot;</span><span class="s2">] = async (id</span><span class="s1">, </span><span class="s2">request) =&gt; {</span>
    <span class="s1">let </span><span class="s2">response = { errors: []</span><span class="s1">, </span><span class="s2">warnings: [] }</span><span class="s1">;</span>
    <span class="s1">await </span><span class="s2">Promise.all(onStartCallbacks.map(async ({ name</span><span class="s1">, </span><span class="s2">callback</span><span class="s1">, </span><span class="s2">note }) =&gt; {</span>
      <span class="s1">try </span><span class="s2">{</span>
        <span class="s1">let </span><span class="s2">result = </span><span class="s1">await </span><span class="s2">callback()</span><span class="s1">;</span>
        <span class="s1">if </span><span class="s2">(result != </span><span class="s1">null</span><span class="s2">) {</span>
          <span class="s1">if </span><span class="s2">(</span><span class="s1">typeof </span><span class="s2">result !== </span><span class="s0">&quot;object&quot;</span><span class="s2">)</span>
            <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">`Expected onStart() callback in plugin </span><span class="s2">${quote(name)} </span><span class="s0">to return an object`</span><span class="s2">)</span><span class="s1">;</span>
          <span class="s1">let </span><span class="s2">keys = {}</span><span class="s1">;</span>
          <span class="s1">let </span><span class="s2">errors = getFlag(result</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;errors&quot;</span><span class="s1">, </span><span class="s2">mustBeArray)</span><span class="s1">;</span>
          <span class="s1">let </span><span class="s2">warnings = getFlag(result</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;warnings&quot;</span><span class="s1">, </span><span class="s2">mustBeArray)</span><span class="s1">;</span>
          <span class="s2">checkForInvalidFlags(result</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">`from onStart() callback in plugin </span><span class="s2">${quote(name)}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
          <span class="s1">if </span><span class="s2">(errors != </span><span class="s1">null</span><span class="s2">)</span>
            <span class="s2">response.errors.push(...sanitizeMessages(errors</span><span class="s1">, </span><span class="s0">&quot;errors&quot;</span><span class="s1">, </span><span class="s2">details</span><span class="s1">, </span><span class="s2">name))</span><span class="s1">;</span>
          <span class="s1">if </span><span class="s2">(warnings != </span><span class="s1">null</span><span class="s2">)</span>
            <span class="s2">response.warnings.push(...sanitizeMessages(warnings</span><span class="s1">, </span><span class="s0">&quot;warnings&quot;</span><span class="s1">, </span><span class="s2">details</span><span class="s1">, </span><span class="s2">name))</span><span class="s1">;</span>
        <span class="s2">}</span>
      <span class="s2">} </span><span class="s1">catch </span><span class="s2">(e) {</span>
        <span class="s2">response.errors.push(extractErrorMessageV8(e</span><span class="s1">, </span><span class="s2">streamIn</span><span class="s1">, </span><span class="s2">details</span><span class="s1">, </span><span class="s2">note &amp;&amp; note()</span><span class="s1">, </span><span class="s2">name))</span><span class="s1">;</span>
      <span class="s2">}</span>
    <span class="s2">}))</span><span class="s1">;</span>
    <span class="s2">sendResponse(id</span><span class="s1">, </span><span class="s2">response)</span><span class="s1">;</span>
  <span class="s2">}</span><span class="s1">;</span>
  <span class="s2">requestCallbacks[</span><span class="s0">&quot;on-resolve&quot;</span><span class="s2">] = async (id</span><span class="s1">, </span><span class="s2">request) =&gt; {</span>
    <span class="s1">let </span><span class="s2">response = {}</span><span class="s1">, </span><span class="s2">name = </span><span class="s0">&quot;&quot;</span><span class="s1">, </span><span class="s2">callback</span><span class="s1">, </span><span class="s2">note</span><span class="s1">;</span>
    <span class="s1">for </span><span class="s2">(</span><span class="s1">let </span><span class="s2">id2 of request.ids) {</span>
      <span class="s1">try </span><span class="s2">{</span>
        <span class="s2">({ name</span><span class="s1">, </span><span class="s2">callback</span><span class="s1">, </span><span class="s2">note } = onResolveCallbacks[id2])</span><span class="s1">;</span>
        <span class="s1">let </span><span class="s2">result = </span><span class="s1">await </span><span class="s2">callback({</span>
          <span class="s2">path: request.path</span><span class="s1">,</span>
          <span class="s2">importer: request.importer</span><span class="s1">,</span>
          <span class="s2">namespace: request.namespace</span><span class="s1">,</span>
          <span class="s2">resolveDir: request.resolveDir</span><span class="s1">,</span>
          <span class="s2">kind: request.kind</span><span class="s1">,</span>
          <span class="s2">pluginData: details.load(request.pluginData)</span>
        <span class="s2">})</span><span class="s1">;</span>
        <span class="s1">if </span><span class="s2">(result != </span><span class="s1">null</span><span class="s2">) {</span>
          <span class="s1">if </span><span class="s2">(</span><span class="s1">typeof </span><span class="s2">result !== </span><span class="s0">&quot;object&quot;</span><span class="s2">)</span>
            <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">`Expected onResolve() callback in plugin </span><span class="s2">${quote(name)} </span><span class="s0">to return an object`</span><span class="s2">)</span><span class="s1">;</span>
          <span class="s1">let </span><span class="s2">keys = {}</span><span class="s1">;</span>
          <span class="s1">let </span><span class="s2">pluginName = getFlag(result</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;pluginName&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
          <span class="s1">let </span><span class="s2">path3 = getFlag(result</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;path&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
          <span class="s1">let </span><span class="s2">namespace = getFlag(result</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;namespace&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
          <span class="s1">let </span><span class="s2">suffix = getFlag(result</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;suffix&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
          <span class="s1">let </span><span class="s2">external = getFlag(result</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;external&quot;</span><span class="s1">, </span><span class="s2">mustBeBoolean)</span><span class="s1">;</span>
          <span class="s1">let </span><span class="s2">sideEffects = getFlag(result</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;sideEffects&quot;</span><span class="s1">, </span><span class="s2">mustBeBoolean)</span><span class="s1">;</span>
          <span class="s1">let </span><span class="s2">pluginData = getFlag(result</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;pluginData&quot;</span><span class="s1">, </span><span class="s2">canBeAnything)</span><span class="s1">;</span>
          <span class="s1">let </span><span class="s2">errors = getFlag(result</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;errors&quot;</span><span class="s1">, </span><span class="s2">mustBeArray)</span><span class="s1">;</span>
          <span class="s1">let </span><span class="s2">warnings = getFlag(result</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;warnings&quot;</span><span class="s1">, </span><span class="s2">mustBeArray)</span><span class="s1">;</span>
          <span class="s1">let </span><span class="s2">watchFiles = getFlag(result</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;watchFiles&quot;</span><span class="s1">, </span><span class="s2">mustBeArray)</span><span class="s1">;</span>
          <span class="s1">let </span><span class="s2">watchDirs = getFlag(result</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;watchDirs&quot;</span><span class="s1">, </span><span class="s2">mustBeArray)</span><span class="s1">;</span>
          <span class="s2">checkForInvalidFlags(result</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">`from onResolve() callback in plugin </span><span class="s2">${quote(name)}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
          <span class="s2">response.id = id2</span><span class="s1">;</span>
          <span class="s1">if </span><span class="s2">(pluginName != </span><span class="s1">null</span><span class="s2">)</span>
            <span class="s2">response.pluginName = pluginName</span><span class="s1">;</span>
          <span class="s1">if </span><span class="s2">(path3 != </span><span class="s1">null</span><span class="s2">)</span>
            <span class="s2">response.path = path3</span><span class="s1">;</span>
          <span class="s1">if </span><span class="s2">(namespace != </span><span class="s1">null</span><span class="s2">)</span>
            <span class="s2">response.namespace = namespace</span><span class="s1">;</span>
          <span class="s1">if </span><span class="s2">(suffix != </span><span class="s1">null</span><span class="s2">)</span>
            <span class="s2">response.suffix = suffix</span><span class="s1">;</span>
          <span class="s1">if </span><span class="s2">(external != </span><span class="s1">null</span><span class="s2">)</span>
            <span class="s2">response.external = external</span><span class="s1">;</span>
          <span class="s1">if </span><span class="s2">(sideEffects != </span><span class="s1">null</span><span class="s2">)</span>
            <span class="s2">response.sideEffects = sideEffects</span><span class="s1">;</span>
          <span class="s1">if </span><span class="s2">(pluginData != </span><span class="s1">null</span><span class="s2">)</span>
            <span class="s2">response.pluginData = details.store(pluginData)</span><span class="s1">;</span>
          <span class="s1">if </span><span class="s2">(errors != </span><span class="s1">null</span><span class="s2">)</span>
            <span class="s2">response.errors = sanitizeMessages(errors</span><span class="s1">, </span><span class="s0">&quot;errors&quot;</span><span class="s1">, </span><span class="s2">details</span><span class="s1">, </span><span class="s2">name)</span><span class="s1">;</span>
          <span class="s1">if </span><span class="s2">(warnings != </span><span class="s1">null</span><span class="s2">)</span>
            <span class="s2">response.warnings = sanitizeMessages(warnings</span><span class="s1">, </span><span class="s0">&quot;warnings&quot;</span><span class="s1">, </span><span class="s2">details</span><span class="s1">, </span><span class="s2">name)</span><span class="s1">;</span>
          <span class="s1">if </span><span class="s2">(watchFiles != </span><span class="s1">null</span><span class="s2">)</span>
            <span class="s2">response.watchFiles = sanitizeStringArray(watchFiles</span><span class="s1">, </span><span class="s0">&quot;watchFiles&quot;</span><span class="s2">)</span><span class="s1">;</span>
          <span class="s1">if </span><span class="s2">(watchDirs != </span><span class="s1">null</span><span class="s2">)</span>
            <span class="s2">response.watchDirs = sanitizeStringArray(watchDirs</span><span class="s1">, </span><span class="s0">&quot;watchDirs&quot;</span><span class="s2">)</span><span class="s1">;</span>
          <span class="s1">break;</span>
        <span class="s2">}</span>
      <span class="s2">} </span><span class="s1">catch </span><span class="s2">(e) {</span>
        <span class="s2">response = { id: id2</span><span class="s1">, </span><span class="s2">errors: [extractErrorMessageV8(e</span><span class="s1">, </span><span class="s2">streamIn</span><span class="s1">, </span><span class="s2">details</span><span class="s1">, </span><span class="s2">note &amp;&amp; note()</span><span class="s1">, </span><span class="s2">name)] }</span><span class="s1">;</span>
        <span class="s1">break;</span>
      <span class="s2">}</span>
    <span class="s2">}</span>
    <span class="s2">sendResponse(id</span><span class="s1">, </span><span class="s2">response)</span><span class="s1">;</span>
  <span class="s2">}</span><span class="s1">;</span>
  <span class="s2">requestCallbacks[</span><span class="s0">&quot;on-load&quot;</span><span class="s2">] = async (id</span><span class="s1">, </span><span class="s2">request) =&gt; {</span>
    <span class="s1">let </span><span class="s2">response = {}</span><span class="s1">, </span><span class="s2">name = </span><span class="s0">&quot;&quot;</span><span class="s1">, </span><span class="s2">callback</span><span class="s1">, </span><span class="s2">note</span><span class="s1">;</span>
    <span class="s1">for </span><span class="s2">(</span><span class="s1">let </span><span class="s2">id2 of request.ids) {</span>
      <span class="s1">try </span><span class="s2">{</span>
        <span class="s2">({ name</span><span class="s1">, </span><span class="s2">callback</span><span class="s1">, </span><span class="s2">note } = onLoadCallbacks[id2])</span><span class="s1">;</span>
        <span class="s1">let </span><span class="s2">result = </span><span class="s1">await </span><span class="s2">callback({</span>
          <span class="s2">path: request.path</span><span class="s1">,</span>
          <span class="s2">namespace: request.namespace</span><span class="s1">,</span>
          <span class="s2">suffix: request.suffix</span><span class="s1">,</span>
          <span class="s2">pluginData: details.load(request.pluginData)</span>
        <span class="s2">})</span><span class="s1">;</span>
        <span class="s1">if </span><span class="s2">(result != </span><span class="s1">null</span><span class="s2">) {</span>
          <span class="s1">if </span><span class="s2">(</span><span class="s1">typeof </span><span class="s2">result !== </span><span class="s0">&quot;object&quot;</span><span class="s2">)</span>
            <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">`Expected onLoad() callback in plugin </span><span class="s2">${quote(name)} </span><span class="s0">to return an object`</span><span class="s2">)</span><span class="s1">;</span>
          <span class="s1">let </span><span class="s2">keys = {}</span><span class="s1">;</span>
          <span class="s1">let </span><span class="s2">pluginName = getFlag(result</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;pluginName&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
          <span class="s1">let </span><span class="s2">contents = getFlag(result</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;contents&quot;</span><span class="s1">, </span><span class="s2">mustBeStringOrUint8Array)</span><span class="s1">;</span>
          <span class="s1">let </span><span class="s2">resolveDir = getFlag(result</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;resolveDir&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
          <span class="s1">let </span><span class="s2">pluginData = getFlag(result</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;pluginData&quot;</span><span class="s1">, </span><span class="s2">canBeAnything)</span><span class="s1">;</span>
          <span class="s1">let </span><span class="s2">loader = getFlag(result</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;loader&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
          <span class="s1">let </span><span class="s2">errors = getFlag(result</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;errors&quot;</span><span class="s1">, </span><span class="s2">mustBeArray)</span><span class="s1">;</span>
          <span class="s1">let </span><span class="s2">warnings = getFlag(result</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;warnings&quot;</span><span class="s1">, </span><span class="s2">mustBeArray)</span><span class="s1">;</span>
          <span class="s1">let </span><span class="s2">watchFiles = getFlag(result</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;watchFiles&quot;</span><span class="s1">, </span><span class="s2">mustBeArray)</span><span class="s1">;</span>
          <span class="s1">let </span><span class="s2">watchDirs = getFlag(result</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;watchDirs&quot;</span><span class="s1">, </span><span class="s2">mustBeArray)</span><span class="s1">;</span>
          <span class="s2">checkForInvalidFlags(result</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">`from onLoad() callback in plugin </span><span class="s2">${quote(name)}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
          <span class="s2">response.id = id2</span><span class="s1">;</span>
          <span class="s1">if </span><span class="s2">(pluginName != </span><span class="s1">null</span><span class="s2">)</span>
            <span class="s2">response.pluginName = pluginName</span><span class="s1">;</span>
          <span class="s1">if </span><span class="s2">(contents </span><span class="s1">instanceof </span><span class="s2">Uint8Array)</span>
            <span class="s2">response.contents = contents</span><span class="s1">;</span>
          <span class="s1">else if </span><span class="s2">(contents != </span><span class="s1">null</span><span class="s2">)</span>
            <span class="s2">response.contents = encodeUTF8(contents)</span><span class="s1">;</span>
          <span class="s1">if </span><span class="s2">(resolveDir != </span><span class="s1">null</span><span class="s2">)</span>
            <span class="s2">response.resolveDir = resolveDir</span><span class="s1">;</span>
          <span class="s1">if </span><span class="s2">(pluginData != </span><span class="s1">null</span><span class="s2">)</span>
            <span class="s2">response.pluginData = details.store(pluginData)</span><span class="s1">;</span>
          <span class="s1">if </span><span class="s2">(loader != </span><span class="s1">null</span><span class="s2">)</span>
            <span class="s2">response.loader = loader</span><span class="s1">;</span>
          <span class="s1">if </span><span class="s2">(errors != </span><span class="s1">null</span><span class="s2">)</span>
            <span class="s2">response.errors = sanitizeMessages(errors</span><span class="s1">, </span><span class="s0">&quot;errors&quot;</span><span class="s1">, </span><span class="s2">details</span><span class="s1">, </span><span class="s2">name)</span><span class="s1">;</span>
          <span class="s1">if </span><span class="s2">(warnings != </span><span class="s1">null</span><span class="s2">)</span>
            <span class="s2">response.warnings = sanitizeMessages(warnings</span><span class="s1">, </span><span class="s0">&quot;warnings&quot;</span><span class="s1">, </span><span class="s2">details</span><span class="s1">, </span><span class="s2">name)</span><span class="s1">;</span>
          <span class="s1">if </span><span class="s2">(watchFiles != </span><span class="s1">null</span><span class="s2">)</span>
            <span class="s2">response.watchFiles = sanitizeStringArray(watchFiles</span><span class="s1">, </span><span class="s0">&quot;watchFiles&quot;</span><span class="s2">)</span><span class="s1">;</span>
          <span class="s1">if </span><span class="s2">(watchDirs != </span><span class="s1">null</span><span class="s2">)</span>
            <span class="s2">response.watchDirs = sanitizeStringArray(watchDirs</span><span class="s1">, </span><span class="s0">&quot;watchDirs&quot;</span><span class="s2">)</span><span class="s1">;</span>
          <span class="s1">break;</span>
        <span class="s2">}</span>
      <span class="s2">} </span><span class="s1">catch </span><span class="s2">(e) {</span>
        <span class="s2">response = { id: id2</span><span class="s1">, </span><span class="s2">errors: [extractErrorMessageV8(e</span><span class="s1">, </span><span class="s2">streamIn</span><span class="s1">, </span><span class="s2">details</span><span class="s1">, </span><span class="s2">note &amp;&amp; note()</span><span class="s1">, </span><span class="s2">name)] }</span><span class="s1">;</span>
        <span class="s1">break;</span>
      <span class="s2">}</span>
    <span class="s2">}</span>
    <span class="s2">sendResponse(id</span><span class="s1">, </span><span class="s2">response)</span><span class="s1">;</span>
  <span class="s2">}</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">runOnEndCallbacks = (result</span><span class="s1">, </span><span class="s2">done) =&gt; done([]</span><span class="s1">, </span><span class="s2">[])</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(onEndCallbacks.length &gt; </span><span class="s4">0</span><span class="s2">) {</span>
    <span class="s2">runOnEndCallbacks = (result</span><span class="s1">, </span><span class="s2">done) =&gt; {</span>
      <span class="s2">(async () =&gt; {</span>
        <span class="s1">const </span><span class="s2">onEndErrors = []</span><span class="s1">;</span>
        <span class="s1">const </span><span class="s2">onEndWarnings = []</span><span class="s1">;</span>
        <span class="s1">for </span><span class="s2">(</span><span class="s1">const </span><span class="s2">{ name</span><span class="s1">, </span><span class="s2">callback</span><span class="s1">, </span><span class="s2">note } of onEndCallbacks) {</span>
          <span class="s1">let </span><span class="s2">newErrors</span><span class="s1">;</span>
          <span class="s1">let </span><span class="s2">newWarnings</span><span class="s1">;</span>
          <span class="s1">try </span><span class="s2">{</span>
            <span class="s1">const </span><span class="s2">value = </span><span class="s1">await </span><span class="s2">callback(result)</span><span class="s1">;</span>
            <span class="s1">if </span><span class="s2">(value != </span><span class="s1">null</span><span class="s2">) {</span>
              <span class="s1">if </span><span class="s2">(</span><span class="s1">typeof </span><span class="s2">value !== </span><span class="s0">&quot;object&quot;</span><span class="s2">)</span>
                <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">`Expected onEnd() callback in plugin </span><span class="s2">${quote(name)} </span><span class="s0">to return an object`</span><span class="s2">)</span><span class="s1">;</span>
              <span class="s1">let </span><span class="s2">keys = {}</span><span class="s1">;</span>
              <span class="s1">let </span><span class="s2">errors = getFlag(value</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;errors&quot;</span><span class="s1">, </span><span class="s2">mustBeArray)</span><span class="s1">;</span>
              <span class="s1">let </span><span class="s2">warnings = getFlag(value</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;warnings&quot;</span><span class="s1">, </span><span class="s2">mustBeArray)</span><span class="s1">;</span>
              <span class="s2">checkForInvalidFlags(value</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">`from onEnd() callback in plugin </span><span class="s2">${quote(name)}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
              <span class="s1">if </span><span class="s2">(errors != </span><span class="s1">null</span><span class="s2">)</span>
                <span class="s2">newErrors = sanitizeMessages(errors</span><span class="s1">, </span><span class="s0">&quot;errors&quot;</span><span class="s1">, </span><span class="s2">details</span><span class="s1">, </span><span class="s2">name)</span><span class="s1">;</span>
              <span class="s1">if </span><span class="s2">(warnings != </span><span class="s1">null</span><span class="s2">)</span>
                <span class="s2">newWarnings = sanitizeMessages(warnings</span><span class="s1">, </span><span class="s0">&quot;warnings&quot;</span><span class="s1">, </span><span class="s2">details</span><span class="s1">, </span><span class="s2">name)</span><span class="s1">;</span>
            <span class="s2">}</span>
          <span class="s2">} </span><span class="s1">catch </span><span class="s2">(e) {</span>
            <span class="s2">newErrors = [extractErrorMessageV8(e</span><span class="s1">, </span><span class="s2">streamIn</span><span class="s1">, </span><span class="s2">details</span><span class="s1">, </span><span class="s2">note &amp;&amp; note()</span><span class="s1">, </span><span class="s2">name)]</span><span class="s1">;</span>
          <span class="s2">}</span>
          <span class="s1">if </span><span class="s2">(newErrors) {</span>
            <span class="s2">onEndErrors.push(...newErrors)</span><span class="s1">;</span>
            <span class="s1">try </span><span class="s2">{</span>
              <span class="s2">result.errors.push(...newErrors)</span><span class="s1">;</span>
            <span class="s2">} </span><span class="s1">catch </span><span class="s2">{</span>
            <span class="s2">}</span>
          <span class="s2">}</span>
          <span class="s1">if </span><span class="s2">(newWarnings) {</span>
            <span class="s2">onEndWarnings.push(...newWarnings)</span><span class="s1">;</span>
            <span class="s1">try </span><span class="s2">{</span>
              <span class="s2">result.warnings.push(...newWarnings)</span><span class="s1">;</span>
            <span class="s2">} </span><span class="s1">catch </span><span class="s2">{</span>
            <span class="s2">}</span>
          <span class="s2">}</span>
        <span class="s2">}</span>
        <span class="s2">done(onEndErrors</span><span class="s1">, </span><span class="s2">onEndWarnings)</span><span class="s1">;</span>
      <span class="s2">})()</span><span class="s1">;</span>
    <span class="s2">}</span><span class="s1">;</span>
  <span class="s2">}</span>
  <span class="s1">let </span><span class="s2">scheduleOnDisposeCallbacks = () =&gt; {</span>
    <span class="s1">for </span><span class="s2">(</span><span class="s1">const </span><span class="s2">cb of onDisposeCallbacks) {</span>
      <span class="s2">setTimeout(() =&gt; cb()</span><span class="s1">, </span><span class="s4">0</span><span class="s2">)</span><span class="s1">;</span>
    <span class="s2">}</span>
  <span class="s2">}</span><span class="s1">;</span>
  <span class="s2">isSetupDone = </span><span class="s1">true;</span>
  <span class="s1">return </span><span class="s2">{</span>
    <span class="s2">ok: </span><span class="s1">true,</span>
    <span class="s2">requestPlugins</span><span class="s1">,</span>
    <span class="s2">runOnEndCallbacks</span><span class="s1">,</span>
    <span class="s2">scheduleOnDisposeCallbacks</span>
  <span class="s2">}</span><span class="s1">;</span>
<span class="s2">}</span><span class="s1">;</span>
<span class="s1">function </span><span class="s2">createObjectStash() {</span>
  <span class="s1">const </span><span class="s2">map = </span><span class="s3">/* @__PURE__ */ </span><span class="s1">new </span><span class="s2">Map()</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">nextID = </span><span class="s4">0</span><span class="s1">;</span>
  <span class="s1">return </span><span class="s2">{</span>
    <span class="s2">load(id) {</span>
      <span class="s1">return </span><span class="s2">map.get(id)</span><span class="s1">;</span>
    <span class="s2">}</span><span class="s1">,</span>
    <span class="s2">store(value) {</span>
      <span class="s1">if </span><span class="s2">(value === </span><span class="s1">void </span><span class="s4">0</span><span class="s2">)</span>
        <span class="s1">return </span><span class="s2">-</span><span class="s4">1</span><span class="s1">;</span>
      <span class="s1">const </span><span class="s2">id = nextID++</span><span class="s1">;</span>
      <span class="s2">map.set(id</span><span class="s1">, </span><span class="s2">value)</span><span class="s1">;</span>
      <span class="s1">return </span><span class="s2">id</span><span class="s1">;</span>
    <span class="s2">}</span>
  <span class="s2">}</span><span class="s1">;</span>
<span class="s2">}</span>
<span class="s1">function </span><span class="s2">extractCallerV8(e</span><span class="s1">, </span><span class="s2">streamIn</span><span class="s1">, </span><span class="s2">ident) {</span>
  <span class="s1">let </span><span class="s2">note</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">tried = </span><span class="s1">false;</span>
  <span class="s1">return </span><span class="s2">() =&gt; {</span>
    <span class="s1">if </span><span class="s2">(tried)</span>
      <span class="s1">return </span><span class="s2">note</span><span class="s1">;</span>
    <span class="s2">tried = </span><span class="s1">true;</span>
    <span class="s1">try </span><span class="s2">{</span>
      <span class="s1">let </span><span class="s2">lines = (e.stack + </span><span class="s0">&quot;&quot;</span><span class="s2">).split(</span><span class="s0">&quot;</span><span class="s1">\n</span><span class="s0">&quot;</span><span class="s2">)</span><span class="s1">;</span>
      <span class="s2">lines.splice(</span><span class="s4">1</span><span class="s1">, </span><span class="s4">1</span><span class="s2">)</span><span class="s1">;</span>
      <span class="s1">let </span><span class="s2">location = parseStackLinesV8(streamIn</span><span class="s1">, </span><span class="s2">lines</span><span class="s1">, </span><span class="s2">ident)</span><span class="s1">;</span>
      <span class="s1">if </span><span class="s2">(location) {</span>
        <span class="s2">note = { text: e.message</span><span class="s1">, </span><span class="s2">location }</span><span class="s1">;</span>
        <span class="s1">return </span><span class="s2">note</span><span class="s1">;</span>
      <span class="s2">}</span>
    <span class="s2">} </span><span class="s1">catch </span><span class="s2">{</span>
    <span class="s2">}</span>
  <span class="s2">}</span><span class="s1">;</span>
<span class="s2">}</span>
<span class="s1">function </span><span class="s2">extractErrorMessageV8(e</span><span class="s1">, </span><span class="s2">streamIn</span><span class="s1">, </span><span class="s2">stash</span><span class="s1">, </span><span class="s2">note</span><span class="s1">, </span><span class="s2">pluginName) {</span>
  <span class="s1">let </span><span class="s2">text = </span><span class="s0">&quot;Internal error&quot;</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">location = </span><span class="s1">null;</span>
  <span class="s1">try </span><span class="s2">{</span>
    <span class="s2">text = (e &amp;&amp; e.message || e) + </span><span class="s0">&quot;&quot;</span><span class="s1">;</span>
  <span class="s2">} </span><span class="s1">catch </span><span class="s2">{</span>
  <span class="s2">}</span>
  <span class="s1">try </span><span class="s2">{</span>
    <span class="s2">location = parseStackLinesV8(streamIn</span><span class="s1">, </span><span class="s2">(e.stack + </span><span class="s0">&quot;&quot;</span><span class="s2">).split(</span><span class="s0">&quot;</span><span class="s1">\n</span><span class="s0">&quot;</span><span class="s2">)</span><span class="s1">, </span><span class="s0">&quot;&quot;</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s2">} </span><span class="s1">catch </span><span class="s2">{</span>
  <span class="s2">}</span>
  <span class="s1">return </span><span class="s2">{ id: </span><span class="s0">&quot;&quot;</span><span class="s1">, </span><span class="s2">pluginName</span><span class="s1">, </span><span class="s2">text</span><span class="s1">, </span><span class="s2">location</span><span class="s1">, </span><span class="s2">notes: note ? [note] : []</span><span class="s1">, </span><span class="s2">detail: stash ? stash.store(e) : -</span><span class="s4">1 </span><span class="s2">}</span><span class="s1">;</span>
<span class="s2">}</span>
<span class="s1">function </span><span class="s2">parseStackLinesV8(streamIn</span><span class="s1">, </span><span class="s2">lines</span><span class="s1">, </span><span class="s2">ident) {</span>
  <span class="s1">let </span><span class="s2">at = </span><span class="s0">&quot;    at &quot;</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(streamIn.readFileSync &amp;&amp; !lines[</span><span class="s4">0</span><span class="s2">].startsWith(at) &amp;&amp; lines[</span><span class="s4">1</span><span class="s2">].startsWith(at)) {</span>
    <span class="s1">for </span><span class="s2">(</span><span class="s1">let </span><span class="s2">i = </span><span class="s4">1</span><span class="s1">; </span><span class="s2">i &lt; lines.length</span><span class="s1">; </span><span class="s2">i++) {</span>
      <span class="s1">let </span><span class="s2">line = lines[i]</span><span class="s1">;</span>
      <span class="s1">if </span><span class="s2">(!line.startsWith(at))</span>
        <span class="s1">continue;</span>
      <span class="s2">line = line.slice(at.length)</span><span class="s1">;</span>
      <span class="s1">while </span><span class="s2">(</span><span class="s1">true</span><span class="s2">) {</span>
        <span class="s1">let </span><span class="s2">match = </span><span class="s4">/^(?:new |async )?\S+ \((.*)\)$/</span><span class="s2">.exec(line)</span><span class="s1">;</span>
        <span class="s1">if </span><span class="s2">(match) {</span>
          <span class="s2">line = match[</span><span class="s4">1</span><span class="s2">]</span><span class="s1">;</span>
          <span class="s1">continue;</span>
        <span class="s2">}</span>
        <span class="s2">match = </span><span class="s4">/^eval at \S+ \((.*)\)(?:, \S+:\d+:\d+)?$/</span><span class="s2">.exec(line)</span><span class="s1">;</span>
        <span class="s1">if </span><span class="s2">(match) {</span>
          <span class="s2">line = match[</span><span class="s4">1</span><span class="s2">]</span><span class="s1">;</span>
          <span class="s1">continue;</span>
        <span class="s2">}</span>
        <span class="s2">match = </span><span class="s4">/^(\S+):(\d+):(\d+)$/</span><span class="s2">.exec(line)</span><span class="s1">;</span>
        <span class="s1">if </span><span class="s2">(match) {</span>
          <span class="s1">let </span><span class="s2">contents</span><span class="s1">;</span>
          <span class="s1">try </span><span class="s2">{</span>
            <span class="s2">contents = streamIn.readFileSync(match[</span><span class="s4">1</span><span class="s2">]</span><span class="s1">, </span><span class="s0">&quot;utf8&quot;</span><span class="s2">)</span><span class="s1">;</span>
          <span class="s2">} </span><span class="s1">catch </span><span class="s2">{</span>
            <span class="s1">break;</span>
          <span class="s2">}</span>
          <span class="s1">let </span><span class="s2">lineText = contents.split(</span><span class="s4">/\r\n|\r|\n|\u2028|\u2029/</span><span class="s2">)[+match[</span><span class="s4">2</span><span class="s2">] - </span><span class="s4">1</span><span class="s2">] || </span><span class="s0">&quot;&quot;</span><span class="s1">;</span>
          <span class="s1">let </span><span class="s2">column = +match[</span><span class="s4">3</span><span class="s2">] - </span><span class="s4">1</span><span class="s1">;</span>
          <span class="s1">let </span><span class="s2">length = lineText.slice(column</span><span class="s1">, </span><span class="s2">column + ident.length) === ident ? ident.length : </span><span class="s4">0</span><span class="s1">;</span>
          <span class="s1">return </span><span class="s2">{</span>
            <span class="s2">file: match[</span><span class="s4">1</span><span class="s2">]</span><span class="s1">,</span>
            <span class="s2">namespace: </span><span class="s0">&quot;file&quot;</span><span class="s1">,</span>
            <span class="s2">line: +match[</span><span class="s4">2</span><span class="s2">]</span><span class="s1">,</span>
            <span class="s2">column: encodeUTF8(lineText.slice(</span><span class="s4">0</span><span class="s1">, </span><span class="s2">column)).length</span><span class="s1">,</span>
            <span class="s2">length: encodeUTF8(lineText.slice(column</span><span class="s1">, </span><span class="s2">column + length)).length</span><span class="s1">,</span>
            <span class="s2">lineText: lineText + </span><span class="s0">&quot;</span><span class="s1">\n</span><span class="s0">&quot; </span><span class="s2">+ lines.slice(</span><span class="s4">1</span><span class="s2">).join(</span><span class="s0">&quot;</span><span class="s1">\n</span><span class="s0">&quot;</span><span class="s2">)</span><span class="s1">,</span>
            <span class="s2">suggestion: </span><span class="s0">&quot;&quot;</span>
          <span class="s2">}</span><span class="s1">;</span>
        <span class="s2">}</span>
        <span class="s1">break;</span>
      <span class="s2">}</span>
    <span class="s2">}</span>
  <span class="s2">}</span>
  <span class="s1">return null;</span>
<span class="s2">}</span>
<span class="s1">function </span><span class="s2">failureErrorWithLog(text</span><span class="s1">, </span><span class="s2">errors</span><span class="s1">, </span><span class="s2">warnings) {</span>
  <span class="s1">let </span><span class="s2">limit = </span><span class="s4">5</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">summary = errors.length &lt; </span><span class="s4">1 </span><span class="s2">? </span><span class="s0">&quot;&quot; </span><span class="s2">: </span><span class="s0">` with </span><span class="s2">${errors.length} </span><span class="s0">error</span><span class="s2">${errors.length &lt; </span><span class="s4">2 </span><span class="s2">? </span><span class="s0">&quot;&quot; </span><span class="s2">: </span><span class="s0">&quot;s&quot;</span><span class="s2">}</span><span class="s0">:` </span><span class="s2">+ errors.slice(</span><span class="s4">0</span><span class="s1">, </span><span class="s2">limit + </span><span class="s4">1</span><span class="s2">).map((e</span><span class="s1">, </span><span class="s2">i) =&gt; {</span>
    <span class="s1">if </span><span class="s2">(i === limit)</span>
      <span class="s1">return </span><span class="s0">&quot;</span><span class="s1">\n</span><span class="s0">...&quot;</span><span class="s1">;</span>
    <span class="s1">if </span><span class="s2">(!e.location)</span>
      <span class="s1">return </span><span class="s0">`</span>
<span class="s0">error: </span><span class="s2">${e.text}</span><span class="s0">`</span><span class="s1">;</span>
    <span class="s1">let </span><span class="s2">{ file</span><span class="s1">, </span><span class="s2">line</span><span class="s1">, </span><span class="s2">column } = e.location</span><span class="s1">;</span>
    <span class="s1">let </span><span class="s2">pluginText = e.pluginName ? </span><span class="s0">`[plugin: </span><span class="s2">${e.pluginName}</span><span class="s0">] ` </span><span class="s2">: </span><span class="s0">&quot;&quot;</span><span class="s1">;</span>
    <span class="s1">return </span><span class="s0">`</span>
<span class="s2">${file}</span><span class="s0">:</span><span class="s2">${line}</span><span class="s0">:</span><span class="s2">${column}</span><span class="s0">: ERROR: </span><span class="s2">${pluginText}${e.text}</span><span class="s0">`</span><span class="s1">;</span>
  <span class="s2">}).join(</span><span class="s0">&quot;&quot;</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">error = </span><span class="s1">new </span><span class="s2">Error(</span><span class="s0">`</span><span class="s2">${text}${summary}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s2">error.errors = errors</span><span class="s1">;</span>
  <span class="s2">error.warnings = warnings</span><span class="s1">;</span>
  <span class="s1">return </span><span class="s2">error</span><span class="s1">;</span>
<span class="s2">}</span>
<span class="s1">function </span><span class="s2">replaceDetailsInMessages(messages</span><span class="s1">, </span><span class="s2">stash) {</span>
  <span class="s1">for </span><span class="s2">(</span><span class="s1">const </span><span class="s2">message of messages) {</span>
    <span class="s2">message.detail = stash.load(message.detail)</span><span class="s1">;</span>
  <span class="s2">}</span>
  <span class="s1">return </span><span class="s2">messages</span><span class="s1">;</span>
<span class="s2">}</span>
<span class="s1">function </span><span class="s2">sanitizeLocation(location</span><span class="s1">, </span><span class="s2">where) {</span>
  <span class="s1">if </span><span class="s2">(location == </span><span class="s1">null</span><span class="s2">)</span>
    <span class="s1">return null;</span>
  <span class="s1">let </span><span class="s2">keys = {}</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">file = getFlag(location</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;file&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">namespace = getFlag(location</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;namespace&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">line = getFlag(location</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;line&quot;</span><span class="s1">, </span><span class="s2">mustBeInteger)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">column = getFlag(location</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;column&quot;</span><span class="s1">, </span><span class="s2">mustBeInteger)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">length = getFlag(location</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;length&quot;</span><span class="s1">, </span><span class="s2">mustBeInteger)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">lineText = getFlag(location</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;lineText&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">suggestion = getFlag(location</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;suggestion&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
  <span class="s2">checkForInvalidFlags(location</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s2">where)</span><span class="s1">;</span>
  <span class="s1">return </span><span class="s2">{</span>
    <span class="s2">file: file || </span><span class="s0">&quot;&quot;</span><span class="s1">,</span>
    <span class="s2">namespace: namespace || </span><span class="s0">&quot;&quot;</span><span class="s1">,</span>
    <span class="s2">line: line || </span><span class="s4">0</span><span class="s1">,</span>
    <span class="s2">column: column || </span><span class="s4">0</span><span class="s1">,</span>
    <span class="s2">length: length || </span><span class="s4">0</span><span class="s1">,</span>
    <span class="s2">lineText: lineText || </span><span class="s0">&quot;&quot;</span><span class="s1">,</span>
    <span class="s2">suggestion: suggestion || </span><span class="s0">&quot;&quot;</span>
  <span class="s2">}</span><span class="s1">;</span>
<span class="s2">}</span>
<span class="s1">function </span><span class="s2">sanitizeMessages(messages</span><span class="s1">, </span><span class="s2">property</span><span class="s1">, </span><span class="s2">stash</span><span class="s1">, </span><span class="s2">fallbackPluginName) {</span>
  <span class="s1">let </span><span class="s2">messagesClone = []</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">index = </span><span class="s4">0</span><span class="s1">;</span>
  <span class="s1">for </span><span class="s2">(</span><span class="s1">const </span><span class="s2">message of messages) {</span>
    <span class="s1">let </span><span class="s2">keys = {}</span><span class="s1">;</span>
    <span class="s1">let </span><span class="s2">id = getFlag(message</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;id&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
    <span class="s1">let </span><span class="s2">pluginName = getFlag(message</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;pluginName&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
    <span class="s1">let </span><span class="s2">text = getFlag(message</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;text&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
    <span class="s1">let </span><span class="s2">location = getFlag(message</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;location&quot;</span><span class="s1">, </span><span class="s2">mustBeObjectOrNull)</span><span class="s1">;</span>
    <span class="s1">let </span><span class="s2">notes = getFlag(message</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;notes&quot;</span><span class="s1">, </span><span class="s2">mustBeArray)</span><span class="s1">;</span>
    <span class="s1">let </span><span class="s2">detail = getFlag(message</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s0">&quot;detail&quot;</span><span class="s1">, </span><span class="s2">canBeAnything)</span><span class="s1">;</span>
    <span class="s1">let </span><span class="s2">where = </span><span class="s0">`in element </span><span class="s2">${index} </span><span class="s0">of &quot;</span><span class="s2">${property}</span><span class="s0">&quot;`</span><span class="s1">;</span>
    <span class="s2">checkForInvalidFlags(message</span><span class="s1">, </span><span class="s2">keys</span><span class="s1">, </span><span class="s2">where)</span><span class="s1">;</span>
    <span class="s1">let </span><span class="s2">notesClone = []</span><span class="s1">;</span>
    <span class="s1">if </span><span class="s2">(notes) {</span>
      <span class="s1">for </span><span class="s2">(</span><span class="s1">const </span><span class="s2">note of notes) {</span>
        <span class="s1">let </span><span class="s2">noteKeys = {}</span><span class="s1">;</span>
        <span class="s1">let </span><span class="s2">noteText = getFlag(note</span><span class="s1">, </span><span class="s2">noteKeys</span><span class="s1">, </span><span class="s0">&quot;text&quot;</span><span class="s1">, </span><span class="s2">mustBeString)</span><span class="s1">;</span>
        <span class="s1">let </span><span class="s2">noteLocation = getFlag(note</span><span class="s1">, </span><span class="s2">noteKeys</span><span class="s1">, </span><span class="s0">&quot;location&quot;</span><span class="s1">, </span><span class="s2">mustBeObjectOrNull)</span><span class="s1">;</span>
        <span class="s2">checkForInvalidFlags(note</span><span class="s1">, </span><span class="s2">noteKeys</span><span class="s1">, </span><span class="s2">where)</span><span class="s1">;</span>
        <span class="s2">notesClone.push({</span>
          <span class="s2">text: noteText || </span><span class="s0">&quot;&quot;</span><span class="s1">,</span>
          <span class="s2">location: sanitizeLocation(noteLocation</span><span class="s1">, </span><span class="s2">where)</span>
        <span class="s2">})</span><span class="s1">;</span>
      <span class="s2">}</span>
    <span class="s2">}</span>
    <span class="s2">messagesClone.push({</span>
      <span class="s2">id: id || </span><span class="s0">&quot;&quot;</span><span class="s1">,</span>
      <span class="s2">pluginName: pluginName || fallbackPluginName</span><span class="s1">,</span>
      <span class="s2">text: text || </span><span class="s0">&quot;&quot;</span><span class="s1">,</span>
      <span class="s2">location: sanitizeLocation(location</span><span class="s1">, </span><span class="s2">where)</span><span class="s1">,</span>
      <span class="s2">notes: notesClone</span><span class="s1">,</span>
      <span class="s2">detail: stash ? stash.store(detail) : -</span><span class="s4">1</span>
    <span class="s2">})</span><span class="s1">;</span>
    <span class="s2">index++</span><span class="s1">;</span>
  <span class="s2">}</span>
  <span class="s1">return </span><span class="s2">messagesClone</span><span class="s1">;</span>
<span class="s2">}</span>
<span class="s1">function </span><span class="s2">sanitizeStringArray(values</span><span class="s1">, </span><span class="s2">property) {</span>
  <span class="s1">const </span><span class="s2">result = []</span><span class="s1">;</span>
  <span class="s1">for </span><span class="s2">(</span><span class="s1">const </span><span class="s2">value of values) {</span>
    <span class="s1">if </span><span class="s2">(</span><span class="s1">typeof </span><span class="s2">value !== </span><span class="s0">&quot;string&quot;</span><span class="s2">)</span>
      <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">`</span><span class="s2">${quote(property)} </span><span class="s0">must be an array of strings`</span><span class="s2">)</span><span class="s1">;</span>
    <span class="s2">result.push(value)</span><span class="s1">;</span>
  <span class="s2">}</span>
  <span class="s1">return </span><span class="s2">result</span><span class="s1">;</span>
<span class="s2">}</span>
<span class="s1">function </span><span class="s2">convertOutputFiles({ path: path3</span><span class="s1">, </span><span class="s2">contents }) {</span>
  <span class="s1">let </span><span class="s2">text = </span><span class="s1">null;</span>
  <span class="s1">return </span><span class="s2">{</span>
    <span class="s2">path: path3</span><span class="s1">,</span>
    <span class="s2">contents</span><span class="s1">,</span>
    <span class="s2">get text() {</span>
      <span class="s1">const </span><span class="s2">binary = </span><span class="s1">this</span><span class="s2">.contents</span><span class="s1">;</span>
      <span class="s1">if </span><span class="s2">(text === </span><span class="s1">null </span><span class="s2">|| binary !== contents) {</span>
        <span class="s2">contents = binary</span><span class="s1">;</span>
        <span class="s2">text = decodeUTF8(binary)</span><span class="s1">;</span>
      <span class="s2">}</span>
      <span class="s1">return </span><span class="s2">text</span><span class="s1">;</span>
    <span class="s2">}</span>
  <span class="s2">}</span><span class="s1">;</span>
<span class="s2">}</span>

<span class="s3">// lib/npm/node-platform.ts</span>
<span class="s1">var </span><span class="s2">fs = require(</span><span class="s0">&quot;fs&quot;</span><span class="s2">)</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">os = require(</span><span class="s0">&quot;os&quot;</span><span class="s2">)</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">path = require(</span><span class="s0">&quot;path&quot;</span><span class="s2">)</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">ESBUILD_BINARY_PATH = process.env.ESBUILD_BINARY_PATH || ESBUILD_BINARY_PATH</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">isValidBinaryPath = (x) =&gt; !!x &amp;&amp; x !== </span><span class="s0">&quot;/usr/bin/esbuild&quot;</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">packageDarwin_arm64 = </span><span class="s0">&quot;@esbuild/darwin-arm64&quot;</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">packageDarwin_x64 = </span><span class="s0">&quot;@esbuild/darwin-x64&quot;</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">knownWindowsPackages = {</span>
  <span class="s0">&quot;win32 arm64 LE&quot;</span><span class="s2">: </span><span class="s0">&quot;@esbuild/win32-arm64&quot;</span><span class="s1">,</span>
  <span class="s0">&quot;win32 ia32 LE&quot;</span><span class="s2">: </span><span class="s0">&quot;@esbuild/win32-ia32&quot;</span><span class="s1">,</span>
  <span class="s0">&quot;win32 x64 LE&quot;</span><span class="s2">: </span><span class="s0">&quot;@esbuild/win32-x64&quot;</span>
<span class="s2">}</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">knownUnixlikePackages = {</span>
  <span class="s0">&quot;android arm64 LE&quot;</span><span class="s2">: </span><span class="s0">&quot;@esbuild/android-arm64&quot;</span><span class="s1">,</span>
  <span class="s0">&quot;darwin arm64 LE&quot;</span><span class="s2">: </span><span class="s0">&quot;@esbuild/darwin-arm64&quot;</span><span class="s1">,</span>
  <span class="s0">&quot;darwin x64 LE&quot;</span><span class="s2">: </span><span class="s0">&quot;@esbuild/darwin-x64&quot;</span><span class="s1">,</span>
  <span class="s0">&quot;freebsd arm64 LE&quot;</span><span class="s2">: </span><span class="s0">&quot;@esbuild/freebsd-arm64&quot;</span><span class="s1">,</span>
  <span class="s0">&quot;freebsd x64 LE&quot;</span><span class="s2">: </span><span class="s0">&quot;@esbuild/freebsd-x64&quot;</span><span class="s1">,</span>
  <span class="s0">&quot;linux arm LE&quot;</span><span class="s2">: </span><span class="s0">&quot;@esbuild/linux-arm&quot;</span><span class="s1">,</span>
  <span class="s0">&quot;linux arm64 LE&quot;</span><span class="s2">: </span><span class="s0">&quot;@esbuild/linux-arm64&quot;</span><span class="s1">,</span>
  <span class="s0">&quot;linux ia32 LE&quot;</span><span class="s2">: </span><span class="s0">&quot;@esbuild/linux-ia32&quot;</span><span class="s1">,</span>
  <span class="s0">&quot;linux mips64el LE&quot;</span><span class="s2">: </span><span class="s0">&quot;@esbuild/linux-mips64el&quot;</span><span class="s1">,</span>
  <span class="s0">&quot;linux ppc64 LE&quot;</span><span class="s2">: </span><span class="s0">&quot;@esbuild/linux-ppc64&quot;</span><span class="s1">,</span>
  <span class="s0">&quot;linux riscv64 LE&quot;</span><span class="s2">: </span><span class="s0">&quot;@esbuild/linux-riscv64&quot;</span><span class="s1">,</span>
  <span class="s0">&quot;linux s390x BE&quot;</span><span class="s2">: </span><span class="s0">&quot;@esbuild/linux-s390x&quot;</span><span class="s1">,</span>
  <span class="s0">&quot;linux x64 LE&quot;</span><span class="s2">: </span><span class="s0">&quot;@esbuild/linux-x64&quot;</span><span class="s1">,</span>
  <span class="s0">&quot;linux loong64 LE&quot;</span><span class="s2">: </span><span class="s0">&quot;@esbuild/linux-loong64&quot;</span><span class="s1">,</span>
  <span class="s0">&quot;netbsd x64 LE&quot;</span><span class="s2">: </span><span class="s0">&quot;@esbuild/netbsd-x64&quot;</span><span class="s1">,</span>
  <span class="s0">&quot;openbsd x64 LE&quot;</span><span class="s2">: </span><span class="s0">&quot;@esbuild/openbsd-x64&quot;</span><span class="s1">,</span>
  <span class="s0">&quot;sunos x64 LE&quot;</span><span class="s2">: </span><span class="s0">&quot;@esbuild/sunos-x64&quot;</span>
<span class="s2">}</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">knownWebAssemblyFallbackPackages = {</span>
  <span class="s0">&quot;android arm LE&quot;</span><span class="s2">: </span><span class="s0">&quot;@esbuild/android-arm&quot;</span><span class="s1">,</span>
  <span class="s0">&quot;android x64 LE&quot;</span><span class="s2">: </span><span class="s0">&quot;@esbuild/android-x64&quot;</span>
<span class="s2">}</span><span class="s1">;</span>
<span class="s1">function </span><span class="s2">pkgAndSubpathForCurrentPlatform() {</span>
  <span class="s1">let </span><span class="s2">pkg</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">subpath</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">isWASM = </span><span class="s1">false;</span>
  <span class="s1">let </span><span class="s2">platformKey = </span><span class="s0">`</span><span class="s2">${process.platform} ${os.arch()} ${os.endianness()}</span><span class="s0">`</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(platformKey </span><span class="s1">in </span><span class="s2">knownWindowsPackages) {</span>
    <span class="s2">pkg = knownWindowsPackages[platformKey]</span><span class="s1">;</span>
    <span class="s2">subpath = </span><span class="s0">&quot;esbuild.exe&quot;</span><span class="s1">;</span>
  <span class="s2">} </span><span class="s1">else if </span><span class="s2">(platformKey </span><span class="s1">in </span><span class="s2">knownUnixlikePackages) {</span>
    <span class="s2">pkg = knownUnixlikePackages[platformKey]</span><span class="s1">;</span>
    <span class="s2">subpath = </span><span class="s0">&quot;bin/esbuild&quot;</span><span class="s1">;</span>
  <span class="s2">} </span><span class="s1">else if </span><span class="s2">(platformKey </span><span class="s1">in </span><span class="s2">knownWebAssemblyFallbackPackages) {</span>
    <span class="s2">pkg = knownWebAssemblyFallbackPackages[platformKey]</span><span class="s1">;</span>
    <span class="s2">subpath = </span><span class="s0">&quot;bin/esbuild&quot;</span><span class="s1">;</span>
    <span class="s2">isWASM = </span><span class="s1">true;</span>
  <span class="s2">} </span><span class="s1">else </span><span class="s2">{</span>
    <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">`Unsupported platform: </span><span class="s2">${platformKey}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s2">}</span>
  <span class="s1">return </span><span class="s2">{ pkg</span><span class="s1">, </span><span class="s2">subpath</span><span class="s1">, </span><span class="s2">isWASM }</span><span class="s1">;</span>
<span class="s2">}</span>
<span class="s1">function </span><span class="s2">pkgForSomeOtherPlatform() {</span>
  <span class="s1">const </span><span class="s2">libMainJS = require.resolve(</span><span class="s0">&quot;esbuild&quot;</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">const </span><span class="s2">nodeModulesDirectory = path.dirname(path.dirname(path.dirname(libMainJS)))</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(path.basename(nodeModulesDirectory) === </span><span class="s0">&quot;node_modules&quot;</span><span class="s2">) {</span>
    <span class="s1">for </span><span class="s2">(</span><span class="s1">const </span><span class="s2">unixKey </span><span class="s1">in </span><span class="s2">knownUnixlikePackages) {</span>
      <span class="s1">try </span><span class="s2">{</span>
        <span class="s1">const </span><span class="s2">pkg = knownUnixlikePackages[unixKey]</span><span class="s1">;</span>
        <span class="s1">if </span><span class="s2">(fs.existsSync(path.join(nodeModulesDirectory</span><span class="s1">, </span><span class="s2">pkg)))</span>
          <span class="s1">return </span><span class="s2">pkg</span><span class="s1">;</span>
      <span class="s2">} </span><span class="s1">catch </span><span class="s2">{</span>
      <span class="s2">}</span>
    <span class="s2">}</span>
    <span class="s1">for </span><span class="s2">(</span><span class="s1">const </span><span class="s2">windowsKey </span><span class="s1">in </span><span class="s2">knownWindowsPackages) {</span>
      <span class="s1">try </span><span class="s2">{</span>
        <span class="s1">const </span><span class="s2">pkg = knownWindowsPackages[windowsKey]</span><span class="s1">;</span>
        <span class="s1">if </span><span class="s2">(fs.existsSync(path.join(nodeModulesDirectory</span><span class="s1">, </span><span class="s2">pkg)))</span>
          <span class="s1">return </span><span class="s2">pkg</span><span class="s1">;</span>
      <span class="s2">} </span><span class="s1">catch </span><span class="s2">{</span>
      <span class="s2">}</span>
    <span class="s2">}</span>
  <span class="s2">}</span>
  <span class="s1">return null;</span>
<span class="s2">}</span>
<span class="s1">function </span><span class="s2">downloadedBinPath(pkg</span><span class="s1">, </span><span class="s2">subpath) {</span>
  <span class="s1">const </span><span class="s2">esbuildLibDir = path.dirname(require.resolve(</span><span class="s0">&quot;esbuild&quot;</span><span class="s2">))</span><span class="s1">;</span>
  <span class="s1">return </span><span class="s2">path.join(esbuildLibDir</span><span class="s1">, </span><span class="s0">`downloaded-</span><span class="s2">${pkg.replace(</span><span class="s0">&quot;/&quot;</span><span class="s1">, </span><span class="s0">&quot;-&quot;</span><span class="s2">)}</span><span class="s0">-</span><span class="s2">${path.basename(subpath)}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
<span class="s2">}</span>
<span class="s1">function </span><span class="s2">generateBinPath() {</span>
  <span class="s1">if </span><span class="s2">(isValidBinaryPath(ESBUILD_BINARY_PATH)) {</span>
    <span class="s1">if </span><span class="s2">(!fs.existsSync(ESBUILD_BINARY_PATH)) {</span>
      <span class="s2">console.warn(</span><span class="s0">`[esbuild] Ignoring bad configuration: ESBUILD_BINARY_PATH=</span><span class="s2">${ESBUILD_BINARY_PATH}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
    <span class="s2">} </span><span class="s1">else </span><span class="s2">{</span>
      <span class="s1">return </span><span class="s2">{ binPath: ESBUILD_BINARY_PATH</span><span class="s1">, </span><span class="s2">isWASM: </span><span class="s1">false </span><span class="s2">}</span><span class="s1">;</span>
    <span class="s2">}</span>
  <span class="s2">}</span>
  <span class="s1">const </span><span class="s2">{ pkg</span><span class="s1">, </span><span class="s2">subpath</span><span class="s1">, </span><span class="s2">isWASM } = pkgAndSubpathForCurrentPlatform()</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">binPath</span><span class="s1">;</span>
  <span class="s1">try </span><span class="s2">{</span>
    <span class="s2">binPath = require.resolve(</span><span class="s0">`</span><span class="s2">${pkg}</span><span class="s0">/</span><span class="s2">${subpath}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s2">} </span><span class="s1">catch </span><span class="s2">(e) {</span>
    <span class="s2">binPath = downloadedBinPath(pkg</span><span class="s1">, </span><span class="s2">subpath)</span><span class="s1">;</span>
    <span class="s1">if </span><span class="s2">(!fs.existsSync(binPath)) {</span>
      <span class="s1">try </span><span class="s2">{</span>
        <span class="s2">require.resolve(pkg)</span><span class="s1">;</span>
      <span class="s2">} </span><span class="s1">catch </span><span class="s2">{</span>
        <span class="s1">const </span><span class="s2">otherPkg = pkgForSomeOtherPlatform()</span><span class="s1">;</span>
        <span class="s1">if </span><span class="s2">(otherPkg) {</span>
          <span class="s1">let </span><span class="s2">suggestions = </span><span class="s0">`</span>
<span class="s0">Specifically the &quot;</span><span class="s2">${otherPkg}</span><span class="s0">&quot; package is present but this platform 
needs the &quot;</span><span class="s2">${pkg}</span><span class="s0">&quot; package instead. People often get into this 
situation by installing esbuild on Windows or macOS and copying &quot;node_modules&quot; 
into a Docker image that runs Linux, or by copying &quot;node_modules&quot; between 
Windows and WSL environments. 
 
If you are installing with npm, you can try not copying the &quot;node_modules&quot; 
directory when you copy the files over, and running &quot;npm ci&quot; or &quot;npm install&quot; 
on the destination platform after the copy. Or you could consider using yarn 
instead of npm which has built-in support for installing a package on multiple 
platforms simultaneously. 
 
If you are installing with yarn, you can try listing both this platform and the 
other platform in your &quot;.yarnrc.yml&quot; file using the &quot;supportedArchitectures&quot; 
feature: https://yarnpkg.com/configuration/yarnrc/#supportedArchitectures 
Keep in mind that this means multiple copies of esbuild will be present. 
`</span><span class="s1">;</span>
          <span class="s1">if </span><span class="s2">(pkg === packageDarwin_x64 &amp;&amp; otherPkg === packageDarwin_arm64 || pkg === packageDarwin_arm64 &amp;&amp; otherPkg === packageDarwin_x64) {</span>
            <span class="s2">suggestions = </span><span class="s0">`</span>
<span class="s0">Specifically the &quot;</span><span class="s2">${otherPkg}</span><span class="s0">&quot; package is present but this platform 
needs the &quot;</span><span class="s2">${pkg}</span><span class="s0">&quot; package instead. People often get into this 
situation by installing esbuild with npm running inside of Rosetta 2 and then 
trying to use it with node running outside of Rosetta 2, or vice versa (Rosetta 
2 is Apple's on-the-fly x86_64-to-arm64 translation service). 
 
If you are installing with npm, you can try ensuring that both npm and node are 
not running under Rosetta 2 and then reinstalling esbuild. This likely involves 
changing how you installed npm and/or node. For example, installing node with 
the universal installer here should work: https://nodejs.org/en/download/. Or 
you could consider using yarn instead of npm which has built-in support for 
installing a package on multiple platforms simultaneously. 
 
If you are installing with yarn, you can try listing both &quot;arm64&quot; and &quot;x64&quot; 
in your &quot;.yarnrc.yml&quot; file using the &quot;supportedArchitectures&quot; feature: 
https://yarnpkg.com/configuration/yarnrc/#supportedArchitectures 
Keep in mind that this means multiple copies of esbuild will be present. 
`</span><span class="s1">;</span>
          <span class="s2">}</span>
          <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">`</span>
<span class="s0">You installed esbuild for another platform than the one you're currently using. 
This won't work because esbuild is written with native code and needs to 
install a platform-specific binary executable. 
</span><span class="s2">${suggestions}</span>
<span class="s0">Another alternative is to use the &quot;esbuild-wasm&quot; package instead, which works 
the same way on all platforms. But it comes with a heavy performance cost and 
can sometimes be 10x slower than the &quot;esbuild&quot; package, so you may also not 
want to do that. 
`</span><span class="s2">)</span><span class="s1">;</span>
        <span class="s2">}</span>
        <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">`The package &quot;</span><span class="s2">${pkg}</span><span class="s0">&quot; could not be found, and is needed by esbuild. 
 
If you are installing esbuild with npm, make sure that you don't specify the 
&quot;--no-optional&quot; or &quot;--omit=optional&quot; flags. The &quot;optionalDependencies&quot; feature 
of &quot;package.json&quot; is used by esbuild to install the correct binary executable 
for your current platform.`</span><span class="s2">)</span><span class="s1">;</span>
      <span class="s2">}</span>
      <span class="s1">throw </span><span class="s2">e</span><span class="s1">;</span>
    <span class="s2">}</span>
  <span class="s2">}</span>
  <span class="s1">if </span><span class="s2">(</span><span class="s4">/\.zip\//</span><span class="s2">.test(binPath)) {</span>
    <span class="s1">let </span><span class="s2">pnpapi</span><span class="s1">;</span>
    <span class="s1">try </span><span class="s2">{</span>
      <span class="s2">pnpapi = require(</span><span class="s0">&quot;pnpapi&quot;</span><span class="s2">)</span><span class="s1">;</span>
    <span class="s2">} </span><span class="s1">catch </span><span class="s2">(e) {</span>
    <span class="s2">}</span>
    <span class="s1">if </span><span class="s2">(pnpapi) {</span>
      <span class="s1">const </span><span class="s2">root = pnpapi.getPackageInformation(pnpapi.topLevel).packageLocation</span><span class="s1">;</span>
      <span class="s1">const </span><span class="s2">binTargetPath = path.join(</span>
        <span class="s2">root</span><span class="s1">,</span>
        <span class="s0">&quot;node_modules&quot;</span><span class="s1">,</span>
        <span class="s0">&quot;.cache&quot;</span><span class="s1">,</span>
        <span class="s0">&quot;esbuild&quot;</span><span class="s1">,</span>
        <span class="s0">`pnpapi-</span><span class="s2">${pkg.replace(</span><span class="s0">&quot;/&quot;</span><span class="s1">, </span><span class="s0">&quot;-&quot;</span><span class="s2">)}</span><span class="s0">-</span><span class="s2">${</span><span class="s0">&quot;0.17.18&quot;</span><span class="s2">}</span><span class="s0">-</span><span class="s2">${path.basename(subpath)}</span><span class="s0">`</span>
      <span class="s2">)</span><span class="s1">;</span>
      <span class="s1">if </span><span class="s2">(!fs.existsSync(binTargetPath)) {</span>
        <span class="s2">fs.mkdirSync(path.dirname(binTargetPath)</span><span class="s1">, </span><span class="s2">{ recursive: </span><span class="s1">true </span><span class="s2">})</span><span class="s1">;</span>
        <span class="s2">fs.copyFileSync(binPath</span><span class="s1">, </span><span class="s2">binTargetPath)</span><span class="s1">;</span>
        <span class="s2">fs.chmodSync(binTargetPath</span><span class="s1">, </span><span class="s4">493</span><span class="s2">)</span><span class="s1">;</span>
      <span class="s2">}</span>
      <span class="s1">return </span><span class="s2">{ binPath: binTargetPath</span><span class="s1">, </span><span class="s2">isWASM }</span><span class="s1">;</span>
    <span class="s2">}</span>
  <span class="s2">}</span>
  <span class="s1">return </span><span class="s2">{ binPath</span><span class="s1">, </span><span class="s2">isWASM }</span><span class="s1">;</span>
<span class="s2">}</span>

<span class="s3">// lib/npm/node.ts</span>
<span class="s1">var </span><span class="s2">child_process = require(</span><span class="s0">&quot;child_process&quot;</span><span class="s2">)</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">crypto = require(</span><span class="s0">&quot;crypto&quot;</span><span class="s2">)</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">path2 = require(</span><span class="s0">&quot;path&quot;</span><span class="s2">)</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">fs2 = require(</span><span class="s0">&quot;fs&quot;</span><span class="s2">)</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">os2 = require(</span><span class="s0">&quot;os&quot;</span><span class="s2">)</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">tty = require(</span><span class="s0">&quot;tty&quot;</span><span class="s2">)</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">worker_threads</span><span class="s1">;</span>
<span class="s1">if </span><span class="s2">(process.env.ESBUILD_WORKER_THREADS !== </span><span class="s0">&quot;0&quot;</span><span class="s2">) {</span>
  <span class="s1">try </span><span class="s2">{</span>
    <span class="s2">worker_threads = require(</span><span class="s0">&quot;worker_threads&quot;</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s2">} </span><span class="s1">catch </span><span class="s2">{</span>
  <span class="s2">}</span>
  <span class="s1">let </span><span class="s2">[major</span><span class="s1">, </span><span class="s2">minor] = process.versions.node.split(</span><span class="s0">&quot;.&quot;</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(</span>
    <span class="s3">// &lt;v12.17.0 does not work</span>
    <span class="s2">+major &lt; </span><span class="s4">12 </span><span class="s2">|| +major === </span><span class="s4">12 </span><span class="s2">&amp;&amp; +minor &lt; </span><span class="s4">17 </span><span class="s2">|| +major === </span><span class="s4">13 </span><span class="s2">&amp;&amp; +minor &lt; </span><span class="s4">13</span>
  <span class="s2">) {</span>
    <span class="s2">worker_threads = </span><span class="s1">void </span><span class="s4">0</span><span class="s1">;</span>
  <span class="s2">}</span>
<span class="s2">}</span>
<span class="s1">var </span><span class="s2">_a</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">isInternalWorkerThread = ((_a = worker_threads == </span><span class="s1">null </span><span class="s2">? </span><span class="s1">void </span><span class="s4">0 </span><span class="s2">: worker_threads.workerData) == </span><span class="s1">null </span><span class="s2">? </span><span class="s1">void </span><span class="s4">0 </span><span class="s2">: _a.esbuildVersion) === </span><span class="s0">&quot;0.17.18&quot;</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">esbuildCommandAndArgs = () =&gt; {</span>
  <span class="s1">if </span><span class="s2">((!ESBUILD_BINARY_PATH || </span><span class="s1">false</span><span class="s2">) &amp;&amp; (path2.basename(__filename) !== </span><span class="s0">&quot;main.js&quot; </span><span class="s2">|| path2.basename(__dirname) !== </span><span class="s0">&quot;lib&quot;</span><span class="s2">)) {</span>
    <span class="s1">throw new </span><span class="s2">Error(</span>
      <span class="s0">`The esbuild JavaScript API cannot be bundled. Please mark the &quot;esbuild&quot; package as external so it's not included in the bundle. 
 
More information: The file containing the code for esbuild's JavaScript API (</span><span class="s2">${__filename}</span><span class="s0">) does not appear to be inside the esbuild package on the file system, which usually means that the esbuild package was bundled into another file. This is problematic because the API needs to run a binary executable inside the esbuild package which is located using a relative path from the API code to the executable. If the esbuild package is bundled, the relative path will be incorrect and the executable won't be found.`</span>
    <span class="s2">)</span><span class="s1">;</span>
  <span class="s2">}</span>
  <span class="s1">if </span><span class="s2">(</span><span class="s1">false</span><span class="s2">) {</span>
    <span class="s1">return </span><span class="s2">[</span><span class="s0">&quot;node&quot;</span><span class="s1">, </span><span class="s2">[path2.join(__dirname</span><span class="s1">, </span><span class="s0">&quot;..&quot;</span><span class="s1">, </span><span class="s0">&quot;bin&quot;</span><span class="s1">, </span><span class="s0">&quot;esbuild&quot;</span><span class="s2">)]]</span><span class="s1">;</span>
  <span class="s2">} </span><span class="s1">else </span><span class="s2">{</span>
    <span class="s1">const </span><span class="s2">{ binPath</span><span class="s1">, </span><span class="s2">isWASM } = generateBinPath()</span><span class="s1">;</span>
    <span class="s1">if </span><span class="s2">(isWASM) {</span>
      <span class="s1">return </span><span class="s2">[</span><span class="s0">&quot;node&quot;</span><span class="s1">, </span><span class="s2">[binPath]]</span><span class="s1">;</span>
    <span class="s2">} </span><span class="s1">else </span><span class="s2">{</span>
      <span class="s1">return </span><span class="s2">[binPath</span><span class="s1">, </span><span class="s2">[]]</span><span class="s1">;</span>
    <span class="s2">}</span>
  <span class="s2">}</span>
<span class="s2">}</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">isTTY = () =&gt; tty.isatty(</span><span class="s4">2</span><span class="s2">)</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">fsSync = {</span>
  <span class="s2">readFile(tempFile</span><span class="s1">, </span><span class="s2">callback) {</span>
    <span class="s1">try </span><span class="s2">{</span>
      <span class="s1">let </span><span class="s2">contents = fs2.readFileSync(tempFile</span><span class="s1">, </span><span class="s0">&quot;utf8&quot;</span><span class="s2">)</span><span class="s1">;</span>
      <span class="s1">try </span><span class="s2">{</span>
        <span class="s2">fs2.unlinkSync(tempFile)</span><span class="s1">;</span>
      <span class="s2">} </span><span class="s1">catch </span><span class="s2">{</span>
      <span class="s2">}</span>
      <span class="s2">callback(</span><span class="s1">null, </span><span class="s2">contents)</span><span class="s1">;</span>
    <span class="s2">} </span><span class="s1">catch </span><span class="s2">(err) {</span>
      <span class="s2">callback(err</span><span class="s1">, null</span><span class="s2">)</span><span class="s1">;</span>
    <span class="s2">}</span>
  <span class="s2">}</span><span class="s1">,</span>
  <span class="s2">writeFile(contents</span><span class="s1">, </span><span class="s2">callback) {</span>
    <span class="s1">try </span><span class="s2">{</span>
      <span class="s1">let </span><span class="s2">tempFile = randomFileName()</span><span class="s1">;</span>
      <span class="s2">fs2.writeFileSync(tempFile</span><span class="s1">, </span><span class="s2">contents)</span><span class="s1">;</span>
      <span class="s2">callback(tempFile)</span><span class="s1">;</span>
    <span class="s2">} </span><span class="s1">catch </span><span class="s2">{</span>
      <span class="s2">callback(</span><span class="s1">null</span><span class="s2">)</span><span class="s1">;</span>
    <span class="s2">}</span>
  <span class="s2">}</span>
<span class="s2">}</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">fsAsync = {</span>
  <span class="s2">readFile(tempFile</span><span class="s1">, </span><span class="s2">callback) {</span>
    <span class="s1">try </span><span class="s2">{</span>
      <span class="s2">fs2.readFile(tempFile</span><span class="s1">, </span><span class="s0">&quot;utf8&quot;</span><span class="s1">, </span><span class="s2">(err</span><span class="s1">, </span><span class="s2">contents) =&gt; {</span>
        <span class="s1">try </span><span class="s2">{</span>
          <span class="s2">fs2.unlink(tempFile</span><span class="s1">, </span><span class="s2">() =&gt; callback(err</span><span class="s1">, </span><span class="s2">contents))</span><span class="s1">;</span>
        <span class="s2">} </span><span class="s1">catch </span><span class="s2">{</span>
          <span class="s2">callback(err</span><span class="s1">, </span><span class="s2">contents)</span><span class="s1">;</span>
        <span class="s2">}</span>
      <span class="s2">})</span><span class="s1">;</span>
    <span class="s2">} </span><span class="s1">catch </span><span class="s2">(err) {</span>
      <span class="s2">callback(err</span><span class="s1">, null</span><span class="s2">)</span><span class="s1">;</span>
    <span class="s2">}</span>
  <span class="s2">}</span><span class="s1">,</span>
  <span class="s2">writeFile(contents</span><span class="s1">, </span><span class="s2">callback) {</span>
    <span class="s1">try </span><span class="s2">{</span>
      <span class="s1">let </span><span class="s2">tempFile = randomFileName()</span><span class="s1">;</span>
      <span class="s2">fs2.writeFile(tempFile</span><span class="s1">, </span><span class="s2">contents</span><span class="s1">, </span><span class="s2">(err) =&gt; err !== </span><span class="s1">null </span><span class="s2">? callback(</span><span class="s1">null</span><span class="s2">) : callback(tempFile))</span><span class="s1">;</span>
    <span class="s2">} </span><span class="s1">catch </span><span class="s2">{</span>
      <span class="s2">callback(</span><span class="s1">null</span><span class="s2">)</span><span class="s1">;</span>
    <span class="s2">}</span>
  <span class="s2">}</span>
<span class="s2">}</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">version = </span><span class="s0">&quot;0.17.18&quot;</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">build = (options) =&gt; ensureServiceIsRunning().build(options)</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">context = (buildOptions) =&gt; ensureServiceIsRunning().context(buildOptions)</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">transform = (input</span><span class="s1">, </span><span class="s2">options) =&gt; ensureServiceIsRunning().transform(input</span><span class="s1">, </span><span class="s2">options)</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">formatMessages = (messages</span><span class="s1">, </span><span class="s2">options) =&gt; ensureServiceIsRunning().formatMessages(messages</span><span class="s1">, </span><span class="s2">options)</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">analyzeMetafile = (messages</span><span class="s1">, </span><span class="s2">options) =&gt; ensureServiceIsRunning().analyzeMetafile(messages</span><span class="s1">, </span><span class="s2">options)</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">buildSync = (options) =&gt; {</span>
  <span class="s1">if </span><span class="s2">(worker_threads &amp;&amp; !isInternalWorkerThread) {</span>
    <span class="s1">if </span><span class="s2">(!workerThreadService)</span>
      <span class="s2">workerThreadService = startWorkerThreadService(worker_threads)</span><span class="s1">;</span>
    <span class="s1">return </span><span class="s2">workerThreadService.buildSync(options)</span><span class="s1">;</span>
  <span class="s2">}</span>
  <span class="s1">let </span><span class="s2">result</span><span class="s1">;</span>
  <span class="s2">runServiceSync((service) =&gt; service.buildOrContext({</span>
    <span class="s2">callName: </span><span class="s0">&quot;buildSync&quot;</span><span class="s1">,</span>
    <span class="s2">refs: </span><span class="s1">null,</span>
    <span class="s2">options</span><span class="s1">,</span>
    <span class="s2">isTTY: isTTY()</span><span class="s1">,</span>
    <span class="s2">defaultWD</span><span class="s1">,</span>
    <span class="s2">callback: (err</span><span class="s1">, </span><span class="s2">res) =&gt; {</span>
      <span class="s1">if </span><span class="s2">(err)</span>
        <span class="s1">throw </span><span class="s2">err</span><span class="s1">;</span>
      <span class="s2">result = res</span><span class="s1">;</span>
    <span class="s2">}</span>
  <span class="s2">}))</span><span class="s1">;</span>
  <span class="s1">return </span><span class="s2">result</span><span class="s1">;</span>
<span class="s2">}</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">transformSync = (input</span><span class="s1">, </span><span class="s2">options) =&gt; {</span>
  <span class="s1">if </span><span class="s2">(worker_threads &amp;&amp; !isInternalWorkerThread) {</span>
    <span class="s1">if </span><span class="s2">(!workerThreadService)</span>
      <span class="s2">workerThreadService = startWorkerThreadService(worker_threads)</span><span class="s1">;</span>
    <span class="s1">return </span><span class="s2">workerThreadService.transformSync(input</span><span class="s1">, </span><span class="s2">options)</span><span class="s1">;</span>
  <span class="s2">}</span>
  <span class="s1">let </span><span class="s2">result</span><span class="s1">;</span>
  <span class="s2">runServiceSync((service) =&gt; service.transform({</span>
    <span class="s2">callName: </span><span class="s0">&quot;transformSync&quot;</span><span class="s1">,</span>
    <span class="s2">refs: </span><span class="s1">null,</span>
    <span class="s2">input</span><span class="s1">,</span>
    <span class="s2">options: options || {}</span><span class="s1">,</span>
    <span class="s2">isTTY: isTTY()</span><span class="s1">,</span>
    <span class="s2">fs: fsSync</span><span class="s1">,</span>
    <span class="s2">callback: (err</span><span class="s1">, </span><span class="s2">res) =&gt; {</span>
      <span class="s1">if </span><span class="s2">(err)</span>
        <span class="s1">throw </span><span class="s2">err</span><span class="s1">;</span>
      <span class="s2">result = res</span><span class="s1">;</span>
    <span class="s2">}</span>
  <span class="s2">}))</span><span class="s1">;</span>
  <span class="s1">return </span><span class="s2">result</span><span class="s1">;</span>
<span class="s2">}</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">formatMessagesSync = (messages</span><span class="s1">, </span><span class="s2">options) =&gt; {</span>
  <span class="s1">if </span><span class="s2">(worker_threads &amp;&amp; !isInternalWorkerThread) {</span>
    <span class="s1">if </span><span class="s2">(!workerThreadService)</span>
      <span class="s2">workerThreadService = startWorkerThreadService(worker_threads)</span><span class="s1">;</span>
    <span class="s1">return </span><span class="s2">workerThreadService.formatMessagesSync(messages</span><span class="s1">, </span><span class="s2">options)</span><span class="s1">;</span>
  <span class="s2">}</span>
  <span class="s1">let </span><span class="s2">result</span><span class="s1">;</span>
  <span class="s2">runServiceSync((service) =&gt; service.formatMessages({</span>
    <span class="s2">callName: </span><span class="s0">&quot;formatMessagesSync&quot;</span><span class="s1">,</span>
    <span class="s2">refs: </span><span class="s1">null,</span>
    <span class="s2">messages</span><span class="s1">,</span>
    <span class="s2">options</span><span class="s1">,</span>
    <span class="s2">callback: (err</span><span class="s1">, </span><span class="s2">res) =&gt; {</span>
      <span class="s1">if </span><span class="s2">(err)</span>
        <span class="s1">throw </span><span class="s2">err</span><span class="s1">;</span>
      <span class="s2">result = res</span><span class="s1">;</span>
    <span class="s2">}</span>
  <span class="s2">}))</span><span class="s1">;</span>
  <span class="s1">return </span><span class="s2">result</span><span class="s1">;</span>
<span class="s2">}</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">analyzeMetafileSync = (metafile</span><span class="s1">, </span><span class="s2">options) =&gt; {</span>
  <span class="s1">if </span><span class="s2">(worker_threads &amp;&amp; !isInternalWorkerThread) {</span>
    <span class="s1">if </span><span class="s2">(!workerThreadService)</span>
      <span class="s2">workerThreadService = startWorkerThreadService(worker_threads)</span><span class="s1">;</span>
    <span class="s1">return </span><span class="s2">workerThreadService.analyzeMetafileSync(metafile</span><span class="s1">, </span><span class="s2">options)</span><span class="s1">;</span>
  <span class="s2">}</span>
  <span class="s1">let </span><span class="s2">result</span><span class="s1">;</span>
  <span class="s2">runServiceSync((service) =&gt; service.analyzeMetafile({</span>
    <span class="s2">callName: </span><span class="s0">&quot;analyzeMetafileSync&quot;</span><span class="s1">,</span>
    <span class="s2">refs: </span><span class="s1">null,</span>
    <span class="s2">metafile: </span><span class="s1">typeof </span><span class="s2">metafile === </span><span class="s0">&quot;string&quot; </span><span class="s2">? metafile : JSON.stringify(metafile)</span><span class="s1">,</span>
    <span class="s2">options</span><span class="s1">,</span>
    <span class="s2">callback: (err</span><span class="s1">, </span><span class="s2">res) =&gt; {</span>
      <span class="s1">if </span><span class="s2">(err)</span>
        <span class="s1">throw </span><span class="s2">err</span><span class="s1">;</span>
      <span class="s2">result = res</span><span class="s1">;</span>
    <span class="s2">}</span>
  <span class="s2">}))</span><span class="s1">;</span>
  <span class="s1">return </span><span class="s2">result</span><span class="s1">;</span>
<span class="s2">}</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">initializeWasCalled = </span><span class="s1">false;</span>
<span class="s1">var </span><span class="s2">initialize = (options) =&gt; {</span>
  <span class="s2">options = validateInitializeOptions(options || {})</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(options.wasmURL)</span>
    <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">`The &quot;wasmURL&quot; option only works in the browser`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(options.wasmModule)</span>
    <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">`The &quot;wasmModule&quot; option only works in the browser`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(options.worker)</span>
    <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">`The &quot;worker&quot; option only works in the browser`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(initializeWasCalled)</span>
    <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">'Cannot call &quot;initialize&quot; more than once'</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s2">ensureServiceIsRunning()</span><span class="s1">;</span>
  <span class="s2">initializeWasCalled = </span><span class="s1">true;</span>
  <span class="s1">return </span><span class="s2">Promise.resolve()</span><span class="s1">;</span>
<span class="s2">}</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">defaultWD = process.cwd()</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">longLivedService</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">ensureServiceIsRunning = () =&gt; {</span>
  <span class="s1">if </span><span class="s2">(longLivedService)</span>
    <span class="s1">return </span><span class="s2">longLivedService</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">[command</span><span class="s1">, </span><span class="s2">args] = esbuildCommandAndArgs()</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">child = child_process.spawn(command</span><span class="s1">, </span><span class="s2">args.concat(</span><span class="s0">`--service=</span><span class="s2">${</span><span class="s0">&quot;0.17.18&quot;</span><span class="s2">}</span><span class="s0">`</span><span class="s1">, </span><span class="s0">&quot;--ping&quot;</span><span class="s2">)</span><span class="s1">, </span><span class="s2">{</span>
    <span class="s2">windowsHide: </span><span class="s1">true,</span>
    <span class="s2">stdio: [</span><span class="s0">&quot;pipe&quot;</span><span class="s1">, </span><span class="s0">&quot;pipe&quot;</span><span class="s1">, </span><span class="s0">&quot;inherit&quot;</span><span class="s2">]</span><span class="s1">,</span>
    <span class="s2">cwd: defaultWD</span>
  <span class="s2">})</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">{ readFromStdout</span><span class="s1">, </span><span class="s2">afterClose</span><span class="s1">, </span><span class="s2">service } = createChannel({</span>
    <span class="s2">writeToStdin(bytes) {</span>
      <span class="s2">child.stdin.write(bytes</span><span class="s1">, </span><span class="s2">(err) =&gt; {</span>
        <span class="s1">if </span><span class="s2">(err)</span>
          <span class="s2">afterClose(err)</span><span class="s1">;</span>
      <span class="s2">})</span><span class="s1">;</span>
    <span class="s2">}</span><span class="s1">,</span>
    <span class="s2">readFileSync: fs2.readFileSync</span><span class="s1">,</span>
    <span class="s2">isSync: </span><span class="s1">false,</span>
    <span class="s2">hasFS: </span><span class="s1">true,</span>
    <span class="s2">esbuild: node_exports</span>
  <span class="s2">})</span><span class="s1">;</span>
  <span class="s2">child.stdin.on(</span><span class="s0">&quot;error&quot;</span><span class="s1">, </span><span class="s2">afterClose)</span><span class="s1">;</span>
  <span class="s2">child.on(</span><span class="s0">&quot;error&quot;</span><span class="s1">, </span><span class="s2">afterClose)</span><span class="s1">;</span>
  <span class="s1">const </span><span class="s2">stdin = child.stdin</span><span class="s1">;</span>
  <span class="s1">const </span><span class="s2">stdout = child.stdout</span><span class="s1">;</span>
  <span class="s2">stdout.on(</span><span class="s0">&quot;data&quot;</span><span class="s1">, </span><span class="s2">readFromStdout)</span><span class="s1">;</span>
  <span class="s2">stdout.on(</span><span class="s0">&quot;end&quot;</span><span class="s1">, </span><span class="s2">afterClose)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">refCount = </span><span class="s4">0</span><span class="s1">;</span>
  <span class="s2">child.unref()</span><span class="s1">;</span>
  <span class="s1">if </span><span class="s2">(stdin.unref) {</span>
    <span class="s2">stdin.unref()</span><span class="s1">;</span>
  <span class="s2">}</span>
  <span class="s1">if </span><span class="s2">(stdout.unref) {</span>
    <span class="s2">stdout.unref()</span><span class="s1">;</span>
  <span class="s2">}</span>
  <span class="s1">const </span><span class="s2">refs = {</span>
    <span class="s2">ref() {</span>
      <span class="s1">if </span><span class="s2">(++refCount === </span><span class="s4">1</span><span class="s2">)</span>
        <span class="s2">child.ref()</span><span class="s1">;</span>
    <span class="s2">}</span><span class="s1">,</span>
    <span class="s2">unref() {</span>
      <span class="s1">if </span><span class="s2">(--refCount === </span><span class="s4">0</span><span class="s2">)</span>
        <span class="s2">child.unref()</span><span class="s1">;</span>
    <span class="s2">}</span>
  <span class="s2">}</span><span class="s1">;</span>
  <span class="s2">longLivedService = {</span>
    <span class="s2">build: (options) =&gt; </span><span class="s1">new </span><span class="s2">Promise((resolve</span><span class="s1">, </span><span class="s2">reject) =&gt; {</span>
      <span class="s2">service.buildOrContext({</span>
        <span class="s2">callName: </span><span class="s0">&quot;build&quot;</span><span class="s1">,</span>
        <span class="s2">refs</span><span class="s1">,</span>
        <span class="s2">options</span><span class="s1">,</span>
        <span class="s2">isTTY: isTTY()</span><span class="s1">,</span>
        <span class="s2">defaultWD</span><span class="s1">,</span>
        <span class="s2">callback: (err</span><span class="s1">, </span><span class="s2">res) =&gt; err ? reject(err) : resolve(res)</span>
      <span class="s2">})</span><span class="s1">;</span>
    <span class="s2">})</span><span class="s1">,</span>
    <span class="s2">context: (options) =&gt; </span><span class="s1">new </span><span class="s2">Promise((resolve</span><span class="s1">, </span><span class="s2">reject) =&gt; service.buildOrContext({</span>
      <span class="s2">callName: </span><span class="s0">&quot;context&quot;</span><span class="s1">,</span>
      <span class="s2">refs</span><span class="s1">,</span>
      <span class="s2">options</span><span class="s1">,</span>
      <span class="s2">isTTY: isTTY()</span><span class="s1">,</span>
      <span class="s2">defaultWD</span><span class="s1">,</span>
      <span class="s2">callback: (err</span><span class="s1">, </span><span class="s2">res) =&gt; err ? reject(err) : resolve(res)</span>
    <span class="s2">}))</span><span class="s1">,</span>
    <span class="s2">transform: (input</span><span class="s1">, </span><span class="s2">options) =&gt; </span><span class="s1">new </span><span class="s2">Promise((resolve</span><span class="s1">, </span><span class="s2">reject) =&gt; service.transform({</span>
      <span class="s2">callName: </span><span class="s0">&quot;transform&quot;</span><span class="s1">,</span>
      <span class="s2">refs</span><span class="s1">,</span>
      <span class="s2">input</span><span class="s1">,</span>
      <span class="s2">options: options || {}</span><span class="s1">,</span>
      <span class="s2">isTTY: isTTY()</span><span class="s1">,</span>
      <span class="s2">fs: fsAsync</span><span class="s1">,</span>
      <span class="s2">callback: (err</span><span class="s1">, </span><span class="s2">res) =&gt; err ? reject(err) : resolve(res)</span>
    <span class="s2">}))</span><span class="s1">,</span>
    <span class="s2">formatMessages: (messages</span><span class="s1">, </span><span class="s2">options) =&gt; </span><span class="s1">new </span><span class="s2">Promise((resolve</span><span class="s1">, </span><span class="s2">reject) =&gt; service.formatMessages({</span>
      <span class="s2">callName: </span><span class="s0">&quot;formatMessages&quot;</span><span class="s1">,</span>
      <span class="s2">refs</span><span class="s1">,</span>
      <span class="s2">messages</span><span class="s1">,</span>
      <span class="s2">options</span><span class="s1">,</span>
      <span class="s2">callback: (err</span><span class="s1">, </span><span class="s2">res) =&gt; err ? reject(err) : resolve(res)</span>
    <span class="s2">}))</span><span class="s1">,</span>
    <span class="s2">analyzeMetafile: (metafile</span><span class="s1">, </span><span class="s2">options) =&gt; </span><span class="s1">new </span><span class="s2">Promise((resolve</span><span class="s1">, </span><span class="s2">reject) =&gt; service.analyzeMetafile({</span>
      <span class="s2">callName: </span><span class="s0">&quot;analyzeMetafile&quot;</span><span class="s1">,</span>
      <span class="s2">refs</span><span class="s1">,</span>
      <span class="s2">metafile: </span><span class="s1">typeof </span><span class="s2">metafile === </span><span class="s0">&quot;string&quot; </span><span class="s2">? metafile : JSON.stringify(metafile)</span><span class="s1">,</span>
      <span class="s2">options</span><span class="s1">,</span>
      <span class="s2">callback: (err</span><span class="s1">, </span><span class="s2">res) =&gt; err ? reject(err) : resolve(res)</span>
    <span class="s2">}))</span>
  <span class="s2">}</span><span class="s1">;</span>
  <span class="s1">return </span><span class="s2">longLivedService</span><span class="s1">;</span>
<span class="s2">}</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">runServiceSync = (callback) =&gt; {</span>
  <span class="s1">let </span><span class="s2">[command</span><span class="s1">, </span><span class="s2">args] = esbuildCommandAndArgs()</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">stdin = </span><span class="s1">new </span><span class="s2">Uint8Array()</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">{ readFromStdout</span><span class="s1">, </span><span class="s2">afterClose</span><span class="s1">, </span><span class="s2">service } = createChannel({</span>
    <span class="s2">writeToStdin(bytes) {</span>
      <span class="s1">if </span><span class="s2">(stdin.length !== </span><span class="s4">0</span><span class="s2">)</span>
        <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">&quot;Must run at most one command&quot;</span><span class="s2">)</span><span class="s1">;</span>
      <span class="s2">stdin = bytes</span><span class="s1">;</span>
    <span class="s2">}</span><span class="s1">,</span>
    <span class="s2">isSync: </span><span class="s1">true,</span>
    <span class="s2">hasFS: </span><span class="s1">true,</span>
    <span class="s2">esbuild: node_exports</span>
  <span class="s2">})</span><span class="s1">;</span>
  <span class="s2">callback(service)</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">stdout = child_process.execFileSync(command</span><span class="s1">, </span><span class="s2">args.concat(</span><span class="s0">`--service=</span><span class="s2">${</span><span class="s0">&quot;0.17.18&quot;</span><span class="s2">}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">, </span><span class="s2">{</span>
    <span class="s2">cwd: defaultWD</span><span class="s1">,</span>
    <span class="s2">windowsHide: </span><span class="s1">true,</span>
    <span class="s2">input: stdin</span><span class="s1">,</span>
    <span class="s3">// We don't know how large the output could be. If it's too large, the</span>
    <span class="s3">// command will fail with ENOBUFS. Reserve 16mb for now since that feels</span>
    <span class="s3">// like it should be enough. Also allow overriding this with an environment</span>
    <span class="s3">// variable.</span>
    <span class="s2">maxBuffer: +process.env.ESBUILD_MAX_BUFFER || </span><span class="s4">16 </span><span class="s2">* </span><span class="s4">1024 </span><span class="s2">* </span><span class="s4">1024</span>
  <span class="s2">})</span><span class="s1">;</span>
  <span class="s2">readFromStdout(stdout)</span><span class="s1">;</span>
  <span class="s2">afterClose(</span><span class="s1">null</span><span class="s2">)</span><span class="s1">;</span>
<span class="s2">}</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">randomFileName = () =&gt; {</span>
  <span class="s1">return </span><span class="s2">path2.join(os2.tmpdir()</span><span class="s1">, </span><span class="s0">`esbuild-</span><span class="s2">${crypto.randomBytes(</span><span class="s4">32</span><span class="s2">).toString(</span><span class="s0">&quot;hex&quot;</span><span class="s2">)}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
<span class="s2">}</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">workerThreadService = </span><span class="s1">null;</span>
<span class="s1">var </span><span class="s2">startWorkerThreadService = (worker_threads2) =&gt; {</span>
  <span class="s1">let </span><span class="s2">{ port1: mainPort</span><span class="s1">, </span><span class="s2">port2: workerPort } = </span><span class="s1">new </span><span class="s2">worker_threads2.MessageChannel()</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">worker = </span><span class="s1">new </span><span class="s2">worker_threads2.Worker(__filename</span><span class="s1">, </span><span class="s2">{</span>
    <span class="s2">workerData: { workerPort</span><span class="s1">, </span><span class="s2">defaultWD</span><span class="s1">, </span><span class="s2">esbuildVersion: </span><span class="s0">&quot;0.17.18&quot; </span><span class="s2">}</span><span class="s1">,</span>
    <span class="s2">transferList: [workerPort]</span><span class="s1">,</span>
    <span class="s3">// From node's documentation: https://nodejs.org/api/worker_threads.html</span>
    <span class="s3">//</span>
    <span class="s3">//   Take care when launching worker threads from preload scripts (scripts loaded</span>
    <span class="s3">//   and run using the `-r` command line flag). Unless the `execArgv` option is</span>
    <span class="s3">//   explicitly set, new Worker threads automatically inherit the command line flags</span>
    <span class="s3">//   from the running process and will preload the same preload scripts as the main</span>
    <span class="s3">//   thread. If the preload script unconditionally launches a worker thread, every</span>
    <span class="s3">//   thread spawned will spawn another until the application crashes.</span>
    <span class="s3">//</span>
    <span class="s2">execArgv: []</span>
  <span class="s2">})</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">nextID = </span><span class="s4">0</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">fakeBuildError = (text) =&gt; {</span>
    <span class="s1">let </span><span class="s2">error = </span><span class="s1">new </span><span class="s2">Error(</span><span class="s0">`Build failed with 1 error: 
error: </span><span class="s2">${text}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
    <span class="s1">let </span><span class="s2">errors = [{ id: </span><span class="s0">&quot;&quot;</span><span class="s1">, </span><span class="s2">pluginName: </span><span class="s0">&quot;&quot;</span><span class="s1">, </span><span class="s2">text</span><span class="s1">, </span><span class="s2">location: </span><span class="s1">null, </span><span class="s2">notes: []</span><span class="s1">, </span><span class="s2">detail: </span><span class="s1">void </span><span class="s4">0 </span><span class="s2">}]</span><span class="s1">;</span>
    <span class="s2">error.errors = errors</span><span class="s1">;</span>
    <span class="s2">error.warnings = []</span><span class="s1">;</span>
    <span class="s1">return </span><span class="s2">error</span><span class="s1">;</span>
  <span class="s2">}</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">validateBuildSyncOptions = (options) =&gt; {</span>
    <span class="s1">if </span><span class="s2">(!options)</span>
      <span class="s1">return;</span>
    <span class="s1">let </span><span class="s2">plugins = options.plugins</span><span class="s1">;</span>
    <span class="s1">if </span><span class="s2">(plugins &amp;&amp; plugins.length &gt; </span><span class="s4">0</span><span class="s2">)</span>
      <span class="s1">throw </span><span class="s2">fakeBuildError(</span><span class="s0">`Cannot use plugins in synchronous API calls`</span><span class="s2">)</span><span class="s1">;</span>
  <span class="s2">}</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">applyProperties = (object</span><span class="s1">, </span><span class="s2">properties) =&gt; {</span>
    <span class="s1">for </span><span class="s2">(</span><span class="s1">let </span><span class="s2">key </span><span class="s1">in </span><span class="s2">properties) {</span>
      <span class="s2">object[key] = properties[key]</span><span class="s1">;</span>
    <span class="s2">}</span>
  <span class="s2">}</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">runCallSync = (command</span><span class="s1">, </span><span class="s2">args) =&gt; {</span>
    <span class="s1">let </span><span class="s2">id = nextID++</span><span class="s1">;</span>
    <span class="s1">let </span><span class="s2">sharedBuffer = </span><span class="s1">new </span><span class="s2">SharedArrayBuffer(</span><span class="s4">8</span><span class="s2">)</span><span class="s1">;</span>
    <span class="s1">let </span><span class="s2">sharedBufferView = </span><span class="s1">new </span><span class="s2">Int32Array(sharedBuffer)</span><span class="s1">;</span>
    <span class="s1">let </span><span class="s2">msg = { sharedBuffer</span><span class="s1">, </span><span class="s2">id</span><span class="s1">, </span><span class="s2">command</span><span class="s1">, </span><span class="s2">args }</span><span class="s1">;</span>
    <span class="s2">worker.postMessage(msg)</span><span class="s1">;</span>
    <span class="s1">let </span><span class="s2">status = Atomics.wait(sharedBufferView</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s4">0</span><span class="s2">)</span><span class="s1">;</span>
    <span class="s1">if </span><span class="s2">(status !== </span><span class="s0">&quot;ok&quot; </span><span class="s2">&amp;&amp; status !== </span><span class="s0">&quot;not-equal&quot;</span><span class="s2">)</span>
      <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">&quot;Internal error: Atomics.wait() failed: &quot; </span><span class="s2">+ status)</span><span class="s1">;</span>
    <span class="s1">let </span><span class="s2">{ message: { id: id2</span><span class="s1">, </span><span class="s2">resolve</span><span class="s1">, </span><span class="s2">reject</span><span class="s1">, </span><span class="s2">properties } } = worker_threads2.receiveMessageOnPort(mainPort)</span><span class="s1">;</span>
    <span class="s1">if </span><span class="s2">(id !== id2)</span>
      <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">`Internal error: Expected id </span><span class="s2">${id} </span><span class="s0">but got id </span><span class="s2">${id2}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
    <span class="s1">if </span><span class="s2">(reject) {</span>
      <span class="s2">applyProperties(reject</span><span class="s1">, </span><span class="s2">properties)</span><span class="s1">;</span>
      <span class="s1">throw </span><span class="s2">reject</span><span class="s1">;</span>
    <span class="s2">}</span>
    <span class="s1">return </span><span class="s2">resolve</span><span class="s1">;</span>
  <span class="s2">}</span><span class="s1">;</span>
  <span class="s2">worker.unref()</span><span class="s1">;</span>
  <span class="s1">return </span><span class="s2">{</span>
    <span class="s2">buildSync(options) {</span>
      <span class="s2">validateBuildSyncOptions(options)</span><span class="s1">;</span>
      <span class="s1">return </span><span class="s2">runCallSync(</span><span class="s0">&quot;build&quot;</span><span class="s1">, </span><span class="s2">[options])</span><span class="s1">;</span>
    <span class="s2">}</span><span class="s1">,</span>
    <span class="s2">transformSync(input</span><span class="s1">, </span><span class="s2">options) {</span>
      <span class="s1">return </span><span class="s2">runCallSync(</span><span class="s0">&quot;transform&quot;</span><span class="s1">, </span><span class="s2">[input</span><span class="s1">, </span><span class="s2">options])</span><span class="s1">;</span>
    <span class="s2">}</span><span class="s1">,</span>
    <span class="s2">formatMessagesSync(messages</span><span class="s1">, </span><span class="s2">options) {</span>
      <span class="s1">return </span><span class="s2">runCallSync(</span><span class="s0">&quot;formatMessages&quot;</span><span class="s1">, </span><span class="s2">[messages</span><span class="s1">, </span><span class="s2">options])</span><span class="s1">;</span>
    <span class="s2">}</span><span class="s1">,</span>
    <span class="s2">analyzeMetafileSync(metafile</span><span class="s1">, </span><span class="s2">options) {</span>
      <span class="s1">return </span><span class="s2">runCallSync(</span><span class="s0">&quot;analyzeMetafile&quot;</span><span class="s1">, </span><span class="s2">[metafile</span><span class="s1">, </span><span class="s2">options])</span><span class="s1">;</span>
    <span class="s2">}</span>
  <span class="s2">}</span><span class="s1">;</span>
<span class="s2">}</span><span class="s1">;</span>
<span class="s1">var </span><span class="s2">startSyncServiceWorker = () =&gt; {</span>
  <span class="s1">let </span><span class="s2">workerPort = worker_threads.workerData.workerPort</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">parentPort = worker_threads.parentPort</span><span class="s1">;</span>
  <span class="s1">let </span><span class="s2">extractProperties = (object) =&gt; {</span>
    <span class="s1">let </span><span class="s2">properties = {}</span><span class="s1">;</span>
    <span class="s1">if </span><span class="s2">(object &amp;&amp; </span><span class="s1">typeof </span><span class="s2">object === </span><span class="s0">&quot;object&quot;</span><span class="s2">) {</span>
      <span class="s1">for </span><span class="s2">(</span><span class="s1">let </span><span class="s2">key </span><span class="s1">in </span><span class="s2">object) {</span>
        <span class="s2">properties[key] = object[key]</span><span class="s1">;</span>
      <span class="s2">}</span>
    <span class="s2">}</span>
    <span class="s1">return </span><span class="s2">properties</span><span class="s1">;</span>
  <span class="s2">}</span><span class="s1">;</span>
  <span class="s1">try </span><span class="s2">{</span>
    <span class="s1">let </span><span class="s2">service = ensureServiceIsRunning()</span><span class="s1">;</span>
    <span class="s2">defaultWD = worker_threads.workerData.defaultWD</span><span class="s1">;</span>
    <span class="s2">parentPort.on(</span><span class="s0">&quot;message&quot;</span><span class="s1">, </span><span class="s2">(msg) =&gt; {</span>
      <span class="s2">(async () =&gt; {</span>
        <span class="s1">let </span><span class="s2">{ sharedBuffer</span><span class="s1">, </span><span class="s2">id</span><span class="s1">, </span><span class="s2">command</span><span class="s1">, </span><span class="s2">args } = msg</span><span class="s1">;</span>
        <span class="s1">let </span><span class="s2">sharedBufferView = </span><span class="s1">new </span><span class="s2">Int32Array(sharedBuffer)</span><span class="s1">;</span>
        <span class="s1">try </span><span class="s2">{</span>
          <span class="s1">switch </span><span class="s2">(command) {</span>
            <span class="s1">case </span><span class="s0">&quot;build&quot;</span><span class="s2">:</span>
              <span class="s2">workerPort.postMessage({ id</span><span class="s1">, </span><span class="s2">resolve: </span><span class="s1">await </span><span class="s2">service.build(args[</span><span class="s4">0</span><span class="s2">]) })</span><span class="s1">;</span>
              <span class="s1">break;</span>
            <span class="s1">case </span><span class="s0">&quot;transform&quot;</span><span class="s2">:</span>
              <span class="s2">workerPort.postMessage({ id</span><span class="s1">, </span><span class="s2">resolve: </span><span class="s1">await </span><span class="s2">service.transform(args[</span><span class="s4">0</span><span class="s2">]</span><span class="s1">, </span><span class="s2">args[</span><span class="s4">1</span><span class="s2">]) })</span><span class="s1">;</span>
              <span class="s1">break;</span>
            <span class="s1">case </span><span class="s0">&quot;formatMessages&quot;</span><span class="s2">:</span>
              <span class="s2">workerPort.postMessage({ id</span><span class="s1">, </span><span class="s2">resolve: </span><span class="s1">await </span><span class="s2">service.formatMessages(args[</span><span class="s4">0</span><span class="s2">]</span><span class="s1">, </span><span class="s2">args[</span><span class="s4">1</span><span class="s2">]) })</span><span class="s1">;</span>
              <span class="s1">break;</span>
            <span class="s1">case </span><span class="s0">&quot;analyzeMetafile&quot;</span><span class="s2">:</span>
              <span class="s2">workerPort.postMessage({ id</span><span class="s1">, </span><span class="s2">resolve: </span><span class="s1">await </span><span class="s2">service.analyzeMetafile(args[</span><span class="s4">0</span><span class="s2">]</span><span class="s1">, </span><span class="s2">args[</span><span class="s4">1</span><span class="s2">]) })</span><span class="s1">;</span>
              <span class="s1">break;</span>
            <span class="s1">default</span><span class="s2">:</span>
              <span class="s1">throw new </span><span class="s2">Error(</span><span class="s0">`Invalid command: </span><span class="s2">${command}</span><span class="s0">`</span><span class="s2">)</span><span class="s1">;</span>
          <span class="s2">}</span>
        <span class="s2">} </span><span class="s1">catch </span><span class="s2">(reject) {</span>
          <span class="s2">workerPort.postMessage({ id</span><span class="s1">, </span><span class="s2">reject</span><span class="s1">, </span><span class="s2">properties: extractProperties(reject) })</span><span class="s1">;</span>
        <span class="s2">}</span>
        <span class="s2">Atomics.add(sharedBufferView</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s4">1</span><span class="s2">)</span><span class="s1">;</span>
        <span class="s2">Atomics.notify(sharedBufferView</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s2">Infinity)</span><span class="s1">;</span>
      <span class="s2">})()</span><span class="s1">;</span>
    <span class="s2">})</span><span class="s1">;</span>
  <span class="s2">} </span><span class="s1">catch </span><span class="s2">(reject) {</span>
    <span class="s2">parentPort.on(</span><span class="s0">&quot;message&quot;</span><span class="s1">, </span><span class="s2">(msg) =&gt; {</span>
      <span class="s1">let </span><span class="s2">{ sharedBuffer</span><span class="s1">, </span><span class="s2">id } = msg</span><span class="s1">;</span>
      <span class="s1">let </span><span class="s2">sharedBufferView = </span><span class="s1">new </span><span class="s2">Int32Array(sharedBuffer)</span><span class="s1">;</span>
      <span class="s2">workerPort.postMessage({ id</span><span class="s1">, </span><span class="s2">reject</span><span class="s1">, </span><span class="s2">properties: extractProperties(reject) })</span><span class="s1">;</span>
      <span class="s2">Atomics.add(sharedBufferView</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s4">1</span><span class="s2">)</span><span class="s1">;</span>
      <span class="s2">Atomics.notify(sharedBufferView</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s2">Infinity)</span><span class="s1">;</span>
    <span class="s2">})</span><span class="s1">;</span>
  <span class="s2">}</span>
<span class="s2">}</span><span class="s1">;</span>
<span class="s1">if </span><span class="s2">(isInternalWorkerThread) {</span>
  <span class="s2">startSyncServiceWorker()</span><span class="s1">;</span>
<span class="s2">}</span>
<span class="s1">var </span><span class="s2">node_default = node_exports</span><span class="s1">;</span>
<span class="s3">// Annotate the CommonJS export names for ESM import in node:</span>
<span class="s4">0 </span><span class="s2">&amp;&amp; (module.exports = {</span>
  <span class="s2">analyzeMetafile</span><span class="s1">,</span>
  <span class="s2">analyzeMetafileSync</span><span class="s1">,</span>
  <span class="s2">build</span><span class="s1">,</span>
  <span class="s2">buildSync</span><span class="s1">,</span>
  <span class="s2">context</span><span class="s1">,</span>
  <span class="s2">formatMessages</span><span class="s1">,</span>
  <span class="s2">formatMessagesSync</span><span class="s1">,</span>
  <span class="s2">initialize</span><span class="s1">,</span>
  <span class="s2">transform</span><span class="s1">,</span>
  <span class="s2">transformSync</span><span class="s1">,</span>
  <span class="s2">version</span>
<span class="s2">})</span><span class="s1">;</span>
</pre>
</body>
</html>